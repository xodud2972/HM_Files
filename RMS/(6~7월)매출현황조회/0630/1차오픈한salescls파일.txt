<?
session_start();
@include_once $_SERVER['DOCUMENT_ROOT']."/include/db.php";
@include_once $_SERVER['DOCUMENT_ROOT'].'/tool/shin_util.php';
@include_once $_SERVER['DOCUMENT_ROOT'].'/include/common.php';
db_open();

class clsGoodType {

	public function funcOutPeirod($cal_kind,$syear,$smonth,$sday,$eyear,$emonth,$eday,$division1,$division2,$em_nm){

	if($cal_kind && $division1 && $syear && $smonth){
		$scal_kind = " AND pay_date >= '".$syear."-".$smonth."-".$sday."' AND pay_date <= '".$eyear."-".$emonth."-".$eday."' ";

		switch($cal_kind){
			case "d" :$sreg_date = "pay_date as pay_date,";$sgroup_by=", pay_date";break;
			case "m" :$sreg_date = "left(pay_date,7) as pay_date,";$sgroup_by=", left(pay_date,7)";break;
		}

		if($_SESSION['em_level']>=40){
			$where_em_seq	 = "AND em_seq		= '".$_SESSION['s_em_seq']."'";
		}else if($_SESSION['em_level']>=30){
			$where_division1 = "AND division1   = '".$division1."'";
			$where_division2 = "AND division2   = '".$division2."'";
			if($em_nm!=""){
				$where_em_seq = "AND em_seq = '".$em_nm."'";$sgroup_by	= $sgroup_by.", em_seq";
			}
		}else if($_SESSION['em_level']>=20){
			$where_division1 = "AND division1   = '".$division1."'";
			$sgroup_by = $sgroup_by.", division1";
			if($division2!=""){
				$where_division2 = "AND division2   = '".$division2."'";
				$sgroup_by	= $sgroup_by.", division2";
			}
			if($em_nm!=""){
				$where_em_seq = "AND em_seq = '".$em_nm."'";$sgroup_by	= $sgroup_by.", em_seq";
			}
		}else if($_SESSION['em_level']>=10){
			if($division1!="all"){
				$where_division1 = "AND division1   = '".$division1."'";$sgroup_by = $sgroup_by.", division1";}
			if($division2!=""){
				$where_division2 = " AND division2= '".$division2."'";$sgroup_by	= $sgroup_by.", division2";}
			if($em_nm!=""){
				$where_em_seq = "AND em_seq = '".$em_nm."'";$sgroup_by	= $sgroup_by.", em_seq";
				//$where_em_seq = "AND em_seq = '".funSelectEmpSeq($em_nm)."'";$sgroup_by	= $sgroup_by.", em_seq";
			}
		}

		$Qry = "
			SELECT SQL_CALC_FOUND_ROWS
			".$sreg_date."
			good_type2,
			division1,
			division2,
			em_seq,
			ct_type,
			SUM(pay_price) tot_price
			FROM t_contract
			WHERE 1=1
			AND del_date IS NULL
			AND agree_state = '3'
			".$where_division1."
			".$where_division2."
			".$where_em_seq."
			".$scal_kind."
			GROUP BY good_type1, good_type2, ct_type
			".$sgroup_by."
			ORDER BY pay_date
	   ";

		//echo "funcOutPeirod=>".$Qry;

		$Rst = que($Qry);

		$nListCnt = 0 ;
		while ($Row = @mysql_fetch_assoc($Rst)) {

		$S_RETURNVAL[$Row['pay_date']][$Row['good_type2']][$Row['ct_type']]['tot_price'] = $Row['tot_price'] ; //전체매출
		$S_RETURNVAL[$Row['pay_date']][$Row['good_type2']]['tot_price'] = $Row['tot_price'] ; //전체매출

		$S_RETURNVAL['division1'][]		= $Row['division1'];
		$S_RETURNVAL['division2'][]		= $Row['division2'];
		$S_RETURNVAL['em_seq'][]		= $Row['em_seq'];
		$S_RETURNVAL['pay_date'][]		= $Row['pay_date'];
		$S_RETURNVAL['ct_type'][]		= $Row['ct_type'];

		$nListCnt++;
		}

		$S_RETURNVAL['nListCnt'] = $nListCnt;
		@mysql_free_result($Rst);

		$Qry1 = 'SELECT FOUND_ROWS() N_CNT ';
		$Rst1 = @mysql_query($Qry1);
		$Row1 = @mysql_fetch_assoc($Rst1);

		

		return $S_RETURNVAL;

		que_close();
		}
	}


	public function funcOutDivision1($cal_kind,$syear,$smonth,$sday,$eyear,$emonth,$eday,$division1,$division2,$em_nm){

	if($cal_kind && $division1 && $syear && $smonth){
		$scal_kind = " AND pay_date >= '".$syear."-".$smonth."-".$sday."' AND pay_date <= '".$eyear."-".$emonth."-".$eday."' ";

		//echo "<br>division1=>".$division1;
		//echo "<br>division2=>".$division2;
		//echo "<br>em_nm=>".$em_nm;

		if($_SESSION['em_level']>=40){
			if($em_nm)  {
				$sem_name = "AND em_seq = '".$em_nm."'";
				$sgroup_by	= ", em_seq";
				$view = "3";
			}
		}else if($_SESSION['em_level']>=20){
			if($division1){
				$sdivision1 = "AND division1   = '".$division1."'";
				$sgroup_by = ", division2";
				$view = "2";
			}
			if($division2){
				$sdivision2 = " AND division2= '".$division2."'";
				$sgroup_by	= ", em_seq";
				$view = "3";
			}
			if($em_nm)  {
				$sem_name = "AND em_seq = '".$em_nm."'";
				$sgroup_by	= ", em_seq";
				$view = "3";
			}
		}else if($_SESSION['em_level']>=10){
			if($division1){
				switch($division1){
				case "all" :
					//echo "all";
						//$sdivision1 = "AND division1 = '".$division1."'";
						$sgroup_by = ", division1";
						$view = "1";
				break;
				default :
						$sdivision1 = "AND division1   = '".$division1."'";
						$sgroup_by = ", division2";
						$view = "2";
				break;
				}
			}

			if($division2){
				$sdivision2 = " AND division2= '".$division2."'";
				$sgroup_by	= ", em_seq";
				$view = "3";
			}

			if($em_nm)  {
				$sem_name = "AND em_seq = '".$em_nm."'";
				$sgroup_by	= ", em_seq";
				$view = "3";
			}
		}

		$Qry = "SELECT SQL_CALC_FOUND_ROWS
				good_type2,
				division1,
				division2,
				em_seq,
				ct_type,
				good_type1,
				SUM(pay_price ) tot_price,
				COUNT(pay_price ) tot_cnt
				FROM t_contract
				WHERE 1=1
				AND del_date IS NULL
				AND agree_state = '3'
				".$scal_kind."
				".$sdivision1."
				".$sdivision2."
				".$sem_name."
				GROUP BY good_type1, good_type2, ct_type
				".$sgroup_by."
				ORDER BY   (division1-0), (division2-0),(em_seq-0), pay_date, good_type1
			";

		//echo $Qry;
		//exit;
		$Rst = que($Qry);

		$nListCnt = 0 ;
		while ($Row = @mysql_fetch_assoc($Rst)) {
$S_RETURNVAL[$Row['good_type2']][$Row['division1']]['tot_price'] = $Row['tot_price'] ; //해당 상품의 본부의 총매출액
$S_RETURNVAL[$Row['good_type2']][$Row['division1']]['tot_cnt']   = $Row['tot_cnt'] ; //해당 상품의 본부의 총건수

$S_RETURNVAL[$Row['good_type2']][$Row['ct_type']][$Row['division1']]['tot_price'] = $Row['tot_price'] ; //해당 상품의 계약구분의 본부의 총매출액
$S_RETURNVAL[$Row['good_type2']][$Row['ct_type']][$Row['division1']]['tot_cnt']   = $Row['tot_cnt'] ; //해당 상품의 계약구분의 본부의 총건수




$S_RETURNVAL[$Row['good_type2']][$Row['division1']][$Row['division2']]['tot_price'] = $Row['tot_price'] ; //해당 상품의 본부의 총매출액
$S_RETURNVAL[$Row['good_type2']][$Row['division1']][$Row['division2']]['tot_cnt'] = $Row['tot_cnt'] ; //해당 상품의 본부의 총건수

$S_RETURNVAL[$Row['good_type2']][$Row['ct_type']][$Row['division1']][$Row['division2']]['tot_price'] = $Row['tot_price'] ; //해당 상품의 본부의 총매출액
$S_RETURNVAL[$Row['good_type2']][$Row['ct_type']][$Row['division1']][$Row['division2']]['tot_cnt'] = $Row['tot_cnt'] ; //해당 상품의 본부의 총건수




$S_RETURNVAL[$Row['good_type2']][$Row['division1']][$Row['division2']][$Row['em_seq']]['tot_price'] = $Row['tot_price'] ; //해당 상품의 본부의 총매출액
$S_RETURNVAL[$Row['good_type2']][$Row['division1']][$Row['division2']][$Row['em_seq']]['tot_cnt'] = $Row['tot_cnt'] ; //해당 상품의 본부의 총건수

$S_RETURNVAL[$Row['good_type2']][$Row['ct_type']][$Row['division1']][$Row['division2']][$Row['em_seq']]['tot_price'] = $Row['tot_price'] ; //해당 상품의 본부의 총매출액
$S_RETURNVAL[$Row['good_type2']][$Row['ct_type']][$Row['division1']][$Row['division2']][$Row['em_seq']]['tot_cnt'] = $Row['tot_cnt'] ; //해당 상품의 본부의 총건수




$S_RETURNVAL[$Row['good_type2']][$Row['ct_type']][$Row['division1']][$Row['division2']][$Row['em_seq']]['tot_price'] = $Row['tot_price'] ; //해당 상품의 본부의 총매출액
$S_RETURNVAL[$Row['good_type2']][$Row['ct_type']][$Row['division1']][$Row['division2']][$Row['em_seq']]['tot_cnt'] = $Row['tot_cnt'] ; //해당 상품의 본부의 총건수

		$S_RETURNVAL['good_type2'][]	= $Row['good_type2'];
		$S_RETURNVAL['division1'][]		= $Row['division1'];
		$S_RETURNVAL['division2'][]		= $Row['division2'];
		$S_RETURNVAL['em_seq'][]		= $Row['em_seq'];
		$S_RETURNVAL['view']			= $view;

		$nListCnt++;
		}

		$S_RETURNVAL['nListCnt'] = $nListCnt;
		@mysql_free_result($Rst);

		$Qry1 = 'SELECT FOUND_ROWS() N_CNT ';
		$Rst1 = @mysql_query($Qry1);
		$Row1 = @mysql_fetch_assoc($Rst1);

		return $S_RETURNVAL;

		que_close();

	}
	}


	public function funcDailySales($cal_kind,$syear,$smonth,$sday,$eyear,$emonth,$eday){

		//echo $_SESSION['em_level'];
		//echo "_GET['division1']=>".$_GET['division1'];
		//echo "_GET['division2']=>".$_GET['division2'];
		//echo "_GET['em_nm']=>".$_GET['em_nm'];
/*
		if($_GET['division1']){
			$division1 = implode(",",$_GET["division1"]);
			$where_division1 = "AND division1 IN (".$division1.")";
		}

		if($_GET['division2']){
			$division2 = implode(",",$_GET["division2"]);
			$where_division2 = "AND division2 IN (".$division2.")";
		}

		if($_GET['em_seq'])    {$where_em_seq    = "AND em_seq    =   '".$_GET['em_seq']."'";}


		//if($_GET['division1']!="all"){$where_division1 = "AND division1= '".$_GET['division1']."'";}
		//if($_GET['division2']){$where_division2 = "AND division2 = '".$_GET['division2']."'" ;}

		if($_SESSION['em_level']>=40){
			$where_em_seq = "AND em_seq = '".$_SESSION['s_em_seq']."'";
			//echo "40";
		}else if($_SESSION['em_level']>=30){
			//echo "30";
			if($_GET['em_seq']){
				//echo $_GET['em_seq'];
				$where_division2 = "AND division1 ='".$_SESSION['em_division1']."' AND division2='".$_SESSION['em_division2']."'";
				$where_em_seq    = "AND em_seq    ='".$_GET['em_seq']."'";
			}else{
				$where_division2 = "AND division1 ='".$_SESSION['em_division1']."' AND division2='".$_SESSION['em_division2']."'";
			}
		}else if($_SESSION['em_level']>=20){
			//echo "20";

			//echo $_GET['division2'];

			if($_GET['division2']){
				$division2 = implode(",",$_GET["division2"]);
				$where_division2 = "AND division2 IN (".$division2.")";
			}

			if($_GET['em_seq']){
				//echo $_GET['em_seq'];
				$where_division1 = "AND division1 ='".$_SESSION['em_division1']."'";
				$where_em_seq    = "AND em_seq    ='".$_GET['em_seq']."'";
			}else{
				$where_division1 = "AND division1 ='".$_SESSION['em_division1']."'";
			}
		}else if($_SESSION['em_level']<=10){
			//echo "10";
			if($_GET['em_seq']){
				//echo $_GET['em_seq'];
				$where_em_seq = "AND em_seq = '".$_GET['em_seq']."'";
			}
			//if($_GET['division1'])			  {$where_division1   = "AND division1 = '".$_GET['division1']."'";}

			if($_GET['division1']){
				$division1 = implode(",",$_GET["division1"]);
				$where_division1 = "AND division1 IN (".$division1.")";
			}

			if($_GET['division2']){
				$division2 = implode(",",$_GET["division2"]);
				$where_division2 = "AND division2 IN (".$division2.")";
			}

		}
*/

		if($_SESSION['em_level']==40){
			$where_em_seq = "AND em_seq = '".$_SESSION['s_em_seq']."'";
			//echo "40";
		}else{
			//echo "10";
			/*
			if($_GET['em_seq']){
				//echo $_GET['em_seq'];
				$where_em_seq = "AND em_seq = '".$_GET['em_seq']."'";
			}

			if($_GET['em_seq1']){
				//echo $_GET['em_seq'];
				$where_em_seq1 = "AND em_seq = '".$_GET['em_seq1']."'";
			}
			*/

			if($_GET['division1']){
				$division1 = implode(",",$_GET["division1"]);
				$where_division1 = "AND division1 IN (".$division1.")";
			}

			if($_GET['division2']){
				$division2 = implode(",",$_GET["division2"]);
				$where_division2 = "AND division2 IN (".$division2.")";
			}

			// 상품구분에서 개별 선택 할 경우
			if($_GET["good_type2"]) {
				$good_type2 = implode(",",$_GET["good_type2"]);
				$where_goodtype2 = "AND good_type2 IN (".$good_type2.")";
			}
			// 상풍구분에서 최상위 상품 선택할 경우(다음, 네이버 등등)
			if($_GET['good_type2_all']) {
				$good_type2 = implode(",",$_GET["good_type2_all"]);				
				$where_goodtype2 = "AND good_type2 IN (".getGoodTypeString($good_type2).")";
			}
		}

/*
		if($_SESSION['em_level']<=10){
			if($_GET['division1'])	{$where_division1	= "AND division1 ='".$_GET['division1']."'";}
			if($_GET['division2'])	{$where_division2	= "AND division2 ='".$_GET['division2']."'";}
			if($_GET['em_seq'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq']."'";}
			if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq	 ='".$_GET['em_seq1']."'";}
		}else if($_SESSION['em_level']<=20){
			$where_division1 = "AND division1 ='".$_SESSION['em_division1']."'";
			if($_GET['division2'])	{$where_division2	= "AND division2 ='".$_GET['division2']."'";}
			if($_GET['em_seq'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq']."'";}
			if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq    = '".$_GET['em_seq1']."'";}
		}else if($_SESSION['em_level']<=30){
			$where_division2 = "AND division1 ='".$_SESSION['em_division1']."' 
								AND division2 ='".$_SESSION['em_division2']."'";
			if($_GET['em_seq'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq']."'";}
			if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}
		}else if($_SESSION['em_level']<=40){
			$where_em_seq = "AND em_seq = '".$_SESSION['s_em_seq']."'";
		}
*/

		switch($cal_kind){
			case "d" :$sreg_date = "pay_date as pay_date";			$sgroup_by="GROUP BY pay_date";		   break;
			//case "m" :$sreg_date = "left(pay_date,7) as pay_date";	$sgroup_by="GROUP BY left(pay_date,7)";break;
			case "m" :$sreg_date = "pay_date as pay_date";			$sgroup_by="GROUP BY pay_date";		   break;
			case "wd" :$sreg_date = "pay_date as pay_date";			$sgroup_by="GROUP BY pay_date";		   break;
			case "w" :$sreg_date = "pay_date as pay_date";			$sgroup_by="GROUP BY pay_date";		   break;
			case "y" :$sreg_date = "pay_date as pay_date";			$sgroup_by="GROUP BY pay_date";		   break;
		}


//if($_SESSION['s_em_seq']=='14'){
	
	

	if($_SESSION['em_level']==10){
			if($_GET["type_member"]=="2"){
				if($_GET['em_nm'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_nm']."'";}
				if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}

				if($_GET['division1']){
				$division1 = implode(",",$_GET["division1"]);
				$where_division1 = "AND division1 IN (".$division1.")";
				}

				if($_GET['division2']){
					$division2 = implode(",",$_GET["division2"]);
					$where_division2 = "AND division2 IN (".$division2.")";
				}

			}else{
				$get_emseq	= funGetEmSeq($_GET['division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq1']."'";
				$_GET['em_seq']==""?$where_em_seq1 = "":$where_em_seq1= "AND em_seq ='".$_GET['em_seq']."'";
				
			}
		}else if($_SESSION['em_level']==20){
			if($_GET["type_member"]=="2"){		
				$where_division1 = "AND division1 ='".$_SESSION['em_division1']."'";
				
				if($_GET['division2'])	{$where_division2	= "AND division2 ='".$_GET['division2']."'";}
				if($_GET['em_nm'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_nm']."'";}
				if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq1']."'";
				$_GET['em_seq']==""?$where_em_seq1 = "":$where_em_seq1= "AND em_seq ='".$_GET['em_seq']."'";
			}
		}else if($_SESSION['em_level']==30){
			if($_GET["type_member"]=="2"){
				$where_division2 = "AND division1 ='".$_SESSION['em_division1']."' 
									AND division2 ='".$_SESSION['em_division2']."'";

				if($_GET['em_seq'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq']."'";}
				if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}

				//$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_SESSION['em_division2']);
				
			}else{
				$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_SESSION['em_division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq1']."'";
				$_GET['em_seq']==""?$where_em_seq1 = "":$where_em_seq1= "AND em_seq ='".$_GET['em_seq']."'";

			}
		}else if($_SESSION['em_level']==40){
			$where_em_seq = "AND em_seq = '".$_SESSION['s_em_seq']."'";
		}


//}


			$Qry = "SELECT $sreg_date,
					SUM(CASE WHEN m_nm='264' AND good_type2 != '806' AND sales_type='1' THEN pay_price ELSE 0 END) AS 'naver_cpc',
					SUM(CASE WHEN m_nm='265' AND sales_type='1' THEN pay_price ELSE 0 END) AS 'google',
					SUM(CASE WHEN m_nm='266' AND sales_type='1' THEN pay_price ELSE 0 END) AS 'overture',
					SUM(CASE WHEN m_nm='41'  AND sales_type='1' THEN pay_price ELSE 0 END) AS 'clix',
					SUM(CASE WHEN m_nm='496' AND sales_type='1' THEN pay_price ELSE 0 END) AS 'ebay',	
					SUM(CASE WHEN m_nm='406' AND sales_type='1' THEN pay_price ELSE 0 END) AS 'nvistar',	
					SUM(CASE WHEN m_nm='264' AND good_type2 = '806' AND sales_type='1' THEN pay_price ELSE 0 END) AS 'pc',	
					SUM(CASE WHEN m_nm='302' AND sales_type='1' THEN pay_price ELSE 0 END) AS 'etc_cpc',
					SUM(CASE WHEN m_nm='808' AND sales_type='1' THEN pay_price ELSE 0 END) AS 'st11_cpc',
					
					SUM(CASE WHEN m_nm='264' AND sales_type='3' THEN pay_price ELSE 0 END) AS 'naver_cpm',		
					SUM(CASE WHEN m_nm='41'  AND sales_type='3' THEN pay_price ELSE 0 END) AS 'daum',
					SUM(CASE WHEN m_nm='42'  AND sales_type='3' THEN pay_price ELSE 0 END) AS 'nate',
					SUM(CASE WHEN m_nm='302' AND sales_type='3' THEN pay_price ELSE 0 END) AS 'etc_cpm',
					SUM(CASE WHEN m_nm='383' AND sales_type='3' THEN pay_price ELSE 0 END) AS 'combine',
					SUM(pay_price) AS tot
				FROM t_contract
				WHERE pay_date BETWEEN '".$syear."-".$smonth."-".$sday."' AND '".$eyear."-".$emonth."-".$eday."'
				AND del_date IS NULL
				AND agree_state='3'
				AND sales_type IN ('1','3')
				".$where_division1."
				".$where_division2."
				".$where_em_seq."
				".$where_em_seq1."
				".$where_goodtype2."
				GROUP BY pay_date";
if($_SESSION['s_em_seq']=='14' || $_SESSION['s_em_seq']=='1161' ){
		//echo $Qry;
}
		
		$Rst = que($Qry);

		$nListCnt = 0 ;
		while ($Row = @mysql_fetch_assoc($Rst)) {
			$S_RETURNVAL['pay_year'][substr($Row['pay_date'],0,4)]									= substr($Row['pay_date'],0,4);
			$S_RETURNVAL['pay_month'][substr($Row['pay_date'],0,7)]									= substr($Row['pay_date'],0,7);
			$S_RETURNVAL['pay_day'][substr($Row['pay_date'],0,7)][substr($Row['pay_date'],8,2)]		= substr($Row['pay_date'],8,2);

			$S_RETURNVAL['pay_date'][$Row['pay_date']]					= $Row['pay_date'];
			$S_RETURNVAL['naverc'][$Row['pay_date']]					= $Row['naver_cpc'];
			$S_RETURNVAL['overture'][$Row['pay_date']]					= $Row['overture'];
			$S_RETURNVAL['google'][$Row['pay_date']]					= $Row['google'];
			$S_RETURNVAL['clix'][$Row['pay_date']]						= $Row['clix'];
			$S_RETURNVAL['pops'][$Row['pay_date']]						= $Row['pops'];
			$S_RETURNVAL['pc'][$Row['pay_date']]						= $Row['pc'];
			$S_RETURNVAL['etc_cpc'][$Row['pay_date']]					= $Row['etc_cpc'];
			$S_RETURNVAL['st11_cpc'][$Row['pay_date']]					= $Row['st11_cpc'];

			$S_RETURNVAL['nvistar'][$Row['pay_date']]					= $Row['nvistar'];
			$S_RETURNVAL['ebay'][$Row['pay_date']]						= $Row['ebay'];
			$S_RETURNVAL['nate'][$Row['pay_date']]						= $Row['nate'];
			$S_RETURNVAL['daum'][$Row['pay_date']]						= $Row['daum'];
			$S_RETURNVAL['combine'][$Row['pay_date']]					= $Row['combine'];
			$S_RETURNVAL['naver'][$Row['pay_date']]						= $Row['naver_cpm'];
			$S_RETURNVAL['etc'][$Row['pay_date']]						= $Row['etc_cpm'];
			//$S_RETURNVAL['tot'][$Row['pay_date']]						= $Row['tot'];
			$S_RETURNVAL['tot'][$Row['pay_date']]						= $Row['naver_cpc']+$Row['google']+$Row['clix']+$Row['pc']+$Row['etc_cpc']+$Row['ebay']+$Row['nate']+$Row['daum']+$Row['combine']+$Row['naver_cpm']+$Row['etc_cpm'];

			$S_RETURNVAL['nate_sales'][$Row['pay_date']]				= $Row['nate_sales'];
			$S_RETURNVAL['daum_sales'][$Row['pay_date']]				= $Row['daum_sales'];
			$S_RETURNVAL['combine_sales'][$Row['pay_date']]				= $Row['combine_sales'];
			$S_RETURNVAL['naver_sales'][$Row['pay_date']]				= $Row['naver_sales'];
			$S_RETURNVAL['etc_sales'][$Row['pay_date']]					= $Row['etc_sales'];
			$S_RETURNVAL['tot_sales'][$Row['pay_date']]					= $Row['tot_sales'];

			$S_RETURNVAL['nate_sales_cnt'][$Row['pay_date']]			= $Row['nate_sales_cnt'];
			$S_RETURNVAL['daum_sales_cnt'][$Row['pay_date']]			= $Row['daum_sales_cnt'];
			$S_RETURNVAL['combine_sales_cnt'][$Row['pay_date']]			= $Row['combine_sales_cnt'];
			$S_RETURNVAL['naver_sales_cnt'][$Row['pay_date']]			= $Row['naver_sales_cnt'];
			$S_RETURNVAL['etc_sales_cnt'][$Row['pay_date']]				= $Row['etc_sales_cnt'];
			$S_RETURNVAL['tot_sales_cnt'][$Row['pay_date']]				= $Row['tot_sales_cnt'];

			$S_RETURNVAL['nate_transfer_in'][$Row['pay_date']]			= $Row['nate_transfer_in'];
			$S_RETURNVAL['daum_transfer_in'][$Row['pay_date']]			= $Row['daum_transfer_in'];
			$S_RETURNVAL['combine_transfer_in'][$Row['pay_date']]		= $Row['combine_transfer_in'];
			$S_RETURNVAL['naver_transfer_in'][$Row['pay_date']]			= $Row['naver_transfer_in'];
			$S_RETURNVAL['etc_transfer_in'][$Row['pay_date']]			= $Row['etc_transfer_in'];

			$S_RETURNVAL['nate_transfer_out'][$Row['pay_date']]			= $Row['nate_transfer_out'];
			$S_RETURNVAL['daum_transfer_out'][$Row['pay_date']]			= $Row['daum_transfer_out'];
			$S_RETURNVAL['combine_transfer_out'][$Row['pay_date']]		= $Row['combine_transfer_out'];
			$S_RETURNVAL['naver_transfer_out'][$Row['pay_date']]		= $Row['naver_transfer_out'];
			$S_RETURNVAL['etc_transfer_out'][$Row['pay_date']]			= $Row['etc_transfer_out'];

			$S_RETURNVAL['nate_transfer_in_cnt'][$Row['pay_date']]		= $Row['nate_transfer_in_cnt'];
			$S_RETURNVAL['daum_transfer_in_cnt'][$Row['pay_date']]		= $Row['daum_transfer_in_cnt'];
			$S_RETURNVAL['combine_transfer_in_cnt'][$Row['pay_date']]	= $Row['combine_transfer_in_cnt'];
			$S_RETURNVAL['naver_transfer_in_cnt'][$Row['pay_date']]		= $Row['naver_transfer_in_cnt'];
			$S_RETURNVAL['etc_transfer_in_cnt'][$Row['pay_date']]		= $Row['etc_transfer_in_cnt'];
			$S_RETURNVAL['tot_transfer_in'][$Row['pay_date']]			= $Row['tot_transfer_in'];
			$S_RETURNVAL['tot_transfer_in_cnt'][$Row['pay_date']]		= $Row['tot_transfer_in_cnt'];

			$S_RETURNVAL['nate_transfer_out_cnt'][$Row['pay_date']]		= $Row['nate_transfer_out_cnt'];
			$S_RETURNVAL['daum_transfer_out_cnt'][$Row['pay_date']]		= $Row['daum_transfer_out_cnt'];
			$S_RETURNVAL['combine_transfer_out_cnt'][$Row['pay_date']]	= $Row['combine_transfer_out_cnt'];
			$S_RETURNVAL['naver_transfer_out_cnt'][$Row['pay_date']]	= $Row['naver_transfer_out_cnt'];
			$S_RETURNVAL['etc_transfer_out_cnt'][$Row['pay_date']]		= $Row['etc_transfer_out_cnt'];
			$S_RETURNVAL['tot_transfer_out'][$Row['pay_date']]			= $Row['tot_transfer_out'];
			$S_RETURNVAL['tot_transfer_out_cnt'][$Row['pay_date']]		= $Row['tot_transfer_out_cnt'];


			$S_RETURNVAL['nate_cancel'][$Row['pay_date']]				= $Row['nate_cancel'];
			$S_RETURNVAL['daum_cancel'][$Row['pay_date']]				= $Row['daum_cancel'];
			$S_RETURNVAL['combine_cancel'][$Row['pay_date']]			= $Row['combine_cancel'];
			$S_RETURNVAL['naver_cancel'][$Row['pay_date']]				= $Row['naver_cancel'];
			$S_RETURNVAL['etc_cancel'][$Row['pay_date']]				= $Row['etc_cancel'];
			$S_RETURNVAL['tot_cancel'][$Row['pay_date']]				= $Row['tot_cancel'];
			$S_RETURNVAL['nate_cancel_cnt'][$Row['pay_date']]			= $Row['nate_cancel_cnt'];
			$S_RETURNVAL['daum_cancel_cnt'][$Row['pay_date']]			= $Row['daum_cancel_cnt'];
			$S_RETURNVAL['combine_cancel_cnt'][$Row['pay_date']]		= $Row['combine_cancel_cnt'];
			$S_RETURNVAL['naver_cancel_cnt'][$Row['pay_date']]			= $Row['naver_cancel_cnt'];
			$S_RETURNVAL['etc_cancel_cnt'][$Row['pay_date']]			= $Row['etc_cancel_cnt'];
			$S_RETURNVAL['tot_cancel_cnt'][$Row['pay_date']]			= $Row['tot_cancel_cnt'];

			$S_RETURNVAL['nate_back'][$Row['pay_date']]					= $Row['nate_back'];
			$S_RETURNVAL['daum_back'][$Row['pay_date']]					= $Row['daum_back'];
			$S_RETURNVAL['combine_back'][$Row['pay_date']]				= $Row['combine_back'];
			$S_RETURNVAL['naver_back'][$Row['pay_date']]				= $Row['naver_back'];
			$S_RETURNVAL['etc_back'][$Row['pay_date']]					= $Row['etc_back'];
			$S_RETURNVAL['tot_back'][$Row['pay_date']]					= $Row['tot_back'];
			$S_RETURNVAL['nate_back_cnt'][$Row['pay_date']]				= $Row['nate_back_cnt'];
			$S_RETURNVAL['daum_back_cnt'][$Row['pay_date']]				= $Row['daum_back_cnt'];
			$S_RETURNVAL['combine_back_cnt'][$Row['pay_date']]			= $Row['combine_back_cnt'];
			$S_RETURNVAL['naver_back_cnt'][$Row['pay_date']]			= $Row['naver_back_cnt'];
			$S_RETURNVAL['etc_back_cnt'][$Row['pay_date']]				= $Row['etc_back_cnt'];
			$S_RETURNVAL['tot_back_cnt'][$Row['pay_date']]				= $Row['tot_back_cnt'];

			$nListCnt++;
		}
		$S_RETURNVAL['nListCnt'] = $nListCnt;

		return $S_RETURNVAL;

		que_close();
	}

	public function funcKeepSales(){
		/*
		if($_SESSION['em_level']==40){
			$where_em_seq = "AND em_seq = '".$_SESSION['s_em_seq']."'";
			//echo "40";
		}else{
			//echo "10";
			if($_GET['em_seq']){
				//echo $_GET['em_seq'];
				$where_em_seq = "AND em_seq = '".$_GET['em_seq']."'";
			}		
		}
		*/

		


		if($_GET['good_type2']){
				$good_type2 = implode(",",$_GET["good_type2"]);
				$where_good_type2 = "AND good_type2 IN (".$good_type2.")";
		}
		
		if($_GET['good_type1']){
				//$good_type2 = implode(",",$_GET["good_type2"]);
				$where_good_type2 = "AND good_type1 IN (".$_GET['good_type1'].")";
		}
		

		if($_GET['division1']){
				$where_division1 = "AND division1 IN (".$_GET['division1'].")";
				$view = "2";
		}else{
				$view = "1";
		}

		if($_GET['division2']){
				$where_division2 = "AND division2 IN (".$_GET['division2'].")";
				$view = "3";
		}


		if($_SESSION['em_level']==10){
			if($_GET["type_member"]=="2"){
				if($_GET['division1'])	{$where_division1	= "AND division1 ='".$_GET['division1']."'";}
				if($_GET['division2'])	{$where_division2	= "AND division2 ='".$_GET['division2']."'";}
				if($_GET['em_nm'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_nm']."'";}
				if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq	 ='".$_GET['em_seq1']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_GET['division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_nm']."'";
			}
		}else if($_SESSION['em_level']==20){
			if($_GET["type_member"]=="2"){			

				$where_division1 = "AND division1 ='".$_SESSION['em_division1']."'";
				
				if($_GET['division2'])	{$where_division2	= "AND division2 ='".$_GET['division2']."'";}
				if($_GET['em_nm'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_nm']."'";}
				if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_nm']."'";
			
			}
		}else if($_SESSION['em_level']==30){
			if($_GET["type_member"]=="2"){
				$where_division2 = "AND division1 ='".$_SESSION['em_division1']."' 
									AND division2 ='".$_SESSION['em_division2']."'";

				if($_GET['em_nm'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_nm']."'";}
				if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}

			}else{
				
				$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_SESSION['em_division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_nm']."'";
			}
			
		}else if($_SESSION['em_level']==40){
			$where_em_seq = "AND em_seq = '".$_SESSION['s_em_seq']."'";
		}

if($_GET['s_date']&&$_GET['e_date']){
		$Qry = "
				SELECT 		good_type2,
							division1,
							division2,
							em_seq,
							SUM(pay_price) as  pay_price,
							good_type1
							FROM t_contract
							WHERE 1=1							
							AND pay_date >= '".$_GET['s_date']."'
							AND pay_date <= '".$_GET['e_date']."'
							".$where_division1."
							".$where_division2."
							".$where_good_type1."
							".$where_good_type2."
							".$where_em_seq."
							AND del_date IS NULL
							AND sales_type IN (1,3)
							AND agree_state = '3'
							GROUP BY division1, division2, em_seq, good_type2
							ORDER BY (m_nm-0), (division1-0),(division2-0), (em_seq-0),(good_type2-0)  ";

		//echo $Qry;
		$Rst = que($Qry);

		$nListCnt = 0 ;
		while ($Row = @mysql_fetch_assoc($Rst)) {
			
			$S_RETURNVAL['pay_price1'][$Row['division1']][$Row['good_type2']]										+= $Row['pay_price'];
			$S_RETURNVAL['pay_price2'][$Row['division1']][$Row['division2']][$Row['good_type2']]					+= $Row['pay_price'];
			$S_RETURNVAL['pay_price3'][$Row['division1']][$Row['division2']][$Row['em_seq']][$Row['good_type2']]	+= $Row['pay_price'];

			$S_RETURNVAL['good_type2'][$Row['good_type2']]	= $Row['good_type2'];
			$S_RETURNVAL['division1'][$Row['division1']]	= $Row['division1'];
			$S_RETURNVAL['division2'][$Row['division2']]	= $Row['division2'];
			$S_RETURNVAL['em_seq'][$Row['em_seq']]			= $Row['em_seq'];

			$nListCnt++;
		}
		$S_RETURNVAL['nListCnt']							= $nListCnt;
		$S_RETURNVAL['view']								= $view;

		return $S_RETURNVAL;

		que_close();
}	
	}

	public function funcDiviDetailDaySales($syear,$smonth,$sday,$eyear,$emonth,$eday){
		if($_GET['division1']){
			$Qry = "
					SELECT ct_group,pay_date, sum(pay_price) AS pay_price, count(pay_price) AS pay_cnt,
					division1, division2, good_type1, good_type2, ct_type, sales_type, agree_state
					FROM t_contract
					WHERE m_nm IN ('383', '41','42', '264', '265', '266', '406','302') 
					AND pay_date >= '".$_GET['s_date']."'
					AND pay_date <= '".$_GET['e_date']."'
					AND division1='".$_GET['division1']."'
					AND agree_state='3'
					AND CASE good_type1='22' WHEN sales_type='1' THEN sales_type END
					AND CASE good_type1='23' WHEN sales_type='3' THEN sales_type END
					AND del_date IS NULL
					GROUP BY ct_group, good_type1, good_type2, ct_type, division2
					ORDER BY pay_date
			";
			//echo $Qry;good_type2 IN (34,35,30,31,29,32,26,27,25,28,39,323,324,325,33,327,326)
			$Rst = que($Qry);

			$nListCnt = 0 ;
			while ($Row = @mysql_fetch_assoc($Rst)) {

				$S_RETURNVAL[$Row['good_type2']][$Row['ct_type']][$Row['division2']]['pay_price']  += $Row['pay_price'];
				$S_RETURNVAL[$Row['good_type2']][$Row['ct_type']][$Row['division2']]['pay_cnt']    += $Row['pay_cnt'];

				$S_RETURNVAL[$Row['good_type2']][$Row['division2']]['pay_price']  += $Row['pay_price'];
				$S_RETURNVAL[$Row['good_type2']][$Row['division2']]['pay_cnt']    += $Row['pay_cnt'];
		

				//$S_RETURNVAL[$Row['pay_date']][$Row['good_type2']][$Row['ct_type']][$Row['division2']]['pay_price']  = $Row['pay_price'];
				//$S_RETURNVAL[$Row['pay_date']][$Row['good_type2']][$Row['ct_type']][$Row['division1']][$Row['division2']]  = $Row['pay_price'];

				$S_RETURNVAL['pay_date'][]						= $Row['pay_date'];
				$S_RETURNVAL['good_type2'][]					= $Row['good_type2'];
				$S_RETURNVAL['division1'][]						= $Row['division1'];
				$S_RETURNVAL['division2'][]						= $Row['division2'];
				$S_RETURNVAL['ct_type'][]						= $Row['ct_type'];

				$nListCnt++;
			}
			$S_RETURNVAL['nListCnt'] = $nListCnt;

			return $S_RETURNVAL;
		}
	}

	public function funcAdTypeChartSales($syear,$smonth,$sday,$eyear,$emonth,$eday){
		if($_GET['division1']){
			$Qry = "
			SELECT ct_type, SUM(pay_price) AS pay_price,division1, division2, good_type2, ad_type FROM t_contract
			WHERE good_type2 IN (25,26,27)
			AND pay_date >= '".$_GET['s_date']."'
			AND pay_date <= '".$_GET['e_date']."'
			AND division1='".$_GET['division1']."'
			AND good_type1='23'
			AND agree_state='3'
			AND sales_type='3'
			AND del_date IS NULL
			GROUP BY good_type2, ad_type, ct_type, division2
			ORDER BY pay_date";

			//echo $Qry;
			$Rst = que($Qry);

			$nListCnt = 0 ;
			while ($Row = @mysql_fetch_assoc($Rst)) {

			$S_RETURNVAL[$Row['good_type2']][$Row['ad_type']]['pay_price']  += $Row['pay_price'];
			$S_RETURNVAL[$Row['good_type2']]['pay_price']  += $Row['pay_price'];

			$nListCnt++;
			}
			$S_RETURNVAL['nListCnt'] = $nListCnt;

			return $S_RETURNVAL;

			que_close();
		}
	}

	public function funcTargetSales($syear,$smonth,$sday,$eyear,$emonth,$eday){
		if($_GET['division1']){
			$Qry = "
SELECT * FROM (
SELECT division1, division2, em_seq, good_type2, CONCAT(reg_year,'-',target_month) AS target_ym,  SUM(target_price) AS target_price FROM (
	SELECT division1, division2, em_seq, good_type2, reg_year, '01' AS target_month , reg_m1 AS target_price FROM t_product WHERE del_date IS NULL AND division1='".$_GET['division1']."'
	UNION ALL
	SELECT division1, division2, em_seq, good_type2, reg_year, '02' AS target_month , reg_m2 AS target_price  FROM t_product WHERE del_date IS NULL  AND division1='".$_GET['division1']."'
	UNION ALL
	SELECT division1, division2, em_seq, good_type2, reg_year, '03' AS target_month , reg_m3 AS target_price  FROM t_product WHERE del_date IS NULL  AND division1='".$_GET['division1']."'
	UNION ALL
	SELECT division1, division2, em_seq, good_type2, reg_year, '04' AS target_month , reg_m4 AS target_price  FROM t_product WHERE del_date IS NULL  AND division1='".$_GET['division1']."'
	UNION ALL
	SELECT division1, division2, em_seq, good_type2, reg_year, '05' AS target_month , reg_m5 AS target_price  FROM t_product WHERE del_date IS NULL  AND division1='".$_GET['division1']."'
	UNION ALL
	SELECT division1, division2, em_seq, good_type2, reg_year, '06' AS target_month , reg_m6 AS target_price  FROM t_product WHERE del_date IS NULL  AND division1='".$_GET['division1']."'
	UNION ALL
	SELECT division1, division2, em_seq, good_type2, reg_year, '07' AS target_month , reg_m7 AS target_price  FROM t_product WHERE del_date IS NULL  AND division1='".$_GET['division1']."'
	UNION ALL
	SELECT division1, division2, em_seq, good_type2, reg_year, '08' AS target_month , reg_m8 AS target_price  FROM t_product WHERE del_date IS NULL  AND division1='".$_GET['division1']."'
	UNION ALL
	SELECT division1, division2, em_seq, good_type2, reg_year, '09' AS target_month , reg_m9 AS target_price  FROM t_product WHERE del_date IS NULL  AND division1='".$_GET['division1']."'
	UNION ALL
	SELECT division1, division2, em_seq, good_type2, reg_year, '10' AS target_month , reg_m10 AS target_price  FROM t_product WHERE del_date IS NULL  AND division1='".$_GET['division1']."'
	UNION ALL
	SELECT division1, division2, em_seq, good_type2, reg_year, '11' AS target_month , reg_m11 AS target_price  FROM t_product WHERE del_date IS NULL  AND division1='".$_GET['division1']."'
	UNION ALL
	SELECT division1, division2, em_seq, good_type2, reg_year, '12' AS target_month , reg_m12 AS target_price  FROM t_product WHERE del_date IS NULL  AND division1='".$_GET['division1']."'
	) aaaaa
GROUP BY division1, division2, good_type2, target_ym
) bbbbb
WHERE target_ym >= '".substr($_GET['s_date'],0,7)."'
AND target_ym <= '".substr($_GET['e_date'],0,7)."'";


			//echo "<br>".$Qry;
			$Rst = que($Qry);

			$nListCnt = 0 ;
			while ($Row = @mysql_fetch_assoc($Rst)) {

			$S_RETURNVAL_TARGET[$Row['good_type2']][$Row['division2']]['target_price']  += $Row['target_price'];

			$nListCnt++;
			}
			$S_RETURNVAL_TARGET['nListCnt'] = $nListCnt;

			return $S_RETURNVAL_TARGET;

			que_close();

		}
	}

	public function funcCtCount($division1,$division2){
		//$division1 = $_GET['division1'];
		//$division2 = $_GET['division2'];
		$em_nm	   = $_GET['em_nm'];

//echo "<br>division1=>".$division1;
//echo "<br>division2=>".$division2."<br>";
		//echo $em_nm;
		//echo $_SESSION['em_level'];

		if($_SESSION['em_level']>=40){
			if($em_nm)  {
				$where_em_seq = "AND em_seq = '".$em_nm."'";
				$sgroup_by	= ", em_seq";
				$view = "3";
			}
		}else if($_SESSION['em_level']>=20){
			if($division1){
				$where_division1 = "AND division1   = '".$division1."'";
				$sgroup_by = ", division2";
				$view = "2";
			}
			if($division2){
				$where_division2 = " AND division2= '".$division2."'";
				$sgroup_by	= ", em_seq";
				$view = "3";
			}
			if($em_nm)  {
				$where_em_seq = "AND em_seq = '".$em_nm."'";
				$sgroup_by	= ", em_seq";
				$view = "3";
			}
		}else if($_SESSION['em_level']<=10){
			if($division1){
				switch($division1){
				case "all" :
					//echo "all";
						//$sdivision1 = "AND division1 = '".$division1."'";
						$sgroup_by = ", division1";
						$view = "1";
				break;
				default :
						$where_division1 = "AND division1   = '".$division1."'";
						$sgroup_by = ", division2";
						$view = "2";
				break;
				}
			}

			if($division2){
				$where_division2 = " AND division2= '".$division2."'";
				$sgroup_by	= ", em_seq";
				$view = "3";
			}

			if($em_nm)  {
				$where_em_seq = "AND em_seq = '".$em_nm."'";
				$sgroup_by	= ", em_seq";
				$view = "3";
			}
		}

		$Qry = "SELECT
					COUNT(CASE WHEN ct_yn='Y' THEN ct_yn END) AS 'Y',
					COUNT(CASE WHEN ct_yn='N' THEN ct_yn END) AS 'N',
					COUNT(ct_yn) AS 'YN',
					a.division1,
					a.division2,
					a.em_seq
				FROM (
					SELECT DISTINCT(ct_group), ct_seq, division1, division2, em_seq, ct_yn
					FROM t_contract
					WHERE 1=1
					AND pay_date >= '".$_GET['s_date']."'
					AND pay_date <= '".$_GET['e_date']."'
					AND agree_state = '3'
					AND sales_type IN (2,3)
					AND del_date IS NULL
					".$where_division1."
					".$where_division2."
					".$where_em_seq."
					GROUP BY ct_group
				) a
				GROUP BY division1, division2, em_seq
				with rollup";
		//echo $Qry;
		$Rst = que($Qry);

		$nListCnt = 0 ;
		while ($Row = @mysql_fetch_assoc($Rst)) {

		$S_RETURNVAL[$Row['division1']]['Y']  = $Row['Y'];
		$S_RETURNVAL[$Row['division1']]['N']  = $Row['N'];
		$S_RETURNVAL[$Row['division1']]['YN'] = $Row['YN'];

		$S_RETURNVAL[$Row['division1']][$Row['division2']]['Y']  = $Row['Y'];
		$S_RETURNVAL[$Row['division1']][$Row['division2']]['N']  = $Row['N'];
		$S_RETURNVAL[$Row['division1']][$Row['division2']]['YN'] = $Row['YN'];

		$S_RETURNVAL[$Row['division1']][$Row['division2']][$Row['em_seq']]['Y']  = $Row['Y'];
		$S_RETURNVAL[$Row['division1']][$Row['division2']][$Row['em_seq']]['N']  = $Row['N'];
		$S_RETURNVAL[$Row['division1']][$Row['division2']][$Row['em_seq']]['YN'] = $Row['YN'];

		$S_RETURNVAL['division1'][]		 = $Row['division1'];
		$S_RETURNVAL['division2'][]		 = $Row['division2'];
		$S_RETURNVAL['em_seq'][]		 = $Row['em_seq'];
		$S_RETURNVAL['Y'][]				 = $Row['Y'];
		$S_RETURNVAL['N'][]				 = $Row['N'];
		$S_RETURNVAL['YN'][]			 = $Row['YN'];

		$S_RETURNVAL['pay_date'][]		 = $Row['pay_date'];
		$S_RETURNVAL['ct_type'][]		 = $Row['ct_type'];

		$division1_count[$Row['division1']]++;
		$division2_count[$Row['division1']][$Row['division2']]++;

		//$S_RETURNVAL[$Row['division1']][$Row['division2']][$Row['em_seq']]		= $Row['em_seq'];

		$S_RETURNVAL['view']			= $view;

		$nListCnt++;
		}
		$S_RETURNVAL['division1_count'] = $division1_count;
		$S_RETURNVAL['division2_count'] = $division2_count;

		$S_RETURNVAL['nListCnt'] = $nListCnt;
		@mysql_free_result($Rst);

		$Qry1 = 'SELECT FOUND_ROWS() N_CNT ';
		$Rst1 = @mysql_query($Qry1);
		$Row1 = @mysql_fetch_assoc($Rst1);

		return $S_RETURNVAL;

		que_close();
	}


	public function funcBusiLicenseCount($division1,$division2){
		//$division1 = $_GET['division1'];
		//$division2 = $_GET['division2'];
		$em_nm	   = $_GET['em_nm'];

//echo "<br>division1=>".$division1;
//echo "<br>division2=>".$division2."<br>";
		//echo $em_nm;
		//echo $_SESSION['em_level'];

		if($_SESSION['em_level']>=40){
			if($em_nm)  {
				$where_em_seq = "AND em_seq = '".$em_nm."'";
				$sgroup_by	= ", em_seq";
				$view = "3";
			}
		}else if($_SESSION['em_level']>=20){
			if($division1){
				$where_division1 = "AND division1   = '".$division1."'";
				$sgroup_by = ", division2";
				$view = "2";
			}
			if($division2){
				$where_division2 = " AND division2= '".$division2."'";
				$sgroup_by	= ", em_seq";
				$view = "3";
			}
			if($em_nm)  {
				$where_em_seq = "AND em_seq = '".$em_nm."'";
				$sgroup_by	= ", em_seq";
				$view = "3";
			}
		}else if($_SESSION['em_level']>=10){
			if($division1){
				switch($division1){
				case "all" :
					//echo "all";
						//$sdivision1 = "AND division1 = '".$division1."'";
						$sgroup_by = ", division1";
						$view = "1";
				break;
				default :
						$where_division1 = "AND division1   = '".$division1."'";
						$sgroup_by = ", division2";
						$view = "2";
				break;
				}
			}

			if($division2){
				$where_division2 = " AND division2= '".$division2."'";
				$sgroup_by	= ", em_seq";
				$view = "3";
			}

			if($em_nm)  {
				$where_em_seq = "AND em_seq = '".$em_nm."'";
				$sgroup_by	= ", em_seq";
				$view = "3";
			}
		}

		$Qry = "SELECT
					COUNT(CASE WHEN business_license_yn='Y' THEN business_license_yn END) AS 'Y',
					COUNT(CASE WHEN business_license_yn='N' THEN business_license_yn END) AS 'N',
					COUNT(business_license_yn) AS 'YN',
					a.division1,
					a.division2,
					a.em_seq
				FROM (
					SELECT DISTINCT(ct_group), ct_seq, division1, division2, em_seq, business_license_yn
					FROM t_contract
					WHERE 1=1
					AND pay_date >= '".$_GET['s_date']."'
					AND pay_date <= '".$_GET['e_date']."'
					AND agree_state = '3'
					AND sales_type IN (2,3)
					AND bill_type IN (269,335)
					AND del_date IS NULL
					".$where_division1."
					".$where_division2."
					".$where_em_seq."
					GROUP BY ct_group
				) a
				GROUP BY division1, division2, em_seq
				with rollup";
		//echo $Qry;
		$Rst = que($Qry);

		$nListCnt = 0 ;
		while ($Row = @mysql_fetch_assoc($Rst)) {

		$S_RETURNVAL[$Row['division1']]['Y']  = $Row['Y'];
		$S_RETURNVAL[$Row['division1']]['N']  = $Row['N'];
		$S_RETURNVAL[$Row['division1']]['YN'] = $Row['YN'];

		$S_RETURNVAL[$Row['division1']][$Row['division2']]['Y']  = $Row['Y'];
		$S_RETURNVAL[$Row['division1']][$Row['division2']]['N']  = $Row['N'];
		$S_RETURNVAL[$Row['division1']][$Row['division2']]['YN'] = $Row['YN'];

		$S_RETURNVAL[$Row['division1']][$Row['division2']][$Row['em_seq']]['Y']  = $Row['Y'];
		$S_RETURNVAL[$Row['division1']][$Row['division2']][$Row['em_seq']]['N']  = $Row['N'];
		$S_RETURNVAL[$Row['division1']][$Row['division2']][$Row['em_seq']]['YN'] = $Row['YN'];

		$S_RETURNVAL['division1'][]		 = $Row['division1'];
		$S_RETURNVAL['division2'][]		 = $Row['division2'];
		$S_RETURNVAL['em_seq'][]		 = $Row['em_seq'];
		$S_RETURNVAL['Y'][]				 = $Row['Y'];
		$S_RETURNVAL['N'][]				 = $Row['N'];
		$S_RETURNVAL['YN'][]				 = $Row['YN'];

		$S_RETURNVAL['pay_date'][]		 = $Row['pay_date'];
		$S_RETURNVAL['ct_type'][]		 = $Row['ct_type'];

		$division1_count[$Row['division1']]++;
		$division2_count[$Row['division1']][$Row['division2']]++;

		//$S_RETURNVAL[$Row['division1']][$Row['division2']][$Row['em_seq']]		= $Row['em_seq'];

		$S_RETURNVAL['view']			= $view;

		$nListCnt++;
		}
		$S_RETURNVAL['division1_count'] = $division1_count;
		$S_RETURNVAL['division2_count'] = $division2_count;

		$S_RETURNVAL['nListCnt'] = $nListCnt;
		@mysql_free_result($Rst);

		$Qry1 = 'SELECT FOUND_ROWS() N_CNT ';
		$Rst1 = @mysql_query($Qry1);
		$Row1 = @mysql_fetch_assoc($Rst1);

		return $S_RETURNVAL;

		que_close();
	}



//-----------------------------------------------
	public function funcSelectTariff($syear,$smonth,$eyear,$emonth){
		$syear;
		$eyear;
		$Qry = "
		SELECT target_ym,
			SUM(CASE WHEN good_type2='34' THEN target_tariff ELSE 0 END ) AS naverc_tariff,
			SUM(CASE WHEN good_type2='35' THEN target_tariff ELSE 0 END ) AS navert_tariff,
			SUM(CASE WHEN good_type2='30' THEN target_tariff ELSE 0 END ) AS overture_tariff,
			SUM(CASE WHEN good_type2='31' THEN target_tariff ELSE 0 END ) AS google_tariff,
			SUM(CASE WHEN good_type2='29' THEN target_tariff ELSE 0 END ) AS clix_tariff,
			SUM(CASE WHEN good_type2='32' THEN target_tariff ELSE 0 END ) AS pops_tariff,
			SUM(CASE WHEN good_type2 IN ('26','27') THEN target_tariff ELSE 0 END ) AS nate_tariff,
			SUM(CASE WHEN good_type2='25' THEN target_tariff ELSE 0 END ) AS daum_tariff,
			SUM(CASE WHEN good_type2='384' THEN target_tariff ELSE 0 END ) AS combine_tariff,
			SUM(CASE WHEN good_type2='339' THEN target_tariff ELSE 0 END ) AS naver_tariff,
			SUM(CASE WHEN good_type2 IN ('28','39','323','324','325','33','327','326') THEN target_tariff ELSE 0 END ) AS etc_tariff
		FROM 
		( 
			SELECT good_type2, CONCAT(reg_year,'-','01') AS target_ym, reg_m1 AS target_tariff FROM t_tariff WHERE del_date IS NULL 
			UNION ALL 
			SELECT good_type2, CONCAT(reg_year,'-','02') AS target_ym , reg_m2 AS target_tariff FROM t_tariff WHERE del_date IS NULL 
			UNION ALL 
			SELECT good_type2, CONCAT(reg_year,'-','03') AS target_ym , reg_m3 AS target_tariff FROM t_tariff WHERE del_date IS NULL 
			UNION ALL 
			SELECT good_type2, CONCAT(reg_year,'-','04') AS target_ym , reg_m4 AS target_tariff FROM t_tariff WHERE del_date IS NULL 
			UNION ALL 
			SELECT good_type2, CONCAT(reg_year,'-','05') AS target_ym , reg_m5 AS target_tariff FROM t_tariff WHERE del_date IS NULL 
			UNION ALL 
			SELECT good_type2, CONCAT(reg_year,'-','06') AS target_ym , reg_m6 AS target_tariff FROM t_tariff WHERE del_date IS NULL 
			UNION ALL 
			SELECT good_type2, CONCAT(reg_year,'-','07') AS target_ym , reg_m7 AS target_tariff FROM t_tariff WHERE del_date IS NULL 
			UNION ALL 
			SELECT good_type2, CONCAT(reg_year,'-','08') AS target_ym , reg_m8 AS target_tariff FROM t_tariff WHERE del_date IS NULL 
			UNION ALL 
			SELECT good_type2, CONCAT(reg_year,'-','09') AS target_ym , reg_m9 AS target_tariff FROM t_tariff WHERE del_date IS NULL 
			UNION ALL 
			SELECT good_type2, CONCAT(reg_year,'-','10') AS target_ym , reg_m10 AS target_tariff FROM t_tariff WHERE del_date IS NULL 
			UNION ALL 
			SELECT good_type2, CONCAT(reg_year,'-','11') AS target_ym , reg_m11 AS target_tariff FROM t_tariff WHERE del_date IS NULL 
			UNION ALL 
			SELECT good_type2, CONCAT(reg_year,'-','12') AS target_ym , reg_m12 AS target_tariff FROM t_tariff WHERE del_date IS NULL 
		) aaaaa 	
		WHERE target_ym >= '".$syear."-".$smonth."' AND target_ym <= '".$eyear."-".$emonth."' 
		GROUP BY  target_ym";

		//echo $Qry;
		$Rst = que($Qry);

		$nListCnt = 0 ;
		while ($Row = @mysql_fetch_assoc($Rst)) {
			$S_RETURNVAL_TARIFF['target_ym'][$Row['target_ym']]				= $Row['target_ym'];
			$S_RETURNVAL_TARIFF['naverc_tariff'][$Row['target_ym']]			= $Row['naverc_tariff'];
			$S_RETURNVAL_TARIFF['navert_tariff'][$Row['target_ym']]			= $Row['navert_tariff'];
			$S_RETURNVAL_TARIFF['overture_tariff'][$Row['target_ym']]		= $Row['overture_tariff'];
			$S_RETURNVAL_TARIFF['google_tariff'][$Row['target_ym']]			= $Row['google_tariff'];
			$S_RETURNVAL_TARIFF['clix_tariff'][$Row['target_ym']]				= $Row['clix_tariff'];
			$S_RETURNVAL_TARIFF['pops_tariff'][$Row['target_ym']]			= $Row['pops_tariff'];
			$S_RETURNVAL_TARIFF['nate_tariff'][$Row['target_ym']]				= $Row['nate_tariff'];
			$S_RETURNVAL_TARIFF['daum_tariff'][$Row['target_ym']]			= $Row['daum_tariff'];
			$S_RETURNVAL_TARIFF['combine_tariff'][$Row['target_ym']]		= $Row['combine_tariff'];
			$S_RETURNVAL_TARIFF['naver_tariff'][$Row['target_ym']]			= $Row['naver_tariff'];
			$S_RETURNVAL_TARIFF['etc_tariff'][$Row['target_ym']]				= $Row['etc_tariff']/8;
		$nListCnt++;
		}

		$Qry1 = 'SELECT FOUND_ROWS() N_CNT ';
		$Rst1 = @mysql_query($Qry1);
		$Row1 = @mysql_fetch_assoc($Rst1);

		return $S_RETURNVAL_TARIFF;

		que_close();

	}


	public function funcCPCvariation(){
		if($_GET['syear']){
			if(!$_GET['division1']){$S_RETURNVAL['view']="1";}
			if($_GET['division1']){$where_division1 = "AND division1 = '".$_GET['division1']."'";$S_RETURNVAL['view']="1";}
			if($_GET['division2']){$where_division2 = "AND division2 = '".$_GET['division2']."'";$S_RETURNVAL['view']="2";}
			if($_GET['em_nm'])	  {$where_em_seq	= "AND em_seq    = '".$_GET['em_nm']."'";$S_RETURNVAL['view']="3";}
			if($_GET['sprice']&&$_GET['eprice'])  {$where_sprice	= "AND             ((m01 >= '".$_GET['sprice']."' AND m01 <= '".$_GET['eprice']."')
																	   ".$_GET['sop']." (m02 >= '".$_GET['sprice']."' AND m02 <= '".$_GET['eprice']."'))";}
			//if($_GET['m_nm'])	  {$m_nm = implode(",",$_GET["m_nm"]); $where_m_nm = "AND m_nm IN (".$m_nm.")";}
			// 매체만 선택
			if($_GET['m_nm'] && !$_GET['product'])	  {$m_nm = implode(",",$_GET["m_nm"]); $where_m_nm = "AND good_type2 IN (".getMediaProductCode($m_nm, 22).")";}
			// 상품만 선택
			if(!$_GET['m_nm'] && $_GET['product'])	  {$product_code = implode(",",$_GET["product"]); $where_product = "AND good_type2 IN (".$product_code.")";}
			// 매체 및 상품 선택
			if($_GET['m_nm'] && $_GET['product']) {
				// 매체의 상품 코드 가져오기
				$m_nm = implode(",",$_GET["m_nm"]);
				$resultProductCode = getMediaProductCode($m_nm, 22);
				// 선택된 상품의 코드 분리하기
				$tempProductCode = implode(",",$_GET["product"]);
				// 상품코드 합치기
				$resultProductCode .= (",".$tempProductCode);
				$where_product = "AND good_type2 IN (".$resultProductCode.")";

			}

			if($_GET['cal_kind']=="d"){			
				$where_cal_kind = "	AND ((pay_date >= '".$_GET['syear']."-".$_GET['smonth']."-".$_GET['sday']."' 
											AND pay_date <= '".$_GET['eyear']."-".$_GET['emonth']."-".$_GET['eday']."' )
											OR   (pay_date >= '".$_GET['syear1']."-".$_GET['smonth1']."-".$_GET['sday1']."' 
											AND pay_date <= '".$_GET['eyear1']."-".$_GET['emonth1']."-".$_GET['eday1']."' ))";

				$S_RETURNVAL['sdate'] = $_GET['syear']."-".$_GET['smonth']."-".$_GET['sday']."~".$_GET['eyear']."-".$_GET['emonth']."-".$_GET['eday'];
				$S_RETURNVAL['edate'] = $_GET['syear1']."-".$_GET['smonth1']."-".$_GET['sday1']."~".$_GET['eyear1']."-".$_GET['emonth1']."-".$_GET['eday1'];

				$where_m01 = "pay_date BETWEEN '".$_GET['syear']."-".$_GET['smonth']."-".$_GET['sday']."' AND '".$_GET['eyear']."-".$_GET['emonth']."-".$_GET['eday']."'";
				$where_m02 = "pay_date BETWEEN '".$_GET['syear1']."-".$_GET['smonth1']."-".$_GET['sday1']."' AND '".$_GET['eyear1']."-".$_GET['emonth1']."-".$_GET['eday1']."'";

				$where_pay_date	= "pay_date";
				$groupby			= "pay_date";
			}else{
				$where_cal_kind	="	AND pay_date >= '".$_GET['syear']."-".$_GET['smonth']."-01' 
											AND pay_date <= '".$_GET['eyear']."-".$_GET['emonth']."-".$_GET['eeday']."'";

				$S_RETURNVAL['sdate']		= $_GET['syear']."-".$_GET['smonth'];
				$S_RETURNVAL['edate']		= $_GET['eyear']."-".$_GET['emonth'];

				$where_m01 = "pay_date = '".$_GET['syear']."-".$_GET['smonth']."'";
				$where_m02 = "pay_date = '".$_GET['eyear']."-".$_GET['emonth']."'";

				$where_pay_date = "LEFT(pay_date,7) AS pay_date";
				$groupby = "LEFT(pay_date,7)";
			}
			
			$Qry = "SELECT * , COUNT(*) AS cnt FROM (
					SELECT  
						SUM(CASE WHEN ".$where_m01." THEN pay_price ELSE 0 END) AS 'm01',
						SUM(CASE WHEN ".$where_m02." THEN pay_price ELSE 0 END) AS 'm02',
						cs_seq, m_nm, good_type2, cs_m_id, division1, division2, em_seq
						FROM (
							SELECT ".$where_pay_date.", m_nm, good_type2, cs_m_id, division1, division2, em_seq, cs_seq,  SUM(pay_price) AS pay_price
							FROM t_contract 
							WHERE 1=1
							".$where_cal_kind." 
							".$where_division1."
							".$where_division2."
							".$where_em_seq."
							".$where_m_nm."
							".$where_product."
							AND sales_type 	 = '1'
							AND agree_state  = '3'
							AND del_date IS NULL					
							GROUP BY ".$groupby.", m_nm, cs_m_id, division1, division2, em_seq, good_type2
						) a
					GROUP BY division1 , division2, em_seq, m_nm, cs_m_id, good_type2
					) b 
				WHERE 1=1
				".$where_sprice."
				".$where_eprice."
				GROUP BY division1 , division2, em_seq, m_nm, cs_m_id, good_type2
				ORDER BY (division1-0) , (division2-0), cs_seq, (em_seq-0), (m_nm-0), cs_m_id";
				/*
				
				SELECT LEFT(pay_date,7) AS pay_date, m_nm, cs_m_id, division1, division2, em_seq, SUM(pay_price) AS pay_price, COUNT(pay_price) AS cnt
				FROM t_contract 
				WHERE 1=1
				".$where_division1."
				".$where_division2."
				".$where_em_seq."
				".$where_cal_kind."
				AND sales_type = '1'
				AND del_date IS NULL 			
				GROUP BY LEFT(pay_date,7), division1, division2, em_seq, m_nm, cs_m_id";
				*/

			//echo $Qry;
			
			$Rst = que($Qry);
			
			$nListCnt = 0 ;
			while ($Row = @mysql_fetch_assoc($Rst)) {
				$S_RETURNVAL['m01'][]		= $Row['m01'];
				$S_RETURNVAL['m02'][]		= $Row['m02'];
				$S_RETURNVAL['m_nm'][]		= $Row['m_nm'];
				$S_RETURNVAL['product'][]	= $Row['good_type2'];
				$S_RETURNVAL['cs_m_id'][]	= $Row['cs_m_id'];
				$S_RETURNVAL['division1'][] = $Row['division1'];
				$S_RETURNVAL['division2'][] = $Row['division2'];
				$S_RETURNVAL['em_seq'][]	= $Row['em_seq'];
				$S_RETURNVAL['cs_seq'][]	= $Row['cs_seq'];
				$S_RETURNVAL['cnt'][]		= $Row['cnt'];		

				$nListCnt++;
			//	$S_RETURNVAL['m01'][$Row['division1']][$Row['division2']][$Row['em_seq']][$Row['m_nm']][$Row['cs_m_id']]		= $Row['m01'];
			//	$S_RETURNVAL['m02'][$Row['division1']][$Row['division2']][$Row['em_seq']][$Row['m_nm']][$Row['cs_m_id']]		= $Row['m02'];
			}
			
			$S_RETURNVAL['nListCnt'] = $nListCnt;
			
			$Qry1 = 'SELECT FOUND_ROWS() N_CNT ';
			$Rst1 = @mysql_query($Qry1);
			$Row1 = @mysql_fetch_assoc($Rst1);
			
			return $S_RETURNVAL;

			que_close();
		}
	}

	public function funcCsMidSales(){
		if($_SESSION['em_level']==10){
			if($_GET["type_member"]=="2"){
				if($_GET['division1']){$where_division1 = "AND division1 ='".$_GET['division1']."'";}
				if($_GET['division2']){$where_division2 = "AND division2 ='".$_GET['division2']."'";}
				if($_GET['em_nm'])    {$where_em_seq	= "AND em_seq    ='".$_GET['em_nm']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_GET['division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_nm']."'";			
			}
		}else if($_SESSION['em_level']==20){
			if($_GET["type_member"]=="2"){			
				$where_division1 = "AND division1 ='".$_SESSION['em_division1']."'";
				if($_GET['division2']){$where_division2 = "AND division2 ='".$_GET['division2']."'";}
				if($_GET['em_nm']){$where_em_seq	= "AND em_seq    ='".$_GET['em_nm']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_nm']."'";
			}
		}else if($_SESSION['em_level']==30){
			if($_GET["type_member"]=="2"){
				$where_division2 = "AND division1 ='".$_SESSION['em_division1']."' 
									AND division2 ='".$_SESSION['em_division2']."'";
				if($_GET['em_nm']){$where_em_seq = "AND em_seq    ='".$_GET['em_nm']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_SESSION['em_division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_nm']."'";
			}
		}else if($_SESSION['em_level']==40){
			$where_em_seq = "AND em_seq = '".$_SESSION['s_em_seq']."'";
		}


		if($_GET['cal_kind']=="d"){
		$where_date = "AND pay_date >='".$_GET['syear']."-".$_GET['smonth']."-".$_GET['sday']."'
					   AND pay_date <='".$_GET['eyear']."-".$_GET['emonth']."-".$_GET['eday']."'" ;
		}else{
		$where_date = "AND LEFT(pay_date,7) >='".$_GET['syear']."-".$_GET['smonth']."'
					   AND LEFT(pay_date,7) <='".$_GET['eyear']."-".$_GET['emonth']."'" ;
		}
		
		if($_GET['m_nm'])	 {$m_nm = implode(",",$_GET["m_nm"]); $where_m_nm = "AND m_nm IN (".$m_nm.")";}

		if($_GET['sprice1'] && $_GET['sprice2'])  {$where_sprice	= "AND pay_price BETWEEN '".$_GET['sprice1']."' AND '".$_GET['sprice2']."'";}
		if($_GET['sprice1'] && !$_GET['sprice2'])  {$where_sprice	= "AND pay_price >= '".$_GET['sprice1']."'";}

		if(!$_GET['sort'])	  $_GET['sort'] = "desc";
		if(!$_GET['orderby']) $_GET['orderby'] = "pay_price";

		if($_GET['s_item'] && $_GET['s_string']){			
			$where_item = "AND ".$_GET['s_item']." = '".$_GET['s_string']."'";
		}

		if($_GET['syear']){		
				$Qry = "
					SELECT * FROM (
						SELECT division1, division2, em_seq, m_nm, cs_m_id, cs_seq, sum(pay_price) as pay_price,good_type2
						FROM t_contract 
						WHERE 1=1
						".$where_date."			
						".$where_division1."
						".$where_division2."
						".$where_em_seq."
						".$where_m_nm."
						".$where_item."
						AND sales_type	= '1'
						AND agree_state	= '3'
						AND del_date IS NULL	
						GROUP BY m_nm, cs_m_id, good_type2
						ORDER BY ".$_GET['orderby']." ".$_GET['sort']."
					) a WHERE 1=1
					".$where_sprice."";

				//echo $Qry;
				$Rst = que($Qry);		

		$nListCnt = 0 ;
		while ($Row = @mysql_fetch_assoc($Rst)) {
			$S_RETURNVAL['m_nm'][]			= $Row['m_nm'];
			$S_RETURNVAL['cs_m_id'][]		= $Row['cs_m_id'];
			$S_RETURNVAL['division1'][]		= $Row['division1'];
			$S_RETURNVAL['division2'][]		= $Row['division2'];
			$S_RETURNVAL['em_seq'][]		= $Row['em_seq'];
			$S_RETURNVAL['cs_seq'][]		= $Row['cs_seq'];
			$S_RETURNVAL['pay_price'][]		= $Row['pay_price'];
			$S_RETURNVAL['good_type2'][]	= $Row['good_type2'];

			$nListCnt++;
		//	$S_RETURNVAL['m01'][$Row['division1']][$Row['division2']][$Row['em_seq']][$Row['m_nm']][$Row['cs_m_id']]		= $Row['m01'];
		//	$S_RETURNVAL['m02'][$Row['division1']][$Row['division2']][$Row['em_seq']][$Row['m_nm']][$Row['cs_m_id']]		= $Row['m02'];
		}
		
		$S_RETURNVAL['nListCnt'] = $nListCnt;

		return $S_RETURNVAL;

		que_close();
		}
	}



	//---계정별매출---- 리스트----
	function funcCsMidSalesDetail(){
		if($_GET['cal_kind']=="m"){
			$_GET['sday'] = "01";
			$_GET['eday'] = "31";
		}

		$sdate		= $_GET['syear']."-".$_GET['smonth']."-".$_GET['sday'];
		$edate		= $_GET['eyear']."-".$_GET['emonth']."-".$_GET['eday'];
		$m_nm1		= $_GET['m_nm1'];
		$cs_m_id1	= $_GET['cs_m_id1'];

		if($_GET['cal_kind']=="w"){
			$sdate		= date("Y-m-d", mktime(0,0,0,$_GET['emonth']-3,$_GET['eday'],$_GET['eyear']));		//전달
			$edate		= $_GET['eyear']."-".$_GET['emonth']."-".$_GET['eday'];
			$query		= ", MIN(pay_date) from_date
							, MAX(pay_date) to_date
							, FLOOR( ( TO_DAYS(pay_date)-TO_DAYS('".$sdate."') ) / 7 ) WEEK";
			$groupby	= "GROUP BY WEEK";
			$orderby	= "ORDER BY WEEK";
		}else{
			$groupby	= "GROUP BY pay_date";
			$orderby	= "ORDER BY pay_date";
		}
		
		if($_GET['good_type2']){$where_good_type2 = "AND good_type2= '".$_GET['good_type2']."'";}

		$Qry = "SELECT pay_date ".$query.",sum(pay_price) as pay_price					
					FROM t_contract 
					WHERE pay_date BETWEEN '".$sdate."' AND '".$edate."' 
					AND m_nm = '".$m_nm1."' 
					AND cs_m_id = '".$cs_m_id1."' 
					AND sales_type = '1'
					AND del_date IS NULL
					".$where_good_type2."
					".$groupby."
					".$orderby."";

		//echo $Qry;
		$Rst = que($Qry);

		while ($Row = @mysql_fetch_assoc($Rst)) {

			$S_RETURNVAL['pay_date'][]												=$Row['pay_date'];
			$S_RETURNVAL['pay_price'][]												=$Row['pay_price'];

			$S_RETURNVAL['pay_month'][substr($Row['pay_date'],0,7)]					=substr($Row['pay_date'],0,7);
			$S_RETURNVAL['pay_month_price'][substr($Row['pay_date'],0,7)]			+=$Row['pay_price'];

			$S_RETURNVAL['pay_week_date'][$Row['from_date']."~".$Row['to_date']]	=$Row['from_date']."~".$Row['to_date'];	
			$S_RETURNVAL['pay_week_price'][$Row['from_date']."~".$Row['to_date']]	=$Row['pay_price'];	
			$S_RETURNVAL['pay_week'][$Row['from_date']."~".$Row['to_date']]			=$Row['WEEK'];	

			$nListCnt++;
		}

		$S_RETURNVAL['nListCnt'] = $nListCnt;
		$S_RETURNVAL['sdate']	 = $sdate1."~".$edate1;
		$S_RETURNVAL['edate']	 = $sdate2."~".$edate2;
		@mysql_free_result($Rst);
	
		if($S_RETURNVAL['nListCnt']<0){
			$S_RETURNVAL = -1;
		}else{
			return $S_RETURNVAL;
		}

		return $S_RETURNVAL;

		que_close();

	}
	//---계정별매출---- 리스트----









public function funcGoods2($cal_kind,$syear,$smonth,$sday,$eyear,$emonth,$eday){

		//print_R($_GET);
/*
		if($_SESSION['em_level']==40){
			$where_em_seq = "AND em_seq = '".$_SESSION['s_em_seq']."'";
			//echo "40";
		}else{
			//echo "10";
			if($_GET['em_seq']){
				//echo $_GET['em_seq'];
				$where_em_seq = "AND em_seq = '".$_GET['em_seq']."'";
			}

			if($_GET['em_seq1']){
				//echo $_GET['em_seq'];
				$where_em_seq1 = "AND em_seq = '".$_GET['em_seq1']."'";
			}

			if($_GET['division1']){
				//$division1 = implode(",",$_GET["division1"]);
				$where_division1 = "AND division1 = '".$_GET['division1']."'";
			}

			if($_GET['division2']){
				//$division2 = implode(",",$_GET["division2"]);
				$where_division2 = "AND division2 = '".$_GET['division2']."'";
			}

			// 상품구분에서 개별 선택 할 경우
			if($_GET["good_type2"]) {
				$good_type2 = implode(",",$_GET["good_type2"]);
				$where_goodtype2 = "AND good_type2 = '".$_GET['good_type2']."'";
			}
*/
			

			if($_GET["good_type1"]) {
				//$good_type1 = implode(",",$_GET["good_type1"]);
				$where_goodtype1 = "AND good_type1 = '".$_GET['good_type1']."'";
			}

			if($_GET["m_nm"]) {
				//$good_type1 = implode(",",$_GET["good_type1"]);
				$m_nm = implode(",",$_GET["m_nm"]);

				$where_m_nm = "AND m_nm in (".$m_nm.")";

			}

			// 상풍구분에서 최상위 상품 선택할 경우(다음, 네이버 등등)
			if($_GET['good_type2_all']) {
				//$good_type2 = implode(",",$_GET["good_type2_all"]);				
				$where_goodtype2 = "AND good_type2 IN (".getGoodTypeString($good_type2).")";
			}

			if($_GET['division1']){
				$division1 = implode(",",$_GET["division1"]);
				$where_division1 = "AND division1 = '".$division1."'";
			}


		//}

		if($_SESSION['em_level']==10){
			if($_GET["type_member"]=="2"){
				if($_GET['division1'])	{$where_division1	= "AND division1 ='".$_GET['division1']."'";}
				if($_GET['division2'])	{$where_division2	= "AND division2 ='".$_GET['division2']."'";}
				if($_GET['em_seq'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq']."'";}
				if($_GET['em_nm'])		{$where_em_seq1		= "AND em_seq	 ='".$_GET['em_seq1']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_GET['division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq1 = "":$where_em_seq1= "AND em_seq ='".$_GET['em_seq1']."'";
				$_GET['em_seq'] ==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq']."'";
			}
		}else if($_SESSION['em_level']==20){
			if($_GET["type_member"]=="2"){			

				$where_division1 = "AND division1 ='".$_SESSION['em_division1']."'";
				
				if($_GET['division2'])	{$where_division2	= "AND division2 ='".$_GET['division2']."'";}
				if($_GET['em_nm'])		{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				//if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq1 = "":$where_em_seq1= "AND em_seq ='".$_GET['em_seq1']."'";
				$_GET['em_seq'] ==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq']."'";			
			}
		}else if($_SESSION['em_level']==30){

			//박용대만 전체 본부 노출 2017.12.26
			/*
			if($_SESSION['s_em_seq']=='44'){
				if($_GET["type_member"]=="2"){
					if($_GET['division1'])	{$where_division1	= "AND division1 ='".$_SESSION['em_division1']."'";}
					if($_GET['division2'])	{$where_division2	= "AND division2 ='".$_GET['division2']."'";}
					if($_GET['em_seq'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq']."'";}
					if($_GET['em_nm'])		{$where_em_seq1		= "AND em_seq	 ='".$_GET['em_seq1']."'";}

				}else{
					
					$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_GET['division2']);
					$join_emseq = join($get_emseq,",");

					$where_division1 = "";
					$where_division2 = "";
					$_GET['em_nm']==""?$where_em_seq1 = "":$where_em_seq1= "AND em_seq ='".$_GET['em_seq1']."'";		
					$_GET['em_seq'] ==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq']."'";			
				}
				
			}else{*/
				if($_GET["type_member"]=="2"){
					$where_division2 = "AND division1 ='".$_SESSION['em_division1']."' 
										AND division2 ='".$_SESSION['em_division2']."'";

					if($_GET['em_nm'])		{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}
					if($_GET['em_seq'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq']."'";}

				}else{
					
					$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_SESSION['em_division2']);
					$join_emseq = join($get_emseq,",");

					$where_division1 = "";
					$where_division2 = "";
					$_GET['em_nm']==""?$where_em_seq1 = "":$where_em_seq1= "AND em_seq ='".$_GET['em_seq1']."'";
					$_GET['em_seq']	==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq']."'";
					
				}
			//}
			
		}else if($_SESSION['em_level']==40){
			$where_em_seq = "AND em_seq = '".$_SESSION['s_em_seq']."'";
		}


		switch($_GET['cal_kind']){
			case "d"	:$sreg_date = "pay_date as pay_date";				$sgroup_by="GROUP BY pay_date ";		break;
			case "m"	:$sreg_date = "left(pay_date,7) as pay_date";		$sgroup_by="GROUP BY left(pay_date,7)";	break;
			//case "m" :$sreg_date = "pay_date as pay_date";			$sgroup_by="GROUP BY pay_date";			break;
			case "y"	:$sreg_date = "LEFT(pay_date,4) as pay_date";		$sgroup_by="GROUP BY LEFT(pay_date,4)";	break;			
			case "w"	:$sreg_date = "WEEKDAY(pay_date) as pay_date";		$sgroup_by="GROUP BY WEEKDAY(pay_date)";break; //요일별
			case "wd"	:$sreg_date = "WEEKDAY(pay_date) as pay_date";	$sgroup_by="GROUP BY WEEKDAY(pay_date)";
						 $where_week = "AND WEEKDAY(pay_date) = '".$_GET['week']."'";
							//$where_weekdayyn=$_GET['weekdayyn']=="N"?"AND WEEKDAY(pay_date) NOT IN (0,6)":""; 
						break; //특정요일break; 
			
		}

if($syear){
		$Qry = "SELECT 		$sreg_date, good_type2, SUM(pay_price) as pay_price, good_type1, m_nm
							FROM t_contract				
							WHERE pay_date BETWEEN '".$syear."-".$smonth."-".$sday."' AND '".$eyear."-".$emonth."-".$eday."'
							".$where_division1."
							".$where_division2."
							".$where_goodtype1."
							".$where_goodtype2."
							".$where_em_seq."
							".$where_em_seq1."
							".$where_m_nm."
							".$where_week."
							".$where_weekdayyn."
							AND del_date IS NULL
							AND sales_type IN (1,3)
							AND agree_state = '3'
							$sgroup_by ,division1, division2, em_seq, good_type2
							ORDER BY pay_date, m_nm, good_type2";

		//echo $Qry;
		$Rst = que($Qry);

		$nListCnt = 0 ;
		while ($Row = @mysql_fetch_assoc($Rst)) {
			
			//$S_RETURNVAL['pay_price1'][$Row['division1']][$Row['good_type2']]										+= $Row['pay_price'];
			//$S_RETURNVAL['pay_price2'][$Row['division1']][$Row['division2']][$Row['good_type2']]					+= $Row['pay_price'];
			//$S_RETURNVAL['pay_price3'][$Row['division1']][$Row['division2']][$Row['em_seq']][$Row['good_type2']]	+= $Row['pay_price'];

			$S_RETURNVAL['good_type2'][$Row['m_nm']][$Row['good_type2']]	= $Row['good_type2'];
			$S_RETURNVAL['m_nm'][$Row['m_nm']]	= $Row['m_nm'];
			//$S_RETURNVAL['division1'][$Row['division1']]	= $Row['division1'];
			//$S_RETURNVAL['division2'][$Row['division2']]	= $Row['division2'];
			//$S_RETURNVAL['em_seq'][$Row['em_seq']]			= $Row['em_seq'];

			//$S_RETURNVAL['pay_price'][$Row['pay_date']]								+= $Row['pay_price'];
			$S_RETURNVAL['good_type2_price'][$Row['pay_date']][$Row['m_nm']][$Row['good_type2']]		+= $Row['pay_price'];
			$S_RETURNVAL['pay_date'][$Row['pay_date']]	= $Row['pay_date'];

			$nListCnt++;
		}
		$S_RETURNVAL['nListCnt']							= $nListCnt;
		$S_RETURNVAL['view']								= $view;


		

		return $S_RETURNVAL;

		que_close();
}	
	}
//-----------------------------------------------





public function funcGoods3($cal_kind,$syear,$smonth,$sday,$eyear,$emonth,$eday){

		// 주의 첫날과 마지막날 계산 START
		$sdate = "$syear-$smonth-$sday";
		$edate = "$eyear-$emonth-$eday";
		// 검색이 일요일일 경우 -1 day
		$yoil = array("일","월","화","수","목","금","토");
		if($yoil[date('w', strtotime($sdate))] === '일'){
			$sdate = date('Y-m-d',strtotime($sdate.'-1 days'));
		}
		if($yoil[date('w', strtotime($edate))] === '일'){
			$edate = date('Y-m-d',strtotime($edate.'-1 days'));
		}
		// 일주일 계산하기 위해 쪼개기
		$sYY = date("Y", strtotime($sdate));
		$sMM = date("m", strtotime($sdate));
		$sDD = date("d", strtotime($sdate));
		$sDay = date("w", strtotime($sdate))-1;

		$eYY = date("Y", strtotime($edate));
		$eMM = date("m", strtotime($edate));
		$eDD = date("d", strtotime($edate));
		$eDay = date("w", strtotime($edate))-1;

		$sweek_start = date("Y-m-d", strtotime($sYY."-".$sMM."-".$sDD." -".$sDay." day"));	// 주의 첫날1
		$sweek_end = date("Y-m-d", strtotime($sweek_start." +6 day"));						// 주의 마지막날1

		$eweek_start = date("Y-m-d", strtotime($eYY."-".$eMM."-".$eDD." -".$eDay." day"));	// 주의 첫날2
		$eweek_end = date("Y-m-d", strtotime($eweek_start." +6 day"));						// 주의 마지막날2

		// 시작일 날짜
		$wsyear					= date("Y", strtotime($sweek_start));
		$wsmonth				= date("m", strtotime($sweek_start));
		$wsday					= date("d", strtotime($sweek_start));
		// 종료일 날짜
		$weyear					= date("Y", strtotime($eweek_end));
		$wemonth				= date("m", strtotime($eweek_end));
		$weday					= date("d", strtotime($eweek_end));

		// 일주일 날짜 계산 => ex) '2021-03-15' ~ '2021-03-21'
		// 날짜 차이
		$diff_date    = strtotime($eweek_end) - strtotime($sweek_start);

		$week_arr = array();
		for($i=0;$i<($diff_date/86400 + 1)/7;$i++){
			$b = 7*$i;
			$prev_date = date("Y-m-d", strtotime(date($sweek_start) . " +".$b." days"))." ~ ".date("Y-m-d", strtotime(date($sweek_end) . "+".$b." days"));
			array_push($week_arr, $prev_date);
		}
		// 주의 첫날과 마지막날 계산 END

/*
		if($_SESSION['em_level']==40){
			$where_em_seq = "AND em_seq = '".$_SESSION['s_em_seq']."'";
			//echo "40";
		}else{
			//echo "10";
			if($_GET['em_seq']){
				//echo $_GET['em_seq'];
				$where_em_seq = "AND em_seq = '".$_GET['em_seq']."'";
			}

			if($_GET['em_seq1']){
				//echo $_GET['em_seq'];
				$where_em_seq1 = "AND em_seq = '".$_GET['em_seq1']."'";
			}

			if($_GET['division1']){
				//$division1 = implode(",",$_GET["division1"]);
				$where_division1 = "AND division1 = '".$_GET['division1']."'";
			}

			if($_GET['division2']){
				//$division2 = implode(",",$_GET["division2"]);
				$where_division2 = "AND division2 = '".$_GET['division2']."'";
			}

			// 상품구분에서 개별 선택 할 경우
			if($_GET["good_type2"]) {
				$good_type2 = implode(",",$_GET["good_type2"]);
				$where_goodtype2 = "AND good_type2 = '".$_GET['good_type2']."'";
			}
*/
			

			if($_GET["good_type1"]) {
				//$good_type1 = implode(",",$_GET["good_type1"]);
				$where_goodtype1 = "AND good_type1 = '".$_GET['good_type1']."'";
			}

			if($_GET["m_nm"]) {
				//$good_type1 = implode(",",$_GET["good_type1"]);
				$m_nm = implode(",",$_GET["m_nm"]);

				//$where_m_nm = "AND m_nm in (".$m_nm.")";
				$where_m_nm1	= "AND m_nm1 IN (".$m_nm.")";
				$where_cm3_seq	= "AND cm3_seq IN (".$m_nm.")";
			}

			// 상풍구분에서 최상위 상품 선택할 경우(다음, 네이버 등등)
			if($_GET['good_type2_all']) {
				//$good_type2 = implode(",",$_GET["good_type2_all"]);				
				$where_goodtype2 = "AND good_type2 IN (".getGoodTypeString($good_type2).")";
			}

			if($_GET['division1']){
				$division1 = implode(",",$_GET["division1"]);
				$where_division1 = "AND division1 = '".$division1."'";
			}


		//}

		if($_SESSION['em_level']==10){
			if($_GET["type_member"]=="2"){
				if($_GET['division1'])	{$where_division1	= "AND division1 ='".$_GET['division1']."'";}
				if($_GET['division2'])	{$where_division2	= "AND division2 ='".$_GET['division2']."'";}
				if($_GET['em_seq'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq']."'";}
				if($_GET['em_nm'])		{$where_em_seq1		= "AND em_seq	 ='".$_GET['em_seq1']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_GET['division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq1 = "":$where_em_seq1= "AND em_seq ='".$_GET['em_seq1']."'";
				$_GET['em_seq'] ==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq']."'";
			}
		}else if($_SESSION['em_level']==20){
			if($_GET["type_member"]=="2"){			

				$where_division1 = "AND division1 ='".$_SESSION['em_division1']."'";
				
				if($_GET['division2'])	{$where_division2	= "AND division2 ='".$_GET['division2']."'";}
				if($_GET['em_nm'])		{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				//if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq1 = "":$where_em_seq1= "AND em_seq ='".$_GET['em_seq1']."'";
				$_GET['em_seq'] ==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq']."'";			
			}
		}else if($_SESSION['em_level']==30){

			//박용대만 전체 본부 노출 2017.12.26
			/*
			if($_SESSION['s_em_seq']=='44'){
				if($_GET["type_member"]=="2"){
					if($_GET['division1'])	{$where_division1	= "AND division1 ='".$_SESSION['em_division1']."'";}
					if($_GET['division2'])	{$where_division2	= "AND division2 ='".$_GET['division2']."'";}
					if($_GET['em_seq'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq']."'";}
					if($_GET['em_nm'])		{$where_em_seq1		= "AND em_seq	 ='".$_GET['em_seq1']."'";}

				}else{
					
					$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_GET['division2']);
					$join_emseq = join($get_emseq,",");

					$where_division1 = "";
					$where_division2 = "";
					$_GET['em_nm']==""?$where_em_seq1 = "":$where_em_seq1= "AND em_seq ='".$_GET['em_seq1']."'";		
					$_GET['em_seq'] ==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq']."'";			
				}
				
			}else{*/
				if($_GET["type_member"]=="2"){
					$where_division2 = "AND division1 ='".$_SESSION['em_division1']."' 
										AND division2 ='".$_SESSION['em_division2']."'";

					if($_GET['em_nm'])		{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}
					if($_GET['em_seq'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq']."'";}

				}else{
					
					$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_SESSION['em_division2']);
					$join_emseq = join($get_emseq,",");

					$where_division1 = "";
					$where_division2 = "";
					$_GET['em_nm']==""?$where_em_seq1 = "":$where_em_seq1= "AND em_seq ='".$_GET['em_seq1']."'";
					$_GET['em_seq']	==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq']."'";
					
				}
			//}
			
		}else if($_SESSION['em_level']==40){
			$where_em_seq = "AND em_seq = '".$_SESSION['s_em_seq']."'";
		}

		switch($_GET['cal_kind']){
			case "d"	:$sreg_date = "pay_date as pay_date";				$sgroup_by="GROUP BY pay_date ";		break;
			case "wk"	:$sreg_date = "pay_date as pay_date";				$sgroup_by="GROUP BY pay_date ";		break;
			case "m"	:$sreg_date = "left(pay_date,7) as pay_date";		$sgroup_by="GROUP BY left(pay_date,7)";	break;
			//case "m" :$sreg_date = "pay_date as pay_date";				$sgroup_by="GROUP BY pay_date";			break;
			case "y"	:$sreg_date = "LEFT(pay_date,4) as pay_date";		$sgroup_by="GROUP BY LEFT(pay_date,4)";	break;			
			case "w"	:$sreg_date = "WEEKDAY(pay_date) as pay_date";		$sgroup_by="GROUP BY WEEKDAY(pay_date)";break; //요일별
			case "wd"	:$sreg_date = "WEEKDAY(pay_date) as pay_date";		$sgroup_by="GROUP BY WEEKDAY(pay_date)"; 
			$where_week = "AND WEEKDAY(pay_date) = '".$_GET['week']."'";
							//$where_weekdayyn=$_GET['weekdayyn']=="N"?"AND WEEKDAY(pay_date) NOT IN (0,6)":""; 
						break; //특정요일break; 
		}

if($syear){
	if($_GET['cal_kind'] != "wk"){
		$Qry1 = "SELECT a.*, b.cm3_seq as m_nm1 FROM (
					SELECT $sreg_date , good_type2, SUM(pay_price) as pay_price,  m_nm, division1, division2, em_seq
					FROM t_contract		
					WHERE pay_date BETWEEN '".$syear."-".$smonth."-".$sday."' AND '".$eyear."-".$emonth."-".$eday."'
					".$where_division1."
					".$where_division2."
					".$where_goodtype1."
					".$where_goodtype2."
					".$where_em_seq."
					".$where_em_seq1."
					".$where_m_nm."
					".$where_week."
					".$where_weekdayyn."
					AND del_date IS NULL
					AND sales_type IN (1,3)
					AND agree_state = '3'
					$sgroup_by , division1, division2, em_seq, good_type2				
				) AS a INNER JOIN (
					SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq 
					FROM t_common2 WHERE cm3_seq > 0 AND use_yn='Y' $where_cm3_seq	
				) AS b 
				ON a.good_type2=b.cm2_seq";
		//echo $Qry1;

		/*
		$Qry = "SELECT * FROM (
					SELECT $sreg_date, good_type2, SUM(pay_price) as pay_price, good_type1, m_nm,
							CASE
								WHEN (good_type2 IN ('34','36','430','778','894')) THEN '849' 
								WHEN (good_type2 IN ('458','29','495','710','742','831', '882','957', '975')) THEN '850'
								WHEN (m_nm='496') THEN '851'
								WHEN (m_nm='808') THEN '852'
								WHEN (good_type2 IN ('820', '844', '847','984','985')) THEN '856' 
								WHEN (good_type2 IN ('806')) THEN '870' 
								WHEN (good_type2 IN ('836','468','880','956')) THEN '871' 
								WHEN (m_nm=845) THEN '854'
								WHEN (good_type2 IN ('454')) THEN '872' 
								WHEN (good_type2 IN ('438')) THEN '873' 
								WHEN (m_nm='265') THEN '855'
								WHEN (good_type2 IN ('471', '683')) THEN '874'
								WHEN (good_type2 IN ('823', '841','25','818','470')) THEN '875'
								WHEN (m_nm IN ('42','383')) THEN '853'
								WHEN (good_type2 IN ('564', '566', '800')) THEN '858'
								WHEN (m_nm IN ('969')) THEN '968'
								WHEN (m_nm='302' AND good_type2 NOT IN ('34','36','430','778','458','29','495','710','742','831','820','844','847','806','836','468','454','438','471','683','823','841','25','818','470','564','566', '800')) THEN '859'
							ELSE m_nm
							END AS m_nm1
							FROM t_contract				
							WHERE pay_date BETWEEN '".$syear."-".$smonth."-".$sday."' AND '".$eyear."-".$emonth."-".$eday."'
							".$where_division1."
							".$where_division2."
							".$where_goodtype1."
							".$where_goodtype2."
							".$where_em_seq."
							".$where_em_seq1."
							".$where_m_nm."
							".$where_week."
							".$where_weekdayyn."
							AND del_date IS NULL
							AND sales_type IN (1,3)
							AND agree_state = '3'
							$sgroup_by ,division1, division2, em_seq, good_type2
							ORDER BY pay_date, m_nm, good_type2
				) as aa 
		WHERE 1=1
		".$where_m_nm1."";
		*/

		//echo $Qry;
		$Rst = que($Qry1);

		$nListCnt = 0 ;
		while ($Row = @mysql_fetch_assoc($Rst)) {
			
			$S_RETURNVAL['good_type2'][$Row['m_nm1']][$Row['good_type2']]	= $Row['good_type2'];
			$S_RETURNVAL['m_nm'][$Row['m_nm1']]								= $Row['m_nm1'];

			$S_RETURNVAL['good_type2_price'][$Row['pay_date']][$Row['m_nm1']][$Row['good_type2']]	+= $Row['pay_price'];
			$S_RETURNVAL['pay_date'][$Row['pay_date']]												= $Row['pay_date'];

			$nListCnt++;
		}
		$S_RETURNVAL['nListCnt']= $nListCnt;
		$S_RETURNVAL['view']	= $view;

		return $S_RETURNVAL;

		que_close();

// 주간조회
} else {	

		$Qry = "
			SELECT CONCAT(start,' ~ ',end) as pay_date, SUM(a.pay_price) as pay_price, 
					a.good_type2,a.m_nm,a.division1,a.division2,a.em_seq, b.cm3_seq as m_nm1
			FROM (
					SELECT $sreg_date , good_type2, SUM(pay_price) as pay_price,  m_nm, division1, division2, em_seq,
					        DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date)) DAY), '%Y-%m-%d') as start,
							DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date) - 6) DAY), '%Y-%m-%d') as end
					FROM t_contract		
					WHERE 1=1
					AND pay_date >= '$sweek_start'
					AND pay_date <= '$eweek_end'
					".$where_division1."
					".$where_division2."
					".$where_goodtype1."
					".$where_goodtype2."
					".$where_em_seq."
					".$where_em_seq1."
					".$where_m_nm."
					".$where_week."
					".$where_weekdayyn."
					AND del_date IS NULL
					AND sales_type IN (1,3)
					AND agree_state = '3'
					$sgroup_by , division1, division2, em_seq, good_type2				
				) AS a INNER JOIN (
					SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq 
					FROM t_common2 WHERE cm3_seq > 0 AND use_yn='Y' $where_cm3_seq	
				) AS b 
				ON a.good_type2=b.cm2_seq
				group by pay_date, m_nm1, good_type2 
		";

		echo $Qry;
		$Rst = que($Qry);

		$nListCnt = 0 ;
		while ($Row = @mysql_fetch_assoc($Rst)) {
			
			$S_RETURNVAL['good_type2'][$Row['m_nm1']][$Row['good_type2']]							= $Row['good_type2'];
			$S_RETURNVAL['m_nm'][$Row['m_nm1']]														= $Row['m_nm1'];

			$S_RETURNVAL['good_type2_price'][$Row['pay_date']][$Row['m_nm1']][$Row['good_type2']]	+= $Row['pay_price'];
			$S_RETURNVAL['pay_date'][$Row['pay_date']]												= $Row['pay_date'];
			$S_RETURNVAL['pay_date']																= $week_arr;
			$nListCnt++;
		}
		$S_RETURNVAL['nListCnt']= $nListCnt;
		$S_RETURNVAL['view']	= $view;

		return $S_RETURNVAL;

		que_close();

}
	}
}
//-----------------------------------------------



public function funcDailySales2(){

		if($_GET["good_type1"]) {
			$good_type1 = implode(",",$_GET["good_type1"]);
			$where_goodtype1 = "AND good_type1 = '".$_GET['good_type1']."'";
		}

		if($_GET["m_nm"]) {
			//$good_type1 = implode(",",$_GET["good_type1"]);
			$where_m_nm = "AND m_nm = '".$_GET['m_nm']."'";
		}

		// 상풍구분에서 최상위 상품 선택할 경우(다음, 네이버 등등)
		//if($_GET['good_type2_all']) {
		if($_GET['good_type2']) {
			$good_type2 = implode(",",$_GET["good_type2"]);			
			$where_goodtype2 = "AND good_type2 IN (".$good_type2.")";
			//$where_goodtype2 = "AND good_type2 IN (".getGoodTypeString($good_type2).")";
		}

		// 상품구분에서 개별 선택 할 경우
			if($_GET["good_type2_all"]) {
				$good_type2 = implode(",",$_GET["good_type2_all"]);
				$where_m_nm1 = "AND m_nm1 IN (".$good_type2.")";
			}
		//}

		if($_GET["good_type2_all"]) {
				$good_type2 = implode(",",$_GET["good_type2_all"]);
				$where_m_nm1 = "AND m_nm1 IN (".$good_type2.")";
			}

		if($_SESSION['em_level']==10){
			if($_GET["type_member"]=="2"){
				if($_GET['division1'])	{$division1 = implode(",",$_GET["division1"]); $where_division1	= "AND division1 IN (".$division1.")";}
				if($_GET['division2'])	{$division2 = implode(",",$_GET["division2"]); $where_division2	= "AND division2 IN (".$division2.")";}
				if($_GET['em_nm'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq	 ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq'])		{$where_em_seq1		= "AND em_seq	 ='".$_GET['em_seq']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_GET['division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";

				$_GET['em_nm']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq1= "AND em_seq ='".$_GET['em_seq1']."'";
				$_GET['em_seq']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq']."'";
			}
		}else if($_SESSION['em_level']==20){
			if($_GET["type_member"]=="2"){			

				$where_division1 = "AND division1 ='".$_SESSION['em_division1']."'";
				
				if($_GET['division2'])	{$division2 = implode(",",$_GET["division2"]); $where_division2	= "AND division2 IN (".$division2.")";}
				if($_GET['em_nm'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq'])		{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq1= "AND em_seq ='".$_GET['em_seq1']."'";
				$_GET['em_seq']==""?$where_em_seq = "AND em_seq IN (".$_GET['em_seq'].")":$where_em_seq= "AND em_seq ='".$_GET['em_seq']."'";
			
			}
		}else if($_SESSION['em_level']==30){
			if($_GET["type_member"]=="2"){
				$where_division2 = "AND division1 ='".$_SESSION['em_division1']."' 
									AND division2 ='".$_SESSION['em_division2']."'";

				if($_GET['em_nm'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}

			}else{
				
				$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_SESSION['em_division2']);
				$join_emseq = join($get_emseq,",");
//print_r($get_emseq);
				$where_division1 = "";
				$where_division2 = "";

				if($_GET['em_seq']=='' && $_GET['em_nm']==''){					
					$where_em_seq = "AND em_seq IN (".$join_emseq.")";
				}else{
					//echo "as";
					if($_GET['em_seq']){
						if(in_array($_GET['em_seq'],$get_emseq,true)){$where_em_seq = "AND em_seq = '".$_GET['em_seq']."'";}else{$where_em_seq = "AND em_seq IN (".$join_emseq.")";}
					}
					if($_GET['em_nm']){
						if(in_array($_GET['em_seq1'],$get_emseq,true)){$where_em_seq = "AND em_seq = '".$_GET['em_seq1']."'";}else{$where_em_seq = "AND em_seq IN (".$join_emseq.")";}
					}
				}
			}
			
		}else if($_SESSION['em_level']==40){
			$where_em_seq = "AND em_seq = '".$_SESSION['s_em_seq']."'";
		}

		switch($_GET['cal_kind']){
			//case "d"	:$sreg_date = "pay_date as pay_date";				$sgroup_by="pay_date ";		break;
			//case "m"	:$sreg_date = "left(pay_date,7) as pay_date";		$sgroup_by="LEFT(pay_date,7)";	break;
			//case "y"	:$sreg_date = "LEFT(pay_date,4) as pay_date";		$sgroup_by="LEFT(pay_date,4)";	break;			
			//case "w"	:$sreg_date = "WEEKDAY(pay_date) as pay_date";		$sgroup_by="WEEKDAY(pay_date)";break; //요일별
			//case "wd"	:$sreg_date = "WEEKDAY(pay_date) as pay_date";		$sgroup_by="WEEKDAY(pay_date)";
			//$where_week = "AND WEEKDAY(pay_date) = '".$_GET['week']."'";
			//$where_weekdayyn=$_GET['weekdayyn']=="N"?"AND WEEKDAY(pay_date) NOT IN (0,6)":""; 
			//break; //특정요일break; 
		}

		if($_GET['cs_seq2']){$where_cs_seq_not_in = "AND cs_seq NOT IN ('".$_GET['cs_seq2']."')";}

		if($_GET['syear']){
		$Qry = "
		SELECT * FROM (
		SELECT pay_date, good_type2, SUM(pay_price) as pay_price, good_type1, m_nm, 
				CASE
					WHEN (m_nm=264 AND good_type2 NOT IN (806,339)) THEN '1'
					WHEN (m_nm=41 AND good_type2 NOT IN (458,470,818,25)) THEN '2'
					WHEN (m_nm=496) THEN '3'
					WHEN (m_nm=808) THEN '4'
					WHEN (m_nm=264 AND good_type2=806) THEN '5'
					WHEN (m_nm=302 AND good_type2 IN (458,470,471)) THEN '7'
					WHEN (m_nm IN (41,264) AND good_type2 IN (339,25)) THEN '8'
					WHEN (m_nm IN (42,383,41) AND good_type2 IN (384,26,818)) THEN '9'
					WHEN (m_nm=302 AND good_type2 NOT IN (458,470,471)) THEN '10'
					WHEN (m_nm=265) THEN '11'
					WHEN (m_nm=845) THEN '12'
				ELSE m_nm
				END AS m_nm1
				FROM t_contract				
				WHERE pay_date BETWEEN '".$_GET['syear']."-".$_GET['smonth']."-".$_GET['sday']."' AND '".$_GET['eyear']."-".$_GET['emonth']."-".$_GET['eday']."'
				".$where_division1."
				".$where_division2."
				".$where_em_seq."
				".$where_em_seq1."
				".$where_goodtype1."
				".$where_goodtype2."
				".$where_m_nm."
				".$where_week."
				".$where_weekdayyn."
				".$where_cs_seq_not_in."
				AND del_date IS NULL
				AND sales_type IN (1,3)
				AND agree_state = '3'
				GROUP BY pay_date, m_nm1, good_type2
		) as aa 
		WHERE 1=1
		".$where_m_nm1."";

		//echo $Qry;
		$Rst = que($Qry);

		$nListCnt = 0 ;
		while ($Row = @mysql_fetch_assoc($Rst)) {

			/*
			$S_RETURNVAL['pay_price'][$Row['pay_date']][$Row['m_nm1']][$Row['good_type2']]					+= $Row['pay_price'];
			$S_RETURNVAL['pay_price_m'][substr($Row['pay_date'],0,7)][$Row['m_nm1']][$Row['good_type2']]	+= $Row['pay_price'];
			$S_RETURNVAL['pay_price_y'][substr($Row['pay_date'],0,4)][$Row['m_nm1']][$Row['good_type2']]	+= $Row['pay_price'];
			*/
			$S_RETURNVAL['pay_price'][$Row['pay_date']][$Row['m_nm1']]					+= $Row['pay_price'];
			$S_RETURNVAL['pay_price_m'][substr($Row['pay_date'],0,7)][$Row['m_nm1']]	+= $Row['pay_price'];
			$S_RETURNVAL['pay_price_y'][substr($Row['pay_date'],0,4)][$Row['m_nm1']]	+= $Row['pay_price'];

			$S_RETURNVAL['pay_date'][$Row['pay_date']]									= $Row['pay_date'];
			$S_RETURNVAL['good_type2'][$Row['m_nm1']][$Row['good_type2']]				= $Row['good_type2'];
			$S_RETURNVAL['m_nm1'][$Row['m_nm1']]										= $Row['m_nm1'];

			$nListCnt++;
		}		

		return $S_RETURNVAL;

		que_close();
		}	
	}





	//일자별--------------------
	public function funcDailySales3(){
		
		$cal_kind			= $_GET['cal_kind'];
		//echo $cal_kind;
	if($cal_kind!='wk'){
		if($_GET["good_type1"]) {
			$good_type1 = implode(",",$_GET["good_type1"]);
			$where_goodtype1 = "AND good_type1 = '".$_GET['good_type1']."'";
		}

		if($_GET["m_nm"]) {
			//$good_type1 = implode(",",$_GET["good_type1"]);
			
			$m_nm = implode(",",$_GET["m_nm"]);
			$where_m_nm = "AND m_nm = '".$_GET['m_nm']."'";

			
		}

		// 상풍구분에서 최상위 상품 선택할 경우(다음, 네이버 등등)
		//if($_GET['good_type2_all']) {
		if($_GET['good_type2']) {
			$good_type2 = implode(",",$_GET["good_type2"]);			
			$where_goodtype2 = "AND good_type2 IN (".$good_type2.")";
			//$where_goodtype2 = "AND good_type2 IN (".getGoodTypeString($good_type2).")";
			

		}

		// 상품구분에서 개별 선택 할 경우
			if($_GET["good_type2_all"]) {
				$good_type2 = implode(",",$_GET["good_type2_all"]);
				$where_m_nm1 = "AND m_nm1 IN (".$good_type2.")";				
				$where_cm3_seq	= "AND cm3_seq IN (".$good_type2.")";
			}
		//}

		if($_GET["good_type2_all"]) {
				$good_type2 = implode(",",$_GET["good_type2_all"]);
				$where_m_nm1 = "AND m_nm1 IN (".$good_type2.")";
				$where_cm3_seq	= "AND cm3_seq IN (".$good_type2.")";
		}

		if($_SESSION['em_level']==10){
			if($_GET["type_member"]=="2"){
				if($_GET['division1'])	{$division1 = implode(",",$_GET["division1"]); $where_division1	= "AND division1 IN (".$division1.")";}
				if($_GET['division2'])	{$division2 = implode(",",$_GET["division2"]); $where_division2	= "AND division2 IN (".$division2.")";}
				if($_GET['em_nm'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq	 ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq'])		{$where_em_seq1		= "AND em_seq	 ='".$_GET['em_seq']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_GET['division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";

				$_GET['em_nm']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq1= "AND em_seq ='".$_GET['em_seq1']."'";
				$_GET['em_seq']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq']."'";
			}
		}else if($_SESSION['em_level']==20){
			if($_GET["type_member"]=="2"){			

				$where_division1 = "AND division1 ='".$_SESSION['em_division1']."'";
				
				if($_GET['division2'])	{$division2 = implode(",",$_GET["division2"]); $where_division2	= "AND division2 IN (".$division2.")";}
				if($_GET['em_nm'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq'])		{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq1= "AND em_seq ='".$_GET['em_seq1']."'";
				$_GET['em_seq']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq']."'";
			
			}
		}else if($_SESSION['em_level']==30){
			if($_GET["type_member"]=="2"){
				$where_division2 = "AND division1 ='".$_SESSION['em_division1']."' 
									AND division2 ='".$_SESSION['em_division2']."'";

				if($_GET['em_nm'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}

			}else{
				
				$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_SESSION['em_division2']);
				$join_emseq = join($get_emseq,",");
//print_r($get_emseq);
				$where_division1 = "";
				$where_division2 = "";

				if($_GET['em_seq']=='' && $_GET['em_nm']==''){					
					$where_em_seq = "AND em_seq IN (".$join_emseq.")";
				}else{
					//echo "as";
					if($_GET['em_seq']){
						if(in_array($_GET['em_seq'],$get_emseq,true)){$where_em_seq = "AND em_seq = '".$_GET['em_seq']."'";}else{$where_em_seq = "AND em_seq IN (".$join_emseq.")";}
					}
					if($_GET['em_nm']){
						if(in_array($_GET['em_seq1'],$get_emseq,true)){$where_em_seq = "AND em_seq = '".$_GET['em_seq1']."'";}else{$where_em_seq = "AND em_seq IN (".$join_emseq.")";}
					}
				}
			}
			
		}else if($_SESSION['em_level']==40){
			$where_em_seq = "AND em_seq = '".$_SESSION['s_em_seq']."'";
		}

		switch($_GET['cal_kind']){
			//case "d"	:$sreg_date = "pay_date as pay_date";				$sgroup_by="pay_date ";		break;
			//case "m"	:$sreg_date = "left(pay_date,7) as pay_date";		$sgroup_by="LEFT(pay_date,7)";	break;
			//case "y"	:$sreg_date = "LEFT(pay_date,4) as pay_date";		$sgroup_by="LEFT(pay_date,4)";	break;			
			//case "w"	:$sreg_date = "WEEKDAY(pay_date) as pay_date";		$sgroup_by="WEEKDAY(pay_date)";break; //요일별
			//case "wd"	:$sreg_date = "WEEKDAY(pay_date) as pay_date";		$sgroup_by="WEEKDAY(pay_date)";
			//$where_week = "AND WEEKDAY(pay_date) = '".$_GET['week']."'";
			//$where_weekdayyn=$_GET['weekdayyn']=="N"?"AND WEEKDAY(pay_date) NOT IN (0,6)":""; 
			//break; //특정요일break; 
		}

		if($_GET['cs_seq2']){$where_cs_seq_not_in = "AND cs_seq NOT IN ('".$_GET['cs_seq2']."')";}

		if($_GET['syear']){
		$Qry1 = "SELECT * FROM 
					(SELECT a.*, b.cm3_seq as m_nm1 FROM (
					SELECT pay_date ,  good_type2, SUM(pay_price) as pay_price, good_type1, m_nm
					FROM t_contract		
					WHERE ct_seq > 1 AND pay_date BETWEEN '".$_GET['syear']."-".$_GET['smonth']."-".$_GET['sday']."' AND '".$_GET['eyear']."-".$_GET['emonth']."-".$_GET['eday']."'
					".$where_division1."
					".$where_division2."
					".$where_em_seq."
					".$where_em_seq1."
					".$where_goodtype1."
					".$where_goodtype2."
					".$where_m_nm."
					".$where_week."
					".$where_weekdayyn."
					".$where_cs_seq_not_in."
					AND del_date IS NULL
					AND sales_type IN (1,3)
					AND agree_state = '3'
					GROUP BY pay_date, m_nm, good_type2
				) AS a INNER JOIN (
					SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq 
					FROM t_common2 WHERE cm2_seq > 1 AND cm3_seq > 0 AND use_yn='Y' $where_cm3_seq	
				) AS b 
				ON a.good_type2=b.cm2_seq
				) as c WHERE 1=1 ".$where_m_nm1."";
		//echo $Qry1;
		/*
		$Qry = "
		SELECT * FROM (
		SELECT pay_date, good_type2, SUM(pay_price) as pay_price, good_type1, m_nm, 
				CASE
					WHEN (good_type2 IN ('34','36','430','778', '894')) THEN '849' 
					WHEN (good_type2 IN ('458','29','495','710','742','831', '882','957', '975')) THEN '850'
					WHEN (m_nm='496') THEN '851'
					WHEN (m_nm='808') THEN '852'
					WHEN (good_type2 IN ('820', '844', '847','984','985')) THEN '856' 
					WHEN (good_type2 IN ('806')) THEN '870' 
					WHEN (good_type2 IN ('836','468','880','956')) THEN '871' 
					WHEN (m_nm='845') THEN '854'
					WHEN (good_type2 IN ('454')) THEN '872' 
					WHEN (good_type2 IN ('438')) THEN '873' 
					WHEN (m_nm='265') THEN '855'
					WHEN (good_type2 IN ('471', '683', '976')) THEN '874'
					WHEN (good_type2 IN ('823', '841','25','818','470')) THEN '875'
					WHEN (m_nm IN ('42','383')) THEN '853'
					WHEN (good_type2 IN ('564', '566', '800')) THEN '858'
					WHEN (m_nm IN ('969')) THEN '968'
					WHEN (m_nm='302' AND good_type2 NOT IN ('34','36','430','778','458','29','495','710','742','831','820','844','847','806','836','468','454','438','471','683','823','841','25','818','470','564','566', '800','984','985','981')) THEN '859'
				ELSE m_nm
				END AS m_nm1
				FROM t_contract				
				WHERE pay_date BETWEEN '".$_GET['syear']."-".$_GET['smonth']."-".$_GET['sday']."' AND '".$_GET['eyear']."-".$_GET['emonth']."-".$_GET['eday']."'
				".$where_division1."
				".$where_division2."
				".$where_em_seq."
				".$where_em_seq1."
				".$where_goodtype1."
				".$where_goodtype2."
				".$where_m_nm."
				".$where_week."
				".$where_weekdayyn."
				".$where_cs_seq_not_in."
				AND del_date IS NULL
				AND sales_type IN ('1','3')
				AND agree_state = '3'
				GROUP BY pay_date, m_nm1, good_type2
		) as aa 
		WHERE 1=1
		".$where_m_nm1."";
		*/
		//echo $Qry;
		$Rst = que($Qry1);

		$nListCnt = 0 ;
		while ($Row = @mysql_fetch_assoc($Rst)) {

			/*
			$S_RETURNVAL['pay_price'][$Row['pay_date']][$Row['m_nm1']][$Row['good_type2']]					+= $Row['pay_price'];
			$S_RETURNVAL['pay_price_m'][substr($Row['pay_date'],0,7)][$Row['m_nm1']][$Row['good_type2']]	+= $Row['pay_price'];
			$S_RETURNVAL['pay_price_y'][substr($Row['pay_date'],0,4)][$Row['m_nm1']][$Row['good_type2']]	+= $Row['pay_price'];
			*/
			$S_RETURNVAL['pay_price'][$Row['pay_date']][$Row['m_nm1']]					+= $Row['pay_price'];
			$S_RETURNVAL['pay_price_m'][substr($Row['pay_date'],0,7)][$Row['m_nm1']]	+= $Row['pay_price'];
			$S_RETURNVAL['pay_price_y'][substr($Row['pay_date'],0,4)][$Row['m_nm1']]	+= $Row['pay_price'];

			$S_RETURNVAL['pay_date'][$Row['pay_date']]									= $Row['pay_date'];
			$S_RETURNVAL['good_type2'][$Row['m_nm1']][$Row['good_type2']]				= $Row['good_type2'];
			$S_RETURNVAL['m_nm1'][$Row['m_nm1']]										= $Row['m_nm1'];

			$nListCnt++;
		}
		//echo "<pre>";
		//print_R($S_RETURNVAL);
		//echo "</pre>";

		
		return $S_RETURNVAL;

		que_close();

		}	
	} 
	
	// 주별조회--------------------
	else {
		$syear 					= $_GET['syear'];
		$smonth					= $_GET['smonth'];
		$sday 					= $_GET['sday'];
		$eyear 					= $_GET['eyear'];
		$emonth					= $_GET['emonth'];
		$eday 					= $_GET['eday'];

		$s_date					= $_GET['s_date'];
		$e_date					= $_GET['e_date'];
		$week					= $_GET['week'];
		$weekdayyn				= $_GET['weekdayyn'];

		$cal_kind				= $_GET['cal_kind'];
		$eeday					= $_GET['eeday'];

		// 주의 첫날과 마지막날 계산 START
		$sdate = "$syear-$smonth-$sday";
		$edate = "$eyear-$emonth-$eday";
		// 검색이 일요일일 경우 -1 day
		$yoil = array("일","월","화","수","목","금","토");
		if($yoil[date('w', strtotime($sdate))] === '일'){
			$sdate = date('Y-m-d',strtotime($sdate.'-1 days'));
		}
		if($yoil[date('w', strtotime($edate))] === '일'){
			$edate = date('Y-m-d',strtotime($edate.'-1 days'));
		}

		// 일주일 계산하기 위해 쪼개기
		$sYY = date("Y", strtotime($sdate));
		$sMM = date("m", strtotime($sdate));
		$sDD = date("d", strtotime($sdate));
		$sDay = date("w", strtotime($sdate))-1;

		$eYY = date("Y", strtotime($edate));
		$eMM = date("m", strtotime($edate));
		$eDD = date("d", strtotime($edate));
		$eDay = date("w", strtotime($edate))-1;

		$sweek_start = date("Y-m-d", strtotime($sYY."-".$sMM."-".$sDD." -".$sDay." day"));	// 주의 첫날1
		$sweek_end = date("Y-m-d", strtotime($sweek_start." +6 day"));						// 주의 마지막날1

		$eweek_start = date("Y-m-d", strtotime($eYY."-".$eMM."-".$eDD." -".$eDay." day"));	// 주의 첫날2
		$eweek_end = date("Y-m-d", strtotime($eweek_start." +6 day"));						// 주의 마지막날2

		// 시작일 날짜
		$wsyear					= date("Y", strtotime($sweek_start));
		$wsmonth				= date("m", strtotime($sweek_start));
		$wsday					= date("d", strtotime($sweek_start));
		// 종료일 날짜
		$weyear					= date("Y", strtotime($eweek_end));
		$wemonth				= date("m", strtotime($eweek_end));
		$weday					= date("d", strtotime($eweek_end));

		// 일주일 날짜 계산 => ex) '2021-03-15' ~ '2021-03-21'
		// 날짜 차이
		$diff_date    = strtotime($eweek_end) - strtotime($sweek_start);

		$week_arr = array();
		for($i=0;$i<($diff_date/86400 + 1)/7;$i++){
			$b = 7*$i;
			$prev_date = date("Y-m-d", strtotime(date($sweek_start) . " +".$b." days"))." ~ ".date("Y-m-d", strtotime(date($sweek_end) . "+".$b." days"));
			array_push($week_arr, $prev_date);
		}

		 //echo("요일 : " .$yoil[date('w', strtotime($sdate))]." ");
		 //echo("첫번째날짜닷! : ".$sdate." ");
		 //echo("두번째날짜닷! : ".$edate." ");

		 //echo("이번주 시작일 : ".$sweek_start." ");
		 //echo("이번주 종료일 : ".$sweek_end." ");

		 //echo("이번주 시작일 : ".$eweek_start." ");
		 //echo("이번주 종료일 : ".$eweek_end." ");
		
		if($_GET["good_type1"]) {
			$good_type1 = implode(",",$_GET["good_type1"]);
			$where_goodtype1 = "AND good_type1 = '".$_GET['good_type1']."'";
		}

		if($_GET["m_nm"]) {
			//$good_type1 = implode(",",$_GET["good_type1"]);		
			$m_nm = implode(",",$_GET["m_nm"]);
			$where_m_nm = "AND m_nm = '".$_GET['m_nm']."'";
			
		}

		// 상풍구분에서 최상위 상품 선택할 경우(다음, 네이버 등등)
		//if($_GET['good_type2_all']) {
		if($_GET['good_type2']) {
			$good_type2 = implode(",",$_GET["good_type2"]);			
			$where_goodtype2 = "AND good_type2 IN (".$good_type2.")";
			//$where_goodtype2 = "AND good_type2 IN (".getGoodTypeString($good_type2).")";
			
		}

		// 상품구분에서 개별 선택 할 경우
			if($_GET["good_type2_all"]) {
				$good_type2 = implode(",",$_GET["good_type2_all"]);
				$where_m_nm1 = "AND m_nm1 IN (".$good_type2.")";				
				$where_cm3_seq	= "AND cm3_seq IN (".$good_type2.")";
			}
		//}

		if($_GET["good_type2_all"]) {
				$good_type2 = implode(",",$_GET["good_type2_all"]);
				$where_m_nm1 = "AND m_nm1 IN (".$good_type2.")";
				$where_cm3_seq	= "AND cm3_seq IN (".$good_type2.")";
		}

		if($_SESSION['em_level']==10){
			if($_GET["type_member"]=="2"){
				if($_GET['division1'])	{$division1 = implode(",",$_GET["division1"]); $where_division1	= "AND division1 IN (".$division1.")";}
				if($_GET['division2'])	{$division2 = implode(",",$_GET["division2"]); $where_division2	= "AND division2 IN (".$division2.")";}
				if($_GET['em_nm'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq	 ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq'])		{$where_em_seq1		= "AND em_seq	 ='".$_GET['em_seq']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_GET['division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";

				$_GET['em_nm']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq1= "AND em_seq ='".$_GET['em_seq1']."'";
				$_GET['em_seq']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq']."'";
			}
		}else if($_SESSION['em_level']==20){
			if($_GET["type_member"]=="2"){			

				$where_division1 = "AND division1 ='".$_SESSION['em_division1']."'";
				
				if($_GET['division2'])	{$division2 = implode(",",$_GET["division2"]); $where_division2	= "AND division2 IN (".$division2.")";}
				if($_GET['em_nm'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq'])		{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq']."'";}
			}else{
				$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_GET['division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";
				$_GET['em_nm']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq1= "AND em_seq ='".$_GET['em_seq1']."'";
				$_GET['em_seq']==""?$where_em_seq = "AND em_seq IN (".$join_emseq.")":$where_em_seq= "AND em_seq ='".$_GET['em_seq']."'";
			
			}
		}else if($_SESSION['em_level']==30){
			if($_GET["type_member"]=="2"){
				$where_division2 = "AND division1 ='".$_SESSION['em_division1']."' 
									AND division2 ='".$_SESSION['em_division2']."'";

				if($_GET['em_nm'])		{$where_em_seq		= "AND em_seq    ='".$_GET['em_seq1']."'";}
				if($_GET['em_seq1'])	{$where_em_seq1		= "AND em_seq    ='".$_GET['em_seq1']."'";}

			}else{
				
				$get_emseq	= funGetEmSeq($_SESSION['em_division1'],$_SESSION['em_division2']);
				$join_emseq = join($get_emseq,",");

				$where_division1 = "";
				$where_division2 = "";

				if($_GET['em_seq']=='' && $_GET['em_nm']==''){					
					$where_em_seq = "AND em_seq IN (".$join_emseq.")";
				}else{
					//echo "as";
					if($_GET['em_seq']){
						if(in_array($_GET['em_seq'],$get_emseq,true)){$where_em_seq = "AND em_seq = '".$_GET['em_seq']."'";}else{$where_em_seq = "AND em_seq IN (".$join_emseq.")";}
					}
					if($_GET['em_nm']){
						if(in_array($_GET['em_seq1'],$get_emseq,true)){$where_em_seq = "AND em_seq = '".$_GET['em_seq1']."'";}else{$where_em_seq = "AND em_seq IN (".$join_emseq.")";}
					}
				}
			}
			
		}else if($_SESSION['em_level']==40){
			$where_em_seq = "AND em_seq = '".$_SESSION['s_em_seq']."'";
		}

		switch($_GET['cal_kind']){
			//case "d"	:$sreg_date = "pay_date as pay_date";				$sgroup_by="pay_date ";		break;
			//case "m"	:$sreg_date = "left(pay_date,7) as pay_date";		$sgroup_by="LEFT(pay_date,7)";	break;
			//case "y"	:$sreg_date = "LEFT(pay_date,4) as pay_date";		$sgroup_by="LEFT(pay_date,4)";	break;			
			//case "w"	:$sreg_date = "WEEKDAY(pay_date) as pay_date";		$sgroup_by="WEEKDAY(pay_date)";break; //요일별
			//case "wd"	:$sreg_date = "WEEKDAY(pay_date) as pay_date";		$sgroup_by="WEEKDAY(pay_date)";
			//$where_week = "AND WEEKDAY(pay_date) = '".$_GET['week']."'";
			//$where_weekdayyn=$_GET['weekdayyn']=="N"?"AND WEEKDAY(pay_date) NOT IN (0,6)":""; 
			//break; //특정요일break; 
		}

		if($_GET['cs_seq2']){$where_cs_seq_not_in = "AND cs_seq NOT IN ('".$_GET['cs_seq2']."')";}
		if($_GET['syear']){
				$Qry1 = "SELECT pay_date, good_type2, SUM(pay_price) as pay_price, good_type1, m_nm, m_nm1 FROM 
							(SELECT a.*, b.cm3_seq as m_nm1 FROM (
							SELECT pay_date, good_type2, SUM(pay_price) as pay_price, good_type1, m_nm
							FROM t_contract		
							WHERE pay_date >= '$sweek_start' 
							AND pay_date   <= '$eweek_end'
							".$where_division1."
							".$where_division2."
							".$where_em_seq."
							".$where_em_seq1."
							".$where_goodtype1."
							".$where_goodtype2."
							".$where_m_nm."
							".$where_week."
							".$where_weekdayyn."
							".$where_cs_seq_not_in."
							AND del_date IS NULL
							AND sales_type IN (1,3)
							AND agree_state = '3'
							GROUP BY pay_date, m_nm, good_type2
						) AS a INNER JOIN (
							SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq 
							FROM t_common2 WHERE cm3_seq > 0 AND use_yn='Y' $where_cm3_seq	
						) AS b 
						ON a.good_type2=b.cm2_seq
						) as c WHERE 1=1 ".$where_m_nm1."
						group by pay_date, m_nm1";			
		
				$Qry = "SELECT * FROM 
							(SELECT a.*, b.cm3_seq as m_nm1 FROM (
							SELECT pay_date ,  good_type2, SUM(pay_price) as pay_price, good_type1, m_nm
							FROM t_contract		
							WHERE pay_date >= '$sweek_start' 
							AND pay_date   <= '$eweek_end'
							".$where_division1."
							".$where_division2."
							".$where_em_seq."
							".$where_em_seq1."
							".$where_goodtype1."
							".$where_goodtype2."
							".$where_m_nm."
							".$where_week."
							".$where_weekdayyn."
							".$where_cs_seq_not_in."
							AND del_date IS NULL
							AND sales_type IN (1,3)
							AND agree_state = '3'
							GROUP BY pay_date, m_nm, good_type2
						) AS a INNER JOIN (
							SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq 
							FROM t_common2 WHERE cm3_seq > 0 AND use_yn='Y' $where_cm3_seq	
						) AS b 
						ON a.good_type2=b.cm2_seq
						) as c WHERE 1=1 ".$where_m_nm1."";

		$Rst = que($Qry1);
		$nListCnt = 0 ;
		while ($Row = @mysql_fetch_assoc($Rst)) {

			$S_RETURNVAL['pay_price_wk'][$Row['pay_date']][$Row['m_nm1']]				= $Row['pay_price'];	// 매체별 하루 매출
			$S_RETURNVAL['pay_price']													= $totalMedia;
			$S_RETURNVAL['pay_date'][$Row['pay_date']]									= $Row['pay_date'];
			$S_RETURNVAL['pay_date']													= $week_arr;
			$S_RETURNVAL['good_type2'][$Row['m_nm1']][$Row['good_type2']]				= $Row['good_type2'];
			$S_RETURNVAL['m_nm1'][$Row['m_nm1']]										= $Row['m_nm1'];	
				
			$nListCnt++;
		}
		
		$Rst2 = que($Qry);
		$nListCnt2 = 0 ;
		while ($Row = @mysql_fetch_assoc($Rst2)) {

			$S_RETURNVAL['pay_price'][$Row['pay_date']][$Row['m_nm1']]					+= $Row['pay_price'];
			$nListCnt2++;
		}
	
	// 일주일 데이터 계산 START
	$totalMedia = array();	
	$dateCnt = 1;
	foreach($S_RETURNVAL['pay_price_wk'] as $keys => $values){		// $S_RETURNVAL['pay_price_wk'] = 하루씩 데이터 들어가있는 2차원 배열
		foreach($values as $key => $item){
			$totalMedia[$key] += $item;
		}
		$dateCnt++;
		if($dateCnt % 7 == 1) {
			array_push($S_RETURNVAL, $totalMedia);
			$totalMedia = array();
		} 
	}
	array_push($S_RETURNVAL, $totalMedia);			// 나머지 값 넣기
	// 일주일 데이터 계산 END

	// $S_RETURNVAL['pay_price_week'] 안에 매출 데이터 넣기
	for($i=0;$i<($diff_date/86400 + 1)/7;$i++){
		$S_RETURNVAL['pay_price_week'][$i] = $S_RETURNVAL[$i];			// $S_RETURNVAL['pay_price'] = 일주일 데이터 집어넣은곳
	}

		return $S_RETURNVAL;

		que_close();
		}

	}
}
	



    // 기간 조회
    public function funcSelectContract_date(){
        // --------------------------------------------------날짜 계산----------------------------------------------------------------------------------------------
            if ($_GET["dr_dr1_from"] && $_GET["dr_dr1_to"]) {
                $dr_dr1_from = date("Y-m-d", strtotime($_GET["dr_dr1_from"]));
                $dr_dr1_to = date("Y-m-d", strtotime($_GET["dr_dr1_to"]));
                $Date1 = "pay_date BETWEEN '" . $dr_dr1_from . "' AND '" . $dr_dr1_to . "'";
                $sdate = $dr_dr1_from;
                $edate = $dr_dr1_to;
            } else {
                $today = date("Y-m-d"); //오늘
                $firstDay = date("Y-m-d", mktime(0, 0, 0, intval(date('m')), 1, intval(date('Y')) )); //이번달 1일
                $Date1 = "pay_date BETWEEN '" . $firstDay . "' AND '" . $today . "'"; // 이번달 1일부터 오늘까지
                $sdate = $firstDay;
                $edate = $today;
            }
            if ($_GET["dr_dr2_from"] && $_GET[  "dr_r2_to"]) {
                $dr_dr2_from = date("Y-m-d", strtotime($_GET["dr_dr2_from"]));
                $dr_r2_to = date("Y-m-d", strtotime($_GET["dr_r2_to"]));
            }
            // 검색이 일요일일 경우 -1 day
            $yoil = array("일", "월", "화", "수", "목", "금", "토");
            if ($yoil[date('w', strtotime($sdate))] === '일') {
                $sdate = date('Y-m-d', strtotime($sdate . '-1 days'));
            }
            if ($yoil[date('w', strtotime($edate))] === '일') {
                $edate = date('Y-m-d', strtotime($edate . '-1 days'));
            }
            // 일주일 계산하기 위해 쪼개기
            $sYY = date("Y", strtotime($sdate));
            $sMM = date("m", strtotime($sdate));
            $sDD = date("d", strtotime($sdate));
            $sDay = date("w", strtotime($sdate)) - 1;
            $eYY = date("Y", strtotime($edate));
            $eMM = date("m", strtotime($edate));
            $eDD = date("d", strtotime($edate));
            $eDay = date("w", strtotime($edate)) - 1;
            $sweek_start = date("Y-m-d", strtotime($sYY . "-" . $sMM . "-" . $sDD . " -" . $sDay . " day"));        // 주의 첫날1
            $sweek_end = date("Y-m-d", strtotime($sweek_start . " +6 day"));                                        // 주의 마지막날1
            $eweek_start = date("Y-m-d", strtotime($eYY . "-" . $eMM . "-" . $eDD . " -" . $eDay . " day"));        // 주의 첫날2
            $eweek_end = date("Y-m-d", strtotime($eweek_start . " +6 day"));                                        // 주의 마지막날2
            // 일주일 날짜 계산 => ex) '2021-03-15' ~ '2021-03-21'
            // 날짜 차이
            $diff_date    = strtotime($eweek_end) - strtotime($sweek_start);
            $week_arr = array();
            for ($i = 0; $i < ($diff_date / 86400 + 1) / 7; $i++) {
                $b = 7 * $i;
                $prev_date = date("Y-m-d", strtotime(date($sweek_start) . " +" . $b . " days")) . " ~ " . date("Y-m-d", strtotime(date($sweek_end) . "+" . $b . " days"));
                array_push($week_arr, $prev_date);
            }
            // print_R($week_arr);
            // 주의 첫날과 마지막날 계산 END
        // --------------------------------------------------날짜 계산 끝----------------------------------------------------------------------------------------------  
        // ------------파라미터 변수 설정-------------------
            if ($_GET["check1"]==1) { $code4 = "b.code4"; }
            if ($_GET["check1"]==2) {$code4 = "b.code6";}
            if ($_GET["ad_type"]) {
                $ad_type = implode(",", $_GET['ad_type']);
                $where_code = "AND code4 IN (" . $ad_type . ")";
            }
            if ($_GET["m_nm"]) {
                $m_nm = implode(",", $_GET["m_nm"]);
                $where_code    = "AND code6 IN (" . $m_nm . ")";
            }
            if ($_GET["division1"]) { // 부문
                $where_division1 = "AND division1 = '" . $_GET['division1'] . "'";
            }
            if ($_GET["division2"]) { // 팀
                $where_division2 = "AND division2 = '" . $_GET['division2'] . "'";
            }
            if ($_GET["em_nm"]) { // 사원번호
                $where_em_seq = "AND em_seq = '" . $_GET['em_nm'] . "'";
            }
            if ($_GET["s_item"]) {
                if ($_GET["s_item"] == "cs_m_id") {
                    $where_cs_m_id = "AND cs_m_id = '" . $_GET['s_string'] . "'";
                }
                if ($_GET["s_item"] == "cs_nm") {
                    $where_cs_nm = "AND getCsKrName(cs_seq) = '" . $_GET['s_string'] . "'";
                }
                if ($_GET["s_item"] == "cs_num") {
                    $where_cs_num = " AND cs_seq = (SELECT cs_seq from t_customer WHERE cs_num = '" . $_GET['s_string'] . "')";
                }
            }
            switch ($_GET['cal_kind']) {
                case "d":
                    $sreg_date = "pay_date as pay_date";
                    $sgroup_by = "GROUP BY pay_date ";
                    break;
                case "wk":
                    $sreg_date = "pay_date as pay_date";
                    $sgroup_by = "GROUP BY pay_date ";
                    break;
                case "m":
                    $sreg_date = "left(pay_date,7) as pay_date";
                    $sgroup_by = "GROUP BY left(pay_date,7)";
                    break;
                case "y":
                    $sreg_date = "LEFT(pay_date,4) as pay_date";
                    $sgroup_by = "GROUP BY LEFT(pay_date,4)";
                    break;
                case "w":
                    $sreg_date = "WEEKDAY(pay_date) as pay_date";
                    $sgroup_by = "GROUP BY WEEKDAY(pay_date)";
                    break;
                case "wd":
                    $sreg_date = "WEEKDAY(pay_date) as pay_date";
                    $sgroup_by = "GROUP BY WEEKDAY(pay_date)";
                    $where_week = "AND WEEKDAY(pay_date) = '" . $_GET['week'] . "'";
                    break;
            }
        
        if ($_GET['cal_kind'] != "wk") { // ---------일별조회
            // --------일자별 기간비교 조회
                if ($_GET["dr_dr1_from"] && $_GET["dr_r2_to"]) {
                    $querySelectDailyTwoDate_date = "SELECT t_report.* FROM (
                    SELECT CONCAT('" . $dr_dr1_from . "',' ~ ','" . $dr_dr1_to . "') as pay_date, SUM(a.pay_price) as pay_price, 
                    code5 as good_type2, b.cm3_seq as m_nm1, b.code4 as code4, b.code5 as code5, $code4 as type_code,a.good_type2 as good_type2_1
                    FROM ( 
                            SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm
                            FROM t_contract 
                            WHERE 1=1 
                            AND agree_state = '3' 
                            AND pay_date BETWEEN '" . $dr_dr1_from . "' AND '" . $dr_dr1_to . "' 
                            " . $where_division1 . "
                            " . $where_division2 . "
                            " . $where_em_seq . "
                            " . $where_week . "
                            " . $where_cs_m_id . "
                            " . $where_cs_nm . "                        
                            AND del_date IS NULL 
                            AND sales_type IN (1,3) 
                            " . $where_cs_num . "
                            GROUP BY pay_date , good_type2 
                            ) AS a 
                    INNER JOIN ( 
                            SELECT cm2_seq, cm3_seq, code4, code5, code6
                            FROM t_common2 
                            WHERE use_yn='Y' 
                            AND cm3_seq > 0 
                            $where_code
                            ) AS b ON a.good_type2=b.cm2_seq 	                        
                    group BY a.pay_date, type_code, b.code5
                                ) AS t_report
                    INNER JOIN t_common2 AS t_comm
                    ON t_report.code5 = t_comm.cm2_seq
                    ORDER BY t_comm.sort asc";
                    $Result = que($querySelectDailyTwoDate_date);
                    // echo '<pre>';
                    // echo $querySelectDailyTwoDate_date;
                    // echo '</pre>';
                    // var_dump($Result); 
                    $nListCnt = 0;
                    while ($Row = @mysql_fetch_assoc($Result)) {
                        $S_RETURNVAL['good_type2'][$Row['type_code']][$Row['code5']]                            = $Row['good_type2_1'];
                        $S_RETURNVAL['m_nm'][$Row['type_code']]                                                      = $Row['type_code'];
                        $S_RETURNVAL['good_type2_price'][$Row['pay_date']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                        $S_RETURNVAL['pay_date'][$Row['pay_date']]                                               = $Row['pay_date'];
                        $nListCnt++;
                    }

                    $querySelectDailyTwoDate_date2 = "SELECT t_report.* FROM (
                        SELECT CONCAT('" . $dr_dr2_from . "',' ~ ','" . $dr_r2_to . "') as pay_date, SUM(a.pay_price) as pay_price, code5 as good_type2, 
                                    b.cm3_seq as m_nm1, b.code4 as code4, b.code5 as code5,  $code4 as type_code, a.good_type2 as good_type2_1
                    FROM ( 
                            SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm
                            FROM t_contract 
                            WHERE 1=1 
                            AND agree_state = '3' 
                            AND pay_date BETWEEN '" . $dr_dr2_from . "' AND '" . $dr_r2_to . "' 
                            " . $where_division1 . "
                            " . $where_division2 . "
                            " . $where_em_seq . "
                            " . $where_week . "
                            " . $where_cs_m_id . "
                            " . $where_cs_nm . "                        
                            AND del_date IS NULL 
                            AND sales_type IN (1,3) 
                            " . $where_cs_num . "
                            GROUP BY pay_date, good_type2 
                            ) AS a 
                    INNER JOIN ( 
                            SELECT cm2_seq, cm3_seq, code4, code5, code6
                            FROM t_common2 
                            WHERE use_yn='Y' 
                            AND cm3_seq > 0 
                            $where_code
                            ) AS b ON a.good_type2=b.cm2_seq 
                    group BY a.pay_date, type_code, b.code5
                                ) AS t_report
                            INNER JOIN t_common2 AS t_comm
                            ON t_report.code5 = t_comm.cm2_seq
                            ORDER BY t_comm.sort asc";
                    $Result = que($querySelectDailyTwoDate_date2);
                    $nListCnt = 0;
                    while ($Row = @mysql_fetch_assoc($Result)) {
                        $S_RETURNVAL['good_type2'][$Row['type_code']][$Row['code5']]                            = $Row['good_type2_1'];
                        $S_RETURNVAL['m_nm'][$Row['type_code']]                                                      = $Row['type_code'];
                        $S_RETURNVAL['good_type2_price'][$Row['pay_date']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                        $S_RETURNVAL['pay_date'][$Row['pay_date']]                                               = $Row['pay_date'];
                        $nListCnt++;
                    }            
                    // echo '<pre>';
                    // echo $querySelectDailyTwoDate_date2;
                    // echo '</pre>';
                    // var_dump($Result);    
                    $S_RETURNVAL['nListCnt'] = $nListCnt;
                    return $S_RETURNVAL;
                    que_close();
            // -----일자별 단일기간 조회
                } else { 
                    $querySelectDailyOneDate_date = "SELECT t_report.* FROM (
                    SELECT a.pay_date, code5 as good_type2 , a.m_nm, SUM(a.pay_price) AS pay_price, b.cm3_seq as m_nm1, code4 as code4, code5 as code5, $code4 as type_code, a.good_type2 as good_type2_1
                                FROM (
                                    SELECT $sreg_date , good_type2, SUM(pay_price) as pay_price,  m_nm
                                    FROM t_contract		
                                    WHERE $Date1
                                    AND agree_state = '3'
                                    " . $where_division1 . "
                                    " . $where_division2 . "
                                    " . $where_em_seq . "
                                    " . $where_week . "
                                    " . $where_cs_m_id . "
                                    " . $where_cs_nm . "    
                                    AND del_date IS NULL
                                    AND sales_type IN (1,3)
                                    " . $where_cs_num . "
                                    $sgroup_by , good_type2
                                ) AS a INNER JOIN (
                                    SELECT cm2_seq, cm3_seq, code4, code5, code6
                                    FROM t_common2 
                                    WHERE use_yn='Y' 
                                    $where_code
                                ) AS b 
                                ON a.good_type2=b.cm2_seq
                                GROUP BY pay_date, type_code, code5
                                                            ) AS t_report
                                INNER JOIN t_common2 AS t_comm
                                ON t_report.code5 = t_comm.cm2_seq
                                ORDER BY t_report.pay_date, t_comm.sort asc";
                    $Result = que($querySelectDailyOneDate_date);
                    // echo '<pre>';
                    // echo $querySelectDailyOneDate_date;
                    // echo '</pre>';
                    // var_dump($Result);
                    $nListCnt = 0;
                    while ($Row = @mysql_fetch_assoc($Result)) {
                        $S_RETURNVAL['good_type2'][$Row['type_code']][$Row['code5']]                            = $Row['good_type2_1'];
                        $S_RETURNVAL['m_nm'][$Row['type_code']]                                                      = $Row['type_code'];
                        $S_RETURNVAL['good_type2_price'][$Row['pay_date']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                        $S_RETURNVAL['pay_date'][$Row['pay_date']]                                               = $Row['pay_date'];
                        $S_RETURNVAL['division1']                                                                = $Row['division1'];
                        $nListCnt++;
                    }
                    $S_RETURNVAL['nListCnt'] = $nListCnt;
                    return $S_RETURNVAL;
                    que_close();
                }
        } else { // ---------주별조회
            if(!$_GET['dr_r2_to']){ //주별 단일기간 조회
                $querySelectWeekly_date = "SELECT t_report.* FROM (
                                SELECT CONCAT(start,' ~ ',end) as pay_date, code5 AS good_type2, SUM(a.pay_price) as pay_price, b.cm3_seq as m_nm1,
                                b.code4 as code4, b.code5 as CODE5, $code4 as type_code, good_type2 as good_type2_1
                                FROM (
                                    SELECT $sreg_date , good_type2, SUM(pay_price) as pay_price,  m_nm,
                                    if(DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date)) DAY), '%Y-%m-%d') < '$sdate', '$sdate',DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date)) DAY), '%Y-%m-%d')) as start,
                                    if(DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date) - 6) DAY), '%Y-%m-%d') > '$edate', '$edate',DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date) - 6) DAY), '%Y-%m-%d')) as end
                                    FROM t_contract		
                                    WHERE 1=1
                                    AND pay_date >= '$sdate'
                                    AND pay_date <= '$edate'
                                    " . $where_division1 . "
                                    " . $where_division2 . "
                                    " . $where_em_seq . "
                                    " . $where_week . "
                                    " . $where_cs_m_id . "
                                    " . $where_cs_nm . "   
                                    AND del_date IS NULL
                                    AND sales_type IN (1,3)
                                    AND agree_state = '3'
                                    " . $where_cs_num . "
                                    $sgroup_by , good_type2				
                                ) AS a INNER JOIN (
                                    SELECT cm2_seq, cm3_seq, code4, code5, code6
                                    FROM t_common2 
                                    WHERE use_yn='Y' 
                                    $where_code
                                ) AS b 
                                ON a.good_type2=b.cm2_seq
                                group by pay_date, type_code, b.code5
                            ) AS t_report
                        INNER JOIN t_common2 AS t_comm
                        ON t_report.code5 = t_comm.cm2_seq
                        ORDER BY t_report.pay_date, t_comm.sort asc";
                $Rst = que($querySelectWeekly_date);
                // echo '<pre>';
                // echo $querySelectWeekly_date;
                // echo '</pre>';
                // var_dump($Rst);
                $nListCnt = 0;
                while ($Row = @mysql_fetch_assoc($Rst)) {
                    $S_RETURNVAL['good_type2'][$Row['type_code']][$Row['good_type2']]                            = $Row['good_type2_1'];
                    $S_RETURNVAL['m_nm'][$Row['type_code']]                                                      = $Row['type_code'];
                    $S_RETURNVAL['good_type2_price'][$Row['pay_date']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                    $S_RETURNVAL['pay_date'][$Row['pay_date']]                                                = $Row['pay_date'];
                    $S_RETURNVAL['pay_date_1']                                                                = $Row['pay_date'];
                    $S_RETURNVAL['division1']                                                                = $Row['division1'];
                }
                return $S_RETURNVAL;

                que_close();
            }else{                  // 주별 비교기간 조회
                $querySelectDailyTwoDate_date = "SELECT t_report.* FROM (
                    SELECT CONCAT('" . $dr_dr1_from . "',' ~ ','" . $dr_dr1_to . "') as pay_date, SUM(a.pay_price) as pay_price, 
                    code5 as good_type2, b.cm3_seq as m_nm1, b.code4 as code4, b.code5 as code5, $code4 as type_code,a.good_type2 as good_type2_1
                    FROM ( 
                            SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm
                            FROM t_contract 
                            WHERE 1=1 
                            AND agree_state = '3' 
                            AND pay_date BETWEEN '" . $dr_dr1_from . "' AND '" . $dr_dr1_to . "' 
                            " . $where_division1 . "
                            " . $where_division2 . "
                            " . $where_em_seq . "
                            " . $where_week . "
                            " . $where_cs_m_id . "
                            " . $where_cs_nm . "                        
                            AND del_date IS NULL 
                            AND sales_type IN (1,3) 
                            " . $where_cs_num . "
                            GROUP BY pay_date , good_type2 
                            ) AS a 
                    INNER JOIN ( 
                            SELECT cm2_seq, cm3_seq, code4, code5, code6
                            FROM t_common2 
                            WHERE use_yn='Y' 
                            AND cm3_seq > 0 
                            $where_code
                            ) AS b ON a.good_type2=b.cm2_seq 	                        
                    group BY a.pay_date, type_code, b.code5
                                ) AS t_report
                    INNER JOIN t_common2 AS t_comm
                    ON t_report.code5 = t_comm.cm2_seq
                    ORDER BY t_comm.sort asc";
                    $Result = que($querySelectDailyTwoDate_date);

                    $nListCnt = 0;
                    while ($Row = @mysql_fetch_assoc($Result)) {
                        $S_RETURNVAL['good_type2'][$Row['type_code']][$Row['code5']]                            = $Row['good_type2_1'];
                        $S_RETURNVAL['m_nm'][$Row['type_code']]                                                      = $Row['type_code'];
                        $S_RETURNVAL['good_type2_price'][$Row['pay_date']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                        $S_RETURNVAL['pay_date'][$Row['pay_date']]                                               = $Row['pay_date'];
                        $nListCnt++;
                    }
                    // echo $querySelectDailyTwoDate_date;
                    // var_dump($Result);
                    $querySelectDailyTwoDate_date2 = "SELECT t_report.* FROM (
                        SELECT CONCAT('" . $dr_dr2_from . "',' ~ ','" . $dr_r2_to . "') as pay_date, SUM(a.pay_price) as pay_price, code5 as good_type2, 
                                    b.cm3_seq as m_nm1, b.code4 as code4, b.code5 as code5,  $code4 as type_code, a.good_type2 as good_type2_1
                    FROM ( 
                            SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm
                            FROM t_contract 
                            WHERE 1=1 
                            AND agree_state = '3' 
                            AND pay_date BETWEEN '" . $dr_dr2_from . "' AND '" . $dr_r2_to . "' 
                            " . $where_division1 . "
                            " . $where_division2 . "
                            " . $where_em_seq . "
                            " . $where_week . "
                            " . $where_cs_m_id . "
                            " . $where_cs_nm . "                        
                            AND del_date IS NULL 
                            AND sales_type IN (1,3) 
                            " . $where_cs_num . "
                            GROUP BY pay_date, good_type2 
                            ) AS a 
                    INNER JOIN ( 
                            SELECT cm2_seq, cm3_seq, code4, code5, code6
                            FROM t_common2 
                            WHERE use_yn='Y' 
                            AND cm3_seq > 0 
                            $where_code
                            ) AS b ON a.good_type2=b.cm2_seq 
                    group BY a.pay_date, type_code, b.code5
                                ) AS t_report
                            INNER JOIN t_common2 AS t_comm
                            ON t_report.code5 = t_comm.cm2_seq
                            ORDER BY t_comm.sort asc";
                    $Result = que($querySelectDailyTwoDate_date2);
                    $nListCnt = 0;
                    while ($Row = @mysql_fetch_assoc($Result)) {
                        $S_RETURNVAL['good_type2'][$Row['type_code']][$Row['code5']]                            = $Row['good_type2_1'];
                        $S_RETURNVAL['m_nm'][$Row['type_code']]                                                      = $Row['type_code'];
                        $S_RETURNVAL['good_type2_price'][$Row['pay_date']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                        $S_RETURNVAL['pay_date'][$Row['pay_date']]                                               = $Row['pay_date'];
                        $nListCnt++;
                    }            
                    // echo '<pre>';
                    // echo $querySelectDailyTwoDate_date2;
                    // echo '</pre>';
                    // var_dump($Result);    
                    $S_RETURNVAL['nListCnt'] = $nListCnt;
                    return $S_RETURNVAL;
                    que_close();
            }
        }
    }
    // 고정차트데이터
    public function funcGoogleChartData(){
        //변수 설정
            if ($_GET["dr_dr1_from"] && $_GET["dr_dr1_to"]) {
                $dr_dr1_from = date("Y-m-d", strtotime($_GET["dr_dr1_from"]));
                $dr_dr1_to = date("Y-m-d", strtotime($_GET["dr_dr1_to"]));
                $Date1 = "BETWEEN '" . $dr_dr1_from . "' AND '" . $dr_dr1_to . "'";
                $sdate1 = $dr_dr1_from;
                $edate1 = $dr_dr1_to;
            }
            if ($_GET["dr_dr2_from"] && $_GET["dr_r2_to"]) {
                $dr_dr2_from = date("Y-m-d", strtotime($_GET["dr_dr2_from"]));
                $dr_r2_to = date("Y-m-d", strtotime($_GET["dr_r2_to"]));
                $Date2 = "BETWEEN '" . $dr_dr2_from . "' AND '" . $dr_r2_to . "'";
                $sdate2 = $dr_dr2_from;
                $edate2 = $dr_r2_to;
            }
            if ($_GET["division1"]) { // 부문
                $where_division1 = "AND division1 = '" . $_GET['division1'] . "'";
            }
            if ($_GET["division2"]) { // 팀
                $where_division2 = "AND division2 = '" . $_GET['division2'] . "'";
            }
            if ($_GET["em_nm"]) { // 사원번호
                $where_em_seq = "AND em_seq = '" . $_GET['em_nm'] . "'";
            }
            if ($_GET["s_item"]) {
                if ($_GET["s_item"] == "cs_m_id") {
                    $where_cs_m_id = "AND cs_m_id = '" . $_GET['s_string'] . "'";
                }
                if ($_GET["s_item"] == "cs_nm") {
                    $where_cs_nm = "AND getCsKrName(cs_seq) = '" . $_GET['s_string'] . "'";
                }
                if ($_GET["s_item"] == "cs_num") {
                    $where_cs_num = " AND cs_seq = (SELECT cs_seq from t_customer WHERE cs_num = '" . $_GET['s_string'] . "')";
                }
            }
            switch ($_GET['cal_kind']) {
                case "d":
                    $sreg_date = "pay_date as pay_date";
                    $sgroup_by = "GROUP BY pay_date ";
                    break;
                case "wk":
                    $sreg_date = "pay_date as pay_date2";
                    $sgroup_by = "GROUP BY pay_date ";
                    break;
                case "m":
                    $sreg_date = "left(pay_date,7) as pay_date";
                    $sgroup_by = "GROUP BY left(pay_date,7)";
                    break;
                case "y":
                    $sreg_date = "LEFT(pay_date,4) as pay_date";
                    $sgroup_by = "GROUP BY LEFT(pay_date,4)";
                    break;
            }


        if ($_GET["dr_dr1_from"] && $_GET["dr_dr1_to"]) {
            $Qry = "SELECT CONCAT(start,' ~ ',end) as pay_date, a.good_type2, sum(a.pay_price)as pay_price, a.m_nm, a.cs_m_id, b.cm3_seq as m_nm1, code4 as code4
            FROM ( 
                    SELECT $sreg_date, good_type2, SUM(pay_price) as pay_price, m_nm, cs_m_id,
            if(DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date)) DAY), '%Y-%m-%d') < '$sdate1', '$sdate1',DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date)) DAY), '%Y-%m-%d')) as START,            
            if(DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date) - 6) DAY), '%Y-%m-%d') > '$edate1', '$edate1',DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date) - 6) DAY), '%Y-%m-%d')) as END
                    FROM t_contract 
                    WHERE pay_date $Date1
                    " . $where_division1 . "
                    " . $where_division2 . "
                    " . $where_em_seq . "
                    " . $where_cs_m_id . "
                    " . $where_cs_nm . "    
                    " . $where_cs_num . " 
                    AND del_date IS NULL
                    AND sales_type IN (1,3) 
                    AND agree_state = '3' 
                    $sgroup_by
                    ) AS a 
            INNER JOIN ( 
                    SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq, code4 
                    FROM t_common2 
                    WHERE cm3_seq > 0 
                    AND use_yn='Y' 
                    ) AS b ON a.good_type2=b.cm2_seq
                    group by pay_date";
            $Rst = que($Qry);
            // var_dump($Rst);
            // echo '<pre>';
            // echo $Qry;
            // echo '</pre>';
            $nListCnt = 0;

            // 날짜에 따라서 그래프에 사용되는 변수(날짜값)이 변경
                if($_GET['cal_kind']=='d'){
                    $day_type = "d";
                    $day_name = "day";
                    $day_ymd = "Y-m-d";
                }else if($_GET['cal_kind']=='m'){
                    $day_type = "m";
                    $day_name = "month";
                    $day_ymd = "Y-m";
                }else if($_GET['cal_kind']=='y'){
                    $day_type = "y";
                    $day_name = "year";
                    $day_ymd = "Y";
                }else if($_GET['cal_kind']=='wk'){
                    $day_type = "d";
                    $day_name = "day";
                    $day_ymd = "Y-m-d";
                }


                $tempDate = array();
                $tempDate2 = array();
                // if($_GET['cal_kind']!=="wk"){
                    $a = (date($day_type, strtotime($_GET["dr_dr1_to"]))*1 ) - (date($day_type, strtotime($_GET["dr_dr1_from"]))*1 );
                    $b = (date($day_type, strtotime($_GET["dr_r2_to"]))*1 ) - (date($day_type, strtotime($_GET["dr_dr2_from"]))*1 );
                    $c = $a > $b ? $a : $b;
                    for($i=0; $i<=$c;$i++){
                        array_push($tempDate,$i);
                    }
                    for($i=0; $i<=$c;$i++){
                        array_push($tempDate2,date($day_ymd, strtotime("+".$i.$day_name, strtotime($_GET["dr_dr1_from"]))));
                    }
                // }
            // print_r($tempDate2);

            $count = 0;
            while ($Row = @mysql_fetch_assoc($Rst)) {
                $S_RETURNVAL['pay_price'][1][$count]    += $Row['pay_price'];
                $S_RETURNVAL['pay_price2'][1][$count]    += $Row['pay_price'];
                $S_RETURNVAL['pay_date'] = $tempDate;
                $S_RETURNVAL['pay_date2'] = $tempDate2;
                $S_RETURNVAL['pay_date3'][1] = $Row['pay_date'];
                $S_RETURNVAL['pay_date_wk'][$count] = $Row['pay_date'];
                $S_RETURNVAL['pay_date_wk_count'][$count] = $count;
                $S_RETURNVAL['sales_type'][1]    = "1";
                $nListCnt++;
                $count++;
            }
            // 비교대상 쿼리
                if ($_GET["dr_dr2_from"] && $_GET["dr_r2_to"]) {
                    $Qry2 = "SELECT CONCAT(start,' ~ ',end) as pay_date, a.good_type2, sum(a.pay_price)as pay_price, a.m_nm, a.cs_m_id, b.cm3_seq as m_nm1, code4 as code4
                    FROM ( 
                            SELECT $sreg_date, good_type2, SUM(pay_price) as pay_price, m_nm, cs_m_id,
                        if(DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date)) DAY), '%Y-%m-%d') < '$sdate2', '$sdate2',DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date)) DAY), '%Y-%m-%d')) as START,            
                        if(DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date) - 6) DAY), '%Y-%m-%d') > '$edate2', '$edate2',DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date) - 6) DAY), '%Y-%m-%d')) as END
                                        FROM t_contract 
                                        WHERE pay_date $Date2
                                        " . $where_division1 . "
                                        " . $where_division2 . "
                                        " . $where_em_seq . "
                                        " . $where_cs_m_id . "
                                        " . $where_cs_nm . "    
                                        AND del_date IS NULL
                                        AND sales_type IN (1,3) 
                                        AND agree_state = '3' 
                                        $sgroup_by
                                        ) AS a 
                                INNER JOIN ( 
                                        SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq, code4 
                                        FROM t_common2 
                                        WHERE cm3_seq > 0 
                                        AND use_yn='Y' 
                                        ) AS b ON a.good_type2=b.cm2_seq
                                        group by pay_date";
                    $Rst = que($Qry2);
                    $nListCnt = 0;
                    $count = 0;
                    // var_dump($Rst);
                    // echo '<pre>';
                    // echo $Qry2;
                    // echo '</pre>';
                    while ($Row = @mysql_fetch_assoc($Rst)) {
                        $S_RETURNVAL['pay_price']["3"][$count]    += $Row['pay_price'];
                        $S_RETURNVAL['pay_price2']["3"][$count]    += $Row['pay_price'];
                        $S_RETURNVAL['pay_date3']["3"] = $Row['pay_date'];
                        $S_RETURNVAL['sales_type']["3"]    = "3";
                        $nListCnt++;
                        $count++;
                    }
                }
                return $S_RETURNVAL;
                que_close();
        }
    }
    // 계정 리스트
    public function funcSelectCsList(){
        // 날짜 설정
            //첫번쨰 날짜만 있는 경우 (일별 단일 조회)
                if ($_GET["sdate1"] && !$_GET["sdate2"]) {
                    $sdate01 = "'" . $_GET['sdate1'] . "'";
                    $sdate = "pay_date = ".$sdate01."";
                    if($_GET['cal_kind']== 'm'){
                        $sdate = "pay_date BETWEEN  '".$_GET["getDate1"]."' AND '".$_GET["getDate2"]."'";
                    }
                    if($_GET["cal_kind"]=="y"){
                        $sdate = "pay_date BETWEEN  '".$_GET["getDate1"]."' AND '".$_GET["getDate2"]."'";
                    }
                }
            // yyyymmdd yyyymmdd 로 넘어오는경우
                if ($_GET["sdate1"] && $_GET["sdate2"]) {
                    $sdate01 = "'" . $_GET['sdate1'] . "'";
                    $sdate02 = "'" . $_GET['sdate2'] . "'";
                    $sdate = "pay_date BETWEEN " . $sdate01 . "AND ".$sdate02."";
                    
                    if(strlen($_GET['sdate1'])==8){
                        if(!$_GET["cal_kind"]=="m"){
                            $sdate01 = "'" . $_GET['sdate1'] . "'";
                            $s_year = $sdate01[1].$sdate01[2].$sdate01[3].$sdate01[4];
                            $s_month = $sdate01[5].$sdate01[6];
                            $s_day = $sdate01[7].$sdate01[8];
                            $sdate_ymd = $s_year.'-'.$s_month.'-'.$s_day;

                            $sdate02 = "'" . $_GET['sdate2'] . "'";
                            $e_year = $sdate02[1].$sdate02[2].$sdate02[3].$sdate02[4];
                            $e_month = $sdate02[5].$sdate02[6];
                            $e_day = $sdate02[7].$sdate02[8];
                            $edate_ymd = $e_year.'-'.$e_month.'-'.$e_day;

                            $sdate = "pay_date BETWEEN '".$sdate_ymd."' AND '".$edate_ymd."'";
                        }
                        if($_GET['type']=='customer'){
                            $sdate01 = "'" . $_GET['sdate1'] . "'";
                            $sdate02 = "'" . $_GET['sdate2'] . "'";
                            $sdate = "pay_date BETWEEN " . $sdate01 . "AND ".$sdate02."";
                        }
                    }
                    // yyyy-mm-dd 형식으로 정상적으로 넘어오는경우
                        if($_GET['type']=='division'){
                            if(!count($_GET['sdate1'])==10){
                                $sdate01 = "'" . $_GET['sdate1'] . "'";
                                $s_year = $sdate01[1].$sdate01[2].$sdate01[3].$sdate01[4];
                                $s_month = $sdate01[5].$sdate01[6];
                                $s_day = $sdate01[7].$sdate01[8];
                                $sdate_ymd = $s_year.'-'.$s_month.'-'.$s_day;

                                $sdate02 = "'" . $_GET['sdate2'] . "'";
                                $e_year = $sdate02[1].$sdate02[2].$sdate02[3].$sdate02[4];
                                $e_month = $sdate02[5].$sdate02[6];
                                $e_day = $sdate02[7].$sdate02[8];
                                $edate_ymd = $e_year.'-'.$e_month.'-'.$e_day;

                                $sdate = "pay_date BETWEEN '".$sdate_ymd."' AND '".$edate_ymd."'";
                            }
                        }
                }
            //
            if (!$_GET["sdate1"]) {
                if ($_GET["sdate"] && $_GET["edate"]) {
                    $sdate_8 = "'" . $_GET['sdate'] . "'";
                    $s_year = $sdate_8[1].$sdate_8[2].$sdate_8[3].$sdate_8[4];
                    $s_month = $sdate_8[5].$sdate_8[6];
                    $s_day = $sdate_8[7].$sdate_8[8];
                    $sdate_8 = $s_year.'-'.$s_month.'-'.$s_day;
                    $edate_8 = "'" . $_GET['edate'] . "'";
                    $e_year = $edate_8[1].$edate_8[2].$edate_8[3].$edate_8[4];
                    $e_month = $edate_8[5].$edate_8[6];
                    $e_day = $edate_8[7].$edate_8[8];
                    $edate_8 = $e_year.'-'.$e_month.'-'.$e_day;
                    $sdate = "pay_date BETWEEN '".$sdate_8."' AND '".$edate_8."'";
                }       
                $day_7ago = date("Y-m-d", strtotime("-7 Day"));
                $today = date("Y-m-d");
                $day_1ago = date("Y-m-d", strtotime("-1 Day"));
                // $sdate = "pay_date BETWEEN  '".$day_7ago."-1' AND '".$today."-31'";
                if($_GET['cal_kind']== 'd'){
                    if ($_GET["sdate"] && $_GET["edate"]) {
                        $sdate_8 = "'" . $_GET['sdate'] . "'";
                        $s_year = $sdate_8[1].$sdate_8[2].$sdate_8[3].$sdate_8[4];
                        $s_month = $sdate_8[5].$sdate_8[6];
                        $s_day = $sdate_8[7].$sdate_8[8];
                        $sdate_8 = $s_year.'-'.$s_month.'-'.$s_day;
                        $edate_8 = "'" . $_GET['edate'] . "'";
                        $e_year = $edate_8[1].$edate_8[2].$edate_8[3].$edate_8[4];
                        $e_month = $edate_8[5].$edate_8[6];
                        $e_day = $edate_8[7].$edate_8[8];
                        $edate_8 = $e_year.'-'.$e_month.'-'.$e_day;
                        $sdate = "pay_date BETWEEN '".$sdate_8."' AND '".$edate_8."'";
                    }else{
                        $sdate = "pay_date BETWEEN  '".$day_7ago."' AND '".$day_1ago."'";
                    }
                }
                if($_GET['cal_kind']== 'wk'){
                    if($_GET['type']=='date'){
                        if ($_GET["sdate"] && $_GET["edate"]) {
                            $sdate_8 = "'" . $_GET['sdate'] . "'";
                            $s_year = $sdate_8[1].$sdate_8[2].$sdate_8[3].$sdate_8[4];
                            $s_month = $sdate_8[5].$sdate_8[6];
                            $s_day = $sdate_8[7].$sdate_8[8];
                            $sdate_8 = $s_year.'-'.$s_month.'-'.$s_day;
                            $edate_8 = "'" . $_GET['edate'] . "'";
                            $e_year = $edate_8[1].$edate_8[2].$edate_8[3].$edate_8[4];
                            $e_month = $edate_8[5].$edate_8[6];
                            $e_day = $edate_8[7].$edate_8[8];
                            $edate_8 = $e_year.'-'.$e_month.'-'.$e_day;
                            $sdate = "pay_date BETWEEN '".$sdate_8."' AND '".$edate_8."'";
                        }        
                    }else{
                        $day_7ago = date("Y-m-d", strtotime("-7 Day"));
                        $day_yesterday = date("Y-m-d", strtotime("-1 Day"));
                        $sdate01 = "'" . $day_yesterday . "'";
                        $sdate = "pay_date BETWEEN  '".$day_7ago."' AND '".$day_yesterday."'";
                        $timestamp = strtotime("-1 month");
                        $timestamp2 = strtotime("-1 day");
                        $sdate = date("Y-m-d H:i:s", $timestamp);
                        $edate = date("Y-m-d H:i:s", $timestamp2);
                        $yoil = array("일", "월", "화", "수", "목", "금", "토");
                        if ($yoil[date('w', strtotime($sdate))] === '일') {
                            $sdate = date('Y-m-d', strtotime($sdate . '-1 days'));
                        }
                        if ($yoil[date('w', strtotime($edate))] === '일') {
                            $edate = date('Y-m-d', strtotime($edate . '-1 days'));
                        }
                        $sYY = date("Y", strtotime($sdate));
                        $sMM = date("m", strtotime($sdate));
                        $sDD = date("d", strtotime($sdate));
                        $sDay = date("w", strtotime($sdate)) - 1;
                        $eYY = date("Y", strtotime($edate));
                        $eMM = date("m", strtotime($edate));
                        $eDD = date("d", strtotime($edate));
                        $eDay = date("w", strtotime($edate)) - 1;
                        $sweek_start = date("Y-m-d", strtotime($sYY . "-" . $sMM . "-" . $sDD . " -" . $sDay . " day"));    // 주의 첫날1
                        $sweek_end = date("Y-m-d", strtotime($sweek_start . " +6 day"));                        // 주의 마지막날1
                        $eweek_start = date("Y-m-d", strtotime($eYY . "-" . $eMM . "-" . $eDD . " -" . $eDay . " day"));    // 주의 첫날2
                        $eweek_end = date("Y-m-d", strtotime($eweek_start . " +6 day"));                        // 주의 마지막날2
                        $sdate = "pay_date BETWEEN  '".$sweek_start."' AND '".$eweek_end."'";
                    }
                }            
            }
            //echo $sdate;
        // 변수설정
            if ($_GET["good_type2"]) {
                $code5 = $_GET['good_type2'];
                $where_code5 = "AND code5 = " . $code5;
            }
            if ($_GET["division1"]) {
                $division1 = $_GET['division1'];
                $where_division1 = "AND division1 = " . $division1;
            }
            if ($_GET["division2"]) {
                $division2 = $_GET['division2'];
                $where_division2 = "AND division2 = " . $division2;
            }
            if ($_GET["em_seq"]) {
                $em_seq = $_GET['em_seq'];
                $where_em_seq = "AND em_seq = " . $em_seq;
            }
            if ($_GET["s_item"]) {
                if ($_GET["s_item"] == "cs_m_id") {
                    $where_cs_m_id = "AND cs_m_id = '" . $_GET['s_string'] . "'";
                }
                if ($_GET["s_item"] == "cs_nm") {
                    $where_cs_nm = "AND getCsKrName(cs_seq) = '" . $_GET['s_string'] . "'";
                }
                if ($_GET["s_item"] == "cs_num") {
                    $where_cs_num = " AND cs_seq = (SELECT cs_seq from t_customer WHERE cs_num = '" . $_GET['s_string'] . "')";
                }
            }
            if($_GET['division_type']){
                if($_GET['division_type'] == '6' || $_GET['division_type'] == '대대행'){
                        $where_division1 = "AND division1 = 6";
                }else if($_GET['division_type'] == '809' || $_GET['division_type'] == '디지털플래닝'){
                    $where_division1 = "AND division1 = 809";
                }            
                else if($_GET['division_type'] == '926' || $_GET['division_type'] == '광고사업1부문'){
                    $where_division1 = "AND division1 = 926";
                }
                else if($_GET['division_type'] == '927' || $_GET['division_type'] == '광고사업2부문'){
                    $where_division1 = "AND division1 = 927";
                }
                else if($_GET['division_type'] == '928' || $_GET['division_type'] == '광고사업3부문'){
                    $where_division1 = "AND division1 = 928";
                }
                else if($_GET['division_type'] == '930' || $_GET['division_type'] == '미래사업부문'){
                    $where_division1 = "AND division1 = 930";
                }
                else if($_GET['division_type'] == '929' || $_GET['division_type'] == '경영지원부문'){
                    $where_division1 = "AND division1 = 929";
                }            
                else if($_GET['division_type'] == '1204' || $_GET['division_type'] == '지사'){
                    $where_division1 = "AND division1 = 1204";
                }else{
                $where_division1 = "AND division2 = '".$_GET['division_type']."'";
                }
                if($_GET['division2']){
                    $where_division1 = "AND em_seq = '".$_GET['division_type']."'";
                }
            }
            // 한글로 넘어오는 비교조회일 떄 
            if(preg_match("/[\xA1-\xFE][\xA1-\xFE]/", $_GET['division_type']) && $_GET['division1']){
                $where_division1 = "AND getcomkrname(division2) = '".$_GET['division_type']."'";
            }
            if(preg_match("/[\xA1-\xFE][\xA1-\xFE]/", $_GET['division_type']) && $_GET['division2']){
                $where_division1 = "AND getemkrname(em_seq) = '".$_GET['division_type']."'";
            }
        //-- 조회쿼리
            $selectCsListQry = sprintf("SELECT a.division1, a.division2, a.em_seq, a.cs_seq, a.cs_m_id, a.m_nm, sum(a.pay_price) as pay_price, 
                getcomkrname(b.code4) AS code4, getcomkrname(b.code5) AS code5, getcomkrname(b.code6) AS code6
            FROM ( 
                    SELECT 
                        getcomkrname(division1) AS 'division1', 
                        getcomkrname(division2) AS 'division2', 
                        getemkrname(em_seq) AS 'em_seq', 
                        getCsKrname(cs_seq) AS 'cs_seq', 
                        cs_m_id AS 'cs_m_id', 
                        getcomkrname(m_nm) as 'm_nm',
                        sum(pay_price) AS 'pay_price', 
                        good_type2
                    FROM t_contract 
                    WHERE %s
                    AND del_date IS NULL 
                    AND sales_type IN (1,3) 
                    AND agree_state = '3' 
                    %s
                    %s
                    %s
                    %s
                    %s
                    GROUP BY good_type2, t_contract.cs_seq
                    ) AS a 
            INNER JOIN ( 
                    SELECT cm2_seq, kr_name, cm3_seq, code4, code5, code6
                    FROM t_common2 b 
                    WHERE use_yn='Y'
                    %s
                    %s
                    ) AS b ON a.good_type2=b.cm2_seq
                    GROUP BY a.cs_m_id,b.CODE5
                    order by pay_price desc"
                    , $sdate, $where_division1, $where_division2, $where_em_seq, $where_cs_m_id, $where_cs_num, $where_cs_nm, $where_code5);

            $Rst = que($selectCsListQry);

            // echo '<pre>';
            // echo $selectCsListQry;
            // echo'</pre>';
            // var_dump($Rst);

            while ($Row = @mysql_fetch_assoc($Rst)) {
                $S_RETURNVAL['division1'][]                = $Row['division1'];
                $S_RETURNVAL['division2'][]                = $Row['division2'];
                $S_RETURNVAL['em_seq'][]                   = $Row['em_seq'];
                $S_RETURNVAL['cs_seq'][]                   = $Row['cs_seq'];
                $S_RETURNVAL['cs_m_id'][]                  = $Row['cs_m_id'];
                $S_RETURNVAL['pay_price'][]                = $Row['pay_price'];
                $S_RETURNVAL['code4'][]                    = $Row['code4'];
                $S_RETURNVAL['code5'][]                    = $Row['code5'];
                $S_RETURNVAL['code6'][]                    = $Row['code6'];
            }
            return $S_RETURNVAL;
    }
    // 부문 조회
    public function funcSelectContract_division(){
        //날짜 계산
            if ($_GET["dr_dr1_from"] && $_GET["dr_dr1_to"]) {
                $dr_dr1_from = date("Y-m-d", strtotime($_GET["dr_dr1_from"]));
                $dr_dr1_to = date("Y-m-d", strtotime($_GET["dr_dr1_to"]));
                $Date1 = "pay_date BETWEEN '" . $dr_dr1_from . "' AND '" . $dr_dr1_to . "'";
                $sdate = $dr_dr1_from;
                $edate = $dr_dr1_to;
            } else {
                $today = date("Y-m-d"); //오늘
                $firstDay = date("Y-m-d", mktime(0, 0, 0, intval(date('m')), 1, intval(date('Y')) )); //이번달 1일
                $Date1 = "pay_date BETWEEN '" . $firstDay . "' AND '" . $today . "'"; // 이번달 1일부터 오늘까지
                // $timestamp = strtotime("-1 month");
                // $timestamp2 = strtotime("-1 day");
                $sdate = $firstDay;
                $edate = $today;

            }
            if ($_GET["dr_dr2_from"] && $_GET["dr_r2_to"]) {
                $dr_dr2_from = date("Y-m-d", strtotime($_GET["dr_dr2_from"]));
                $dr_r2_to = date("Y-m-d", strtotime($_GET["dr_r2_to"]));
                $Date2 = "BETWEEN " . $dr_dr2_from . " AND '" . $dr_r2_to . "";
            }
            // 검색이 일요일일 경우 -1 day
            $yoil = array("일", "월", "화", "수", "목", "금", "토");
            if ($yoil[date('w', strtotime($sdate))] === '일') {
                $sdate = date('Y-m-d', strtotime($sdate . '-1 days'));
            }
            if ($yoil[date('w', strtotime($edate))] === '일') {
                $edate = date('Y-m-d', strtotime($edate . '-1 days'));
            }
            // 일주일 계산하기 위해 쪼개기
            $sYY = date("Y", strtotime($sdate));
            $sMM = date("m", strtotime($sdate));
            $sDD = date("d", strtotime($sdate));
            $sDay = date("w", strtotime($sdate)) - 1;
            $eYY = date("Y", strtotime($edate));
            $eMM = date("m", strtotime($edate));
            $eDD = date("d", strtotime($edate));
            $eDay = date("w", strtotime($edate)) - 1;
            $sweek_start = date("Y-m-d", strtotime($sYY . "-" . $sMM . "-" . $sDD . " -" . $sDay . " day"));        // 주의 첫날1
            $sweek_end = date("Y-m-d", strtotime($sweek_start . " +6 day"));                                        // 주의 마지막날1
            $eweek_start = date("Y-m-d", strtotime($eYY . "-" . $eMM . "-" . $eDD . " -" . $eDay . " day"));        // 주의 첫날2
            $eweek_end = date("Y-m-d", strtotime($eweek_start . " +6 day"));                                        // 주의 마지막날2
            // 일주일 날짜 계산 => ex) '2021-03-15' ~ '2021-03-21'
            // 날짜 차이
            $diff_date    = strtotime($eweek_end) - strtotime($sweek_start);
            $week_arr = array();
            for ($i = 0; $i < ($diff_date / 86400 + 1) / 7; $i++) {
                $b = 7 * $i;
                $prev_date = date("Y-m-d", strtotime(date($sweek_start) . " +" . $b . " days")) . " ~ " . date("Y-m-d", strtotime(date($sweek_end) . "+" . $b . " days"));
                array_push($week_arr, $prev_date);
            }
        //변수 생성
            if ($_GET["check1"]==1) {
                $code4 = "b.code4";
            }
            if ($_GET["check1"]==2) {
                $code4 = "b.code6";
            }
            if ($_GET["ad_type"]) {
                $ad_type = implode(",", $_GET['ad_type']);
                $where_code = "AND code4 IN (" . $ad_type . ")";
            }
            if ($_GET["m_nm"]) {
                $m_nm = implode(",", $_GET["m_nm"]);
                $where_code    = "AND code6 IN (" . $m_nm . ")";
            }
            if (!$_GET["division1"]) { // 부문
                $division_col = "getcomkrname(a.division1)";
                $first_groupBy_col = "getcomkrname(division1)";
                $div_no = "a.div1";
            }        
            if ($_GET["division1"]) { // 부문
                $division_col = "getcomkrname(a.division2)";
                $where_division1 = "AND division1 = '" . $_GET['division1'] . "'";
                $first_groupBy_col = "getcomkrname(division2)";
                $div_no = "a.div2";
            }
            if ($_GET["division2"]) { // 팀
                $division_col = "getemkrname(a.em_seq)";
                $where_division2 = "AND division2 = '" . $_GET['division2'] . "'";
                $first_groupBy_col = "getemkrname(em_seq)";
                $div_no = "a.div3";
            }
            if ($_GET["em_nm"]) { // 사원번호
                $where_em_seq = "AND em_seq = '" . $_GET['em_nm'] . "'";
            }
            if ($_GET["s_item"]) {
                if ($_GET["s_item"] == "cs_m_id") {
                    $where_cs_m_id = "AND cs_m_id = '" . $_GET['s_string'] . "'";
                }
                if ($_GET["s_item"] == "cs_nm") {
                    $where_cs_nm = "AND getCsKrName(cs_seq) = '" . $_GET['s_string'] . "'";
                }
                if ($_GET["s_item"] == "cs_num") {
                    $where_cs_num = " AND cs_seq = (SELECT cs_seq from t_customer WHERE cs_num = '" . $_GET['s_string'] . "')";
                }
            }
            switch ($_GET['cal_kind']) {
                case "d":
                    $sreg_date = "pay_date as pay_date";
                    $sgroup_by = "GROUP BY pay_date ";
                    break;
                case "wk":
                    $sreg_date = "pay_date as pay_date";
                    $sgroup_by = "GROUP BY pay_date ";
                    break;
                case "m":
                    $sreg_date = "left(pay_date,7) as pay_date";
                    $sgroup_by = "GROUP BY left(pay_date,7)";
                    break;
                case "y":
                    $sreg_date = "LEFT(pay_date,4) as pay_date";
                    $sgroup_by = "GROUP BY LEFT(pay_date,4)";
                    break;
                case "w":
                    $sreg_date = "WEEKDAY(pay_date) as pay_date";
                    $sgroup_by = "GROUP BY WEEKDAY(pay_date)";
                    break;
                case "wd":
                    $sreg_date = "WEEKDAY(pay_date) as pay_date";
                    $sgroup_by = "GROUP BY WEEKDAY(pay_date)";
                    $where_week = "AND WEEKDAY(pay_date) = '" . $_GET['week'] . "'";
                    break;
            }

        //쿼리 조회
        if ($_GET['cal_kind'] != "wk") { // 주별이 아닐 때 (일별일 떄) 
            if (!$_GET["dr_dr2_from"]) {
                        $querySelectDivisionOneDate = "SELECT t_report.* FROM (
                        SELECT code5 as good_type2 , a.m_nm, SUM(a.pay_price) AS pay_price, $first_groupBy_col as division1, $first_groupBy_col as division1_no,
                                b.cm3_seq as m_nm1, code4 as code4, code5 as code5, $code4 as type_code, good_type2 as good_type2_1, $div_no as div1
                    FROM ( 
                            SELECT good_type2, SUM(pay_price) as pay_price, m_nm,  division2, division1, 
                                    em_seq as em_seq, division1 AS DIV1, division2 AS DIV2, em_seq as DIV3
                            FROM t_contract 
                            WHERE $Date1
                            $where_division1
                            $where_division2
                            $where_em_seq
                            $where_cs_m_id
                            $where_cs_nm
                            AND del_date IS NULL 
                            AND sales_type IN (1,3) 
                            AND agree_state = '3' 
                            $where_cs_num
                            GROUP BY em_seq, good_type2
                            ) AS a 
                    INNER JOIN ( 
                            SELECT cm2_seq, cm3_seq, code4, code5, code6 
                            FROM t_common2
                            WHERE cm3_seq > 0
                            AND use_yn='Y' 
                            $where_code
                            ) AS b 
                            ON a.good_type2=b.cm2_seq
                            GROUP BY $first_groupBy_col, type_code, b.code5
                            ) AS t_report
                                INNER JOIN t_common2 AS t_comm
                                ON t_report.code5 = t_comm.cm2_seq
                                ORDER BY FIELD(t_report.div1, '926','927','928', '809', '6', '1204','929'), t_comm.sort";

                        $Rst = que($querySelectDivisionOneDate);
                        // echo '<pre>';
                        // echo $querySelectDivisionOneDate;
                        // echo '</pre>';
                        // var_dump($Rst);
                        $nListCnt = 0;
                        while ($Row = @mysql_fetch_assoc($Rst)) {
                            $S_RETURNVAL['good_type22'][$Row['type_code']][$Row['code5']]                            = $Row['good_type2_1'];
                            $S_RETURNVAL['m_nm2'][$Row['type_code']]                                                      = $Row['type_code'];
                            $S_RETURNVAL['good_type2_price2'][$Row['division1']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                            $S_RETURNVAL['division1'][$Row['division1']]                                               = $Row['div1'];
                            // $S_RETURNVAL['division2'][$Row['division1']]                                               = $Row['division1_no'];
                            // $S_RETURNVAL['division3'][$Row['division1']]                                               = $Row['div3'];
                            $S_RETURNVAL['division12']                                                                = $Row['division1'];
                            $nListCnt++;
                        }
                        $S_RETURNVAL['nListCnt'] = $nListCnt;
                        return $S_RETURNVAL;
                        que_close();

            }else{ //--------------------------------부문 일별 비교조회----------------------------------
                    
                    $querySelectDivisionTwoDate_date = "SELECT t_report.* FROM (
                    SELECT CONCAT('" . $dr_dr1_from . "',' ~ ','" . $dr_dr1_to . "') as pay_date, SUM(a.pay_price) as pay_price, 
                                                    code5 as good_type2, b.cm3_seq as m_nm1, b.code4 as code4, b.code5 as code5,
                                                    a.division1_kr as division1_kr, $division_col as division1, $code4 as type_code, good_type2 as good_type2_1, a.div1 as div1 
                    FROM ( 
                            SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, 
                                        getcomkrname(division1) as division1_kr, 
                                        division1, 
                                        division2, 
                                        em_seq, division1 AS DIV1
                                        FROM t_contract 
                            WHERE 1=1 
                            AND agree_state = '3' 
                            AND pay_date BETWEEN '" . $dr_dr1_from . "' AND '" . $dr_dr1_to . "' 
                            " . $where_division1 . "
                            " . $where_division2 . "
                            " . $where_em_seq . "
                            " . $where_cs_m_id . "
                            " . $where_cs_nm . "                        
                            AND del_date IS NULL 
                            AND sales_type IN (1,3) 
                            " . $where_cs_num . "
                            GROUP BY em_seq, pay_date , good_type2, division1
                            ) AS a 
                    INNER JOIN ( 
                            SELECT cm2_seq, cm3_seq, code4, code5, code6 
                            FROM t_common2 
                            WHERE use_yn='Y' 
                            AND cm3_seq > 0 
                            $where_code
                            ) AS b ON a.good_type2=b.cm2_seq 	                        
                    group BY $first_groupBy_col, type_code, b.code5
                    ) AS t_report
                            INNER JOIN t_common2 AS t_comm
                            ON t_report.code5 = t_comm.cm2_seq
                            ORDER BY FIELD(t_report.div1, '926','927','928', '809', '6', '1204','929'), t_comm.sort";

                    $Result = que($querySelectDivisionTwoDate_date);
                    // echo '<pre>';
                    // echo $querySelectDivisionTwoDate_date;
                    // echo '</pre>';
                    // var_dump($Result);
                    $nListCnt = 0;
                    while ($Row = @mysql_fetch_assoc($Result)) {
                        $S_RETURNVAL['good_type22'][$Row['type_code']][$Row['good_type2']]                            = $Row['good_type2_1'];
                        $S_RETURNVAL['m_nm2'][$Row['type_code']]                                                      = $Row['type_code'];
                        $S_RETURNVAL['good_type2_price2'][$Row['pay_date']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                        $S_RETURNVAL['pay_date'][$Row['pay_date']]                                               = $Row['pay_date'];
                        $S_RETURNVAL['price_compare'][$Row['division1']][$Row['pay_date']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                        $S_RETURNVAL['total_price1']                                                      += $Row['pay_price'];
                        
                        $S_RETURNVAL['division1_kr_list'][$Row['division1']]                   = $Row['division1'];
                        $nListCnt++;
                    }
                    $querySelectDivisionTwoDate_date2 = "SELECT t_report.* FROM (
                        SELECT CONCAT('" . $dr_dr2_from . "',' ~ ','" . $dr_r2_to . "') as pay_date, SUM(a.pay_price) as pay_price, 
                                                    code5 as good_type2, b.cm3_seq as m_nm1, b.code4 as code4, b.code5 as code5,
                                                    a.division1_kr as division1_kr, $division_col as division1, $code4 as type_code, good_type2 as good_type2_1, a.div1 as div1 
                    FROM ( 
                            SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, 
                                        getcomkrname(division1) as division1_kr, 
                                        division1, 
                                        division2, 
                                        em_seq, division1 AS DIV1
                                        FROM t_contract 
                            WHERE 1=1 
                            AND agree_state = '3' 
                            AND pay_date BETWEEN '" . $dr_dr2_from . "' AND '" . $dr_r2_to . "' 
                            " . $where_division1 . "
                            " . $where_division2 . "
                            " . $where_em_seq . "
                            " . $where_week . "
                            " . $where_cs_m_id . "
                            " . $where_cs_nm . "                        
                            AND del_date IS NULL 
                            AND sales_type IN (1,3) 
                            " . $where_cs_num . "
                            GROUP BY em_seq, pay_date , good_type2 , division1
                            ) AS a 
                    INNER JOIN ( 
                            SELECT cm2_seq, cm3_seq, code4, code5, code6
                            FROM t_common2 
                            WHERE use_yn='Y' 
                            AND cm3_seq > 0 
                            $where_code
                            ) AS b ON a.good_type2=b.cm2_seq 
                    group BY $first_groupBy_col, type_code, b.code5
                    ) AS t_report
                    INNER JOIN t_common2 AS t_comm
                    ON t_report.code5 = t_comm.cm2_seq
                    ORDER BY FIELD(t_report.div1, '926','927','928', '809', '6', '1204','929'), t_comm.sort";
                    $Result = que($querySelectDivisionTwoDate_date2);
                    // echo '<pre>';
                    // echo $querySelectDivisionTwoDate_date2;
                    // echo '</pre>';
                    // var_dump($Result);
                $nListCnt = 0;
                while ($Row = @mysql_fetch_assoc($Result)) {
                    $S_RETURNVAL['good_type22'][$Row['type_code']][$Row['good_type2']]                            = $Row['good_type2_1'];
                    $S_RETURNVAL['m_nm2'][$Row['type_code']]                                                      = $Row['type_code'];
                    $S_RETURNVAL['good_type2_price2'][$Row['pay_date']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                    $S_RETURNVAL['pay_date'][$Row['pay_date']]                                               = $Row['pay_date'];
                    $S_RETURNVAL['price_compare'][$Row['division1']][$Row['pay_date']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                    $S_RETURNVAL['division1_kr_list'][$Row['division1']]                     = $Row['division1'];
                    $S_RETURNVAL['total_price2']                                                      += $Row['pay_price'];
                    
                    $nListCnt++;
                }                
                $S_RETURNVAL['nListCnt'] = $nListCnt;
                return $S_RETURNVAL;
                que_close();
            }
        } else { // -------------------------------------주별 조회-----------------------------------------------------
            if ($_GET["dr_dr1_from"] && $_GET["dr_r2_to"]) { // 주별인데 비교조회 
                            $querySelectDivisionTwoDate_date = "SELECT t_report.* FROM (
                                SELECT CONCAT('" . $dr_dr1_from . "',' ~ ','" . $dr_dr1_to . "') as pay_date, SUM(a.pay_price) as pay_price, 
                                                                code5 as good_type2, b.cm3_seq as m_nm1, b.code4 as code4, b.code5 as code5,
                                                                a.division1_kr as division1_kr, $division_col as division1, $code4 as type_code, good_type2 as good_type2_1, $div_no as div1
                                FROM ( 
                                        SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, 
                                                        division1 as division1_kr, 
                                                        division1,
                                                        division2,
                                                    em_seq, division1 AS DIV1, division2 AS DIV2, em_seq as DIV3
                                                    FROM t_contract 
                                        WHERE 1=1 
                                        AND agree_state = '3' 
                                        AND pay_date BETWEEN '" . $dr_dr1_from . "' AND '" . $dr_dr1_to . "' 
                                        " . $where_division1 . "
                                        " . $where_division2 . "
                                        " . $where_em_seq . "
                                        " . $where_cs_m_id . "
                                        " . $where_cs_nm . "                        
                                        AND del_date IS NULL 
                                        AND sales_type IN (1,3) 
                                        " . $where_cs_num . "
                                        GROUP BY pay_date , good_type2, division1
                                        ) AS a 
                                INNER JOIN ( 
                                        SELECT cm2_seq, cm3_seq, code4, code5, code6 
                                        FROM t_common2 
                                        WHERE use_yn='Y' 
                                        AND cm3_seq > 0 
                                        $where_code
                                        ) AS b ON a.good_type2=b.cm2_seq 	                        
                                group BY $first_groupBy_col, type_code, b.code5
                                ) AS t_report
                                        INNER JOIN t_common2 AS t_comm
                                        ON t_report.code5 = t_comm.cm2_seq
                                        ORDER BY FIELD(t_report.div1, '926','927','928', '809', '6', '1204','929'), t_comm.sort";
            
                                $Result = que($querySelectDivisionTwoDate_date);
                                // echo '<pre>';
                                // echo $querySelectDivisionTwoDate_date;
                                // echo '</pre>';
                                // var_dump($Result);
                                $nListCnt = 0;
                                while ($Row = @mysql_fetch_assoc($Result)) {
                                    $S_RETURNVAL['good_type22'][$Row['type_code']][$Row['good_type2']]                            = $Row['good_type2_1'];
                                    $S_RETURNVAL['m_nm2'][$Row['type_code']]                                                      = $Row['type_code'];
                                    $S_RETURNVAL['good_type2_price2'][$Row['pay_date']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                                    $S_RETURNVAL['pay_date'][$Row['pay_date']]                                               = $Row['pay_date'];
                                    $S_RETURNVAL['price_compare'][$Row['division1']][$Row['pay_date']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                                    $S_RETURNVAL['total_price1']                                                      += $Row['pay_price'];
                                    
                                    $S_RETURNVAL['division1_kr_list'][$Row['division1']]                   = $Row['division1'];
                                    $nListCnt++;
                                }
                                $querySelectDivisionTwoDate_date2 = "SELECT t_report.* FROM (
                                    SELECT CONCAT('" . $dr_dr2_from . "',' ~ ','" . $dr_r2_to . "') as pay_date, SUM(a.pay_price) as pay_price, 
                                                                code5 as good_type2, b.cm3_seq as m_nm1, b.code4 as code4, b.code5 as code5,
                                                                a.division1_kr as division1_kr, $division_col as division1, $code4 as type_code, good_type2 as good_type2_1, $div_no as div1
                                FROM ( 
                                        SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, 
                                                    division1 as division1_kr, 
                                                    division1,
                                                    division2,
                                                    em_seq, division1 AS DIV1, division2 AS DIV2, em_seq as DIV3
                                                    FROM t_contract 
                                        WHERE 1=1 
                                        AND agree_state = '3' 
                                        AND pay_date BETWEEN '" . $dr_dr2_from . "' AND '" . $dr_r2_to . "' 
                                        " . $where_division1 . "
                                        " . $where_division2 . "
                                        " . $where_em_seq . "
                                        " . $where_week . "
                                        " . $where_cs_m_id . "
                                        " . $where_cs_nm . "                        
                                        AND del_date IS NULL 
                                        AND sales_type IN (1,3) 
                                        " . $where_cs_num . "
                                        GROUP BY pay_date , good_type2 , division1
                                        ) AS a 
                                INNER JOIN ( 
                                        SELECT cm2_seq, cm3_seq, code4, code5, code6
                                        FROM t_common2 
                                        WHERE use_yn='Y' 
                                        AND cm3_seq > 0 
                                        $where_code
                                        ) AS b ON a.good_type2=b.cm2_seq 
                                group BY $first_groupBy_col, type_code, b.code5
                                ) AS t_report
                                INNER JOIN t_common2 AS t_comm
                                ON t_report.code5 = t_comm.cm2_seq
                                ORDER BY FIELD(t_report.div1, '926','927','928', '809', '6', '1204','929'), t_comm.sort";
                                $Result = que($querySelectDivisionTwoDate_date2);
                                // echo '<pre>';
                                // echo $querySelectDivisionTwoDate_date2;
                                // echo '</pre>';
                                // var_dump($Result);
                            $nListCnt = 0;
                            while ($Row = @mysql_fetch_assoc($Result)) {
                                $S_RETURNVAL['good_type22'][$Row['type_code']][$Row['good_type2']]                            = $Row['good_type2_1'];
                                $S_RETURNVAL['m_nm2'][$Row['type_code']]                                                      = $Row['type_code'];
                                $S_RETURNVAL['good_type2_price2'][$Row['pay_date']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                                $S_RETURNVAL['pay_date'][$Row['pay_date']]                                               = $Row['pay_date'];
                                $S_RETURNVAL['price_compare'][$Row['division1']][$Row['pay_date']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                                $S_RETURNVAL['division1_kr_list'][$Row['division1']]                     = $Row['division1'];
                                $S_RETURNVAL['total_price2']                                                      += $Row['pay_price'];
                                
                                $nListCnt++;
                            }                
                            $S_RETURNVAL['nListCnt'] = $nListCnt;
                            return $S_RETURNVAL;
                            que_close();
            }else{                                           // 주별인데 단일조회
                $querySelectDivisionWeekly = "SELECT t_report.* FROM (
                    SELECT CONCAT(start,' ~ ',end) as pay_date, SUM(a.pay_price) as pay_price, 
                    code5 as good_type2,a.m_nm, $division_col as division1 ,a.division2, a.em_seq, b.cm3_seq as m_nm1, b.code4 as code4, b.code5 as code5, $code4 as type_code, good_type2 as good_type2_1, a.div1 as div1 
                FROM (
                        SELECT $sreg_date , good_type2, SUM(pay_price) as pay_price,  m_nm, division1, division2, em_seq,
                        if(DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date)) DAY), '%Y-%m-%d') < '$sdate', '$sdate',DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date)) DAY), '%Y-%m-%d')) as start,
                                    if(DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date) - 6) DAY), '%Y-%m-%d') > '$edate', '$edate',DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date) - 6) DAY), '%Y-%m-%d')) as end, 
                                division1 AS DIV1
                        FROM t_contract		
                        WHERE 1=1
                        AND pay_date >= '$sdate'
                        AND pay_date <= '$edate'
                        " . $where_division1 . "
                        " . $where_division2 . "
                        " . $where_em_seq . "
                        " . $where_week . "
                        " . $where_cs_m_id . "
                        " . $where_cs_nm . "   
                        AND del_date IS NULL
                        AND sales_type IN (1,3)
                        AND agree_state = '3'
                        " . $where_cs_num . "
                        $sgroup_by , division1, division2, em_seq, good_type2				
                    ) AS a INNER JOIN (
                        SELECT cm2_seq, cm3_seq, code4, code5, code6 
                        FROM t_common2 
                        WHERE cm3_seq > 0 
                        AND use_yn='Y' 
                        $where_code
                    ) AS b 
                    ON a.good_type2=b.cm2_seq
                    group by pay_date, $first_groupBy_col, type_code, b.code5
                    ) AS t_report
                                INNER JOIN t_common2 AS t_comm
                                ON t_report.code5 = t_comm.cm2_seq
                                ORDER BY t_report.pay_date, FIELD(t_report.div1, '926','927','928', '809', '6', '1204','929'), t_comm.sort";

                    $Rst = que($querySelectDivisionWeekly);
                        //  echo '<pre>';
                        //  echo $querySelectDivisionWeekly;
                        //  echo '</pre>';
                        //  var_dump($Rst);                
                    $nListCnt = 0;
                    while ($Row = @mysql_fetch_assoc($Rst)) {
                        $S_RETURNVAL['good_type22'][$Row['type_code']][$Row['code5']]                                   = $Row['good_type2_1'];
                        $S_RETURNVAL['m_nm2'][$Row['type_code']]                                                        = $Row['type_code'];
                        $S_RETURNVAL['good_type2_price2'][$Row['division1']][$Row['type_code']][$Row['good_type2']]      += $Row['pay_price'];
                        $S_RETURNVAL['pay_date'][$Row['pay_date']]                                                      = $Row['pay_date'];
                        $S_RETURNVAL['division1'][$Row['division1']]                                                    = $Row['division1'];
                        $S_RETURNVAL['division12']                                                                      = $Row['division1'];
                        $S_RETURNVAL['division1_kr_list'][$Row['division1']]                   = $Row['division1'];
                        $S_RETURNVAL['price_compare'][$Row['division1']][$Row['pay_date']][$Row['type_code']][$Row['good_type2']]    += $Row['pay_price'];
                    }
                    return $S_RETURNVAL;
                    que_close();
            }
        }
    }
    // 광고주 조회
    public function funcSelectContract_customer(){
        
        //날짜 계산
            if ($_GET["dr_dr1_from"] && $_GET["dr_dr1_to"]) {
                $dr_dr1_from = date("Y-m-d", strtotime($_GET["dr_dr1_from"]));
                $dr_dr1_to = date("Y-m-d", strtotime($_GET["dr_dr1_to"]));
                $Date1 = "pay_date BETWEEN '" . $dr_dr1_from . "' AND '" . $dr_dr1_to . "'";
                $sdate = $dr_dr1_from;
                $edate = $dr_dr1_to;
            } else {
                $today = date("Y-m-d");
                $firstDay = date("Y-m-d", mktime(0, 0, 0, intval(date('m')), 1, intval(date('Y')) )); //이번달 1일 구하기
                $Date1 = "pay_date BETWEEN '" . $firstDay . "' AND '" . $today . "'";
                $timestamp = strtotime("-1 month");
                $timestamp2 = strtotime("-1 day");
                $sdate = date("Y-m-d H:i:s", $timestamp);
                $edate = date("Y-m-d H:i:s", $timestamp2);
                if($_GET["cal_kind"]=="m"){
                    $month = date("Y-m");
                    $Date1 = "pay_date BETWEEN  '".$month."-01' AND '".$month."-31'";
                }
                if($_GET["cal_kind"]=="y"){
                    $year = date("Y");
                    $Date1 = "pay_date BETWEEN  '".$year."-01-01' AND '".$year."-12-31'";
                }
            }
            if ($_GET["dr_dr2_from"] && $_GET["dr_r2_to"]) {
                $dr_dr2_from = date("Y-m-d", strtotime($_GET["dr_dr2_from"]));
                $dr_r2_to = date("Y-m-d", strtotime($_GET["dr_r2_to"]));
                $Date2 = "BETWEEN " . $dr_dr2_from . " AND '" . $dr_r2_to . "";
            }
            $yoil = array("일", "월", "화", "수", "목", "금", "토");
            if ($yoil[date('w', strtotime($sdate))] === '일') {
                $sdate = date('Y-m-d', strtotime($sdate . '-1 days'));
            }
            if ($yoil[date('w', strtotime($edate))] === '일') {
                $edate = date('Y-m-d', strtotime($edate . '-1 days'));
            }
            $sYY = date("Y", strtotime($sdate));
            $sMM = date("m", strtotime($sdate));
            $sDD = date("d", strtotime($sdate));
            $sDay = date("w", strtotime($sdate)) - 1;
            $eYY = date("Y", strtotime($edate));
            $eMM = date("m", strtotime($edate));
            $eDD = date("d", strtotime($edate));
            $eDay = date("w", strtotime($edate)) - 1;
            $sweek_start = date("Y-m-d", strtotime($sYY . "-" . $sMM . "-" . $sDD . " -" . $sDay . " day"));    // 주의 첫날1
            $sweek_end = date("Y-m-d", strtotime($sweek_start . " +6 day"));                        // 주의 마지막날1
            $eweek_start = date("Y-m-d", strtotime($eYY . "-" . $eMM . "-" . $eDD . " -" . $eDay . " day"));    // 주의 첫날2
            $eweek_end = date("Y-m-d", strtotime($eweek_start . " +6 day"));                        // 주의 마지막날2
            $diff_date    = strtotime($eweek_end) - strtotime($sweek_start);
            $week_arr = array();
            for ($i = 0; $i < ($diff_date / 86400 + 1) / 7; $i++) {
                $b = 7 * $i;
                $prev_date = date("Y-m-d", strtotime(date($sweek_start) . " +" . $b . " days")) . " ~ " . date("Y-m-d", strtotime(date($sweek_end) . "+" . $b . " days"));
                array_push($week_arr, $prev_date);
            }

        //변수 설정
            if ($_GET["check1"]==1) {
                $code4 = "b.code4";
            }
            if ($_GET["check1"]==2) {
                $code4 = "b.code6";
            }
            if ($_GET["ad_type"]) {
                $ad_type = implode(",", $_GET['ad_type']);
                $where_code = "AND code4 IN (" . $ad_type . ")";
            }
            if ($_GET["m_nm"]) {
                $m_nm = implode(",", $_GET["m_nm"]);
                $where_code    = "AND code6 IN (" . $m_nm . ")";
            }
            if ($_GET["division1"]) { // 부문
                $where_division1 = "AND division1 = '" . $_GET['division1'] . "'";
            }
            if ($_GET["division2"]) { // 팀
                $where_division2 = "AND division2 = '" . $_GET['division2'] . "'";
            }
            if ($_GET["em_nm"]) { // 사원번호
                $where_em_seq = "AND em_seq = '" . $_GET['em_nm'] . "'";
            }
            if ($_GET["s_item"]) {
                if ($_GET["s_item"] == "cs_m_id") {
                    $where_cs_m_id = "AND cs_m_id = '" . $_GET['s_string'] . "'";
                }
                if ($_GET["s_item"] == "cs_nm") {
                    $where_cs_nm = "AND getCsKrName(cs_seq) = '" . $_GET['s_string'] . "'";
                }
                if ($_GET["s_item"] == "cs_num") {
                    $where_cs_num = " AND cs_seq = (SELECT cs_seq from t_customer WHERE cs_num = '" . $_GET['s_string'] . "')";
                }
            }
            switch ($_GET['cal_kind']) {
                case "d":
                    $sreg_date = "pay_date as pay_date";
                    $sgroup_by = "GROUP BY pay_date ";
                    break;
                case "wk":
                    $sreg_date = "pay_date as pay_date";
                    $sgroup_by = "GROUP BY pay_date ";
                    break;
                case "m":
                    $sreg_date = "left(pay_date,7) as pay_date";
                    $sgroup_by = "GROUP BY left(pay_date,7)";
                    break;
                case "y":
                    $sreg_date = "LEFT(pay_date,4) as pay_date";
                    $sgroup_by = "GROUP BY LEFT(pay_date,4)";
                    break;
                case "w":
                    $sreg_date = "WEEKDAY(pay_date) as pay_date";
                    $sgroup_by = "GROUP BY WEEKDAY(pay_date)";
                    break;
                case "wd":
                    $sreg_date = "WEEKDAY(pay_date) as pay_date";
                    $sgroup_by = "GROUP BY WEEKDAY(pay_date)";
                    $where_week = "AND WEEKDAY(pay_date) = '" . $_GET['week'] . "'";
                    break;
            }

        //-----------------------일별일때 -----------------
        if ($_GET['cal_kind'] != "wk") {
            if (!$_GET["dr_dr2_from"]) {
                $querySelectCustomerOneDate = "SELECT t_report.* FROM (
                    SELECT a.*, b.cm3_seq as m_nm1, code4 as code4, code5 as code5, $code4 as type_code, good_type2 as good_type2_1
                    FROM ( 
                    SELECT getCsKrname(cs_seq) AS cs_seq, good_type2,  m_nm,  getcomkrname(division1) as division1, SUM(pay_price) AS pay_price
                    FROM t_contract 
                    WHERE $Date1
                    " . $where_division1 . "
                    " . $where_division2 . "
                    " . $where_em_seq . "
                    " . $where_cs_m_id . "
                    " . $where_cs_nm . "                        
                    AND del_date IS NULL 
                    AND sales_type IN (1,3) 
                    AND agree_state = '3' 
                    " . $where_cs_num . "
                    GROUP BY cs_seq
                    ) AS a 
                    INNER JOIN ( 
                        SELECT cm2_seq, cm3_seq, code4, code5, code6
                        FROM t_common2
                        WHERE cm3_seq > 0
                        AND use_yn='Y' 
                        $where_code
                            ) AS b 
                            ON a.good_type2=b.cm2_seq
                GROUP BY cs_seq, type_code, b.code5
                ) AS t_report
                INNER JOIN t_common2 AS t_comm
                ON t_report.code5 = t_comm.cm2_seq
                ORDER BY t_report.cs_seq, t_comm.sort asc";
                $Rst = que($querySelectCustomerOneDate);
                // echo '<pre>';
                // echo $querySelectCustomerOneDate;
                // echo '</pre>';
                // var_dump($Rst);
                $nListCnt = 0;
                while ($Row = @mysql_fetch_assoc($Rst)) {
                    $S_RETURNVAL['cs_seq1']                                                                  = $Row['cs_seq'];
                    $S_RETURNVAL['good_type23'][$Row['type_code']][$Row['code5']]                            = $Row['good_type2_1'];
                    $S_RETURNVAL['m_nm3'][$Row['type_code']]                                                      = $Row['type_code'];
                    $S_RETURNVAL['good_type2_price3'][$Row['cs_seq']][$Row['type_code']][$Row['code5']]    += $Row['pay_price'];
                    $S_RETURNVAL['cs_seq'][$Row['cs_seq']]                                                  = $Row['cs_seq'];
                    $nListCnt++;
                }
                $S_RETURNVAL['nListCnt'] = $nListCnt;  
                return $S_RETURNVAL;
                que_close();

            } else {
                //----------------------- 광고주 비교일자 -----------------------------------
                $querySelectCustomerTwoDate_date = "SELECT t_report.* FROM (
                    SELECT CONCAT('" . $dr_dr1_from . "',' ~ ','" . $dr_dr1_to . "') as pay_date, SUM(a.pay_price) as pay_price, a.good_type2, b.cm3_seq as m_nm1, a.cs_seq, b.code4 as code4 , b.code5 as code5
                     FROM ( 
                        SELECT pay_date as pay_date, getCsKrname(cs_seq) AS cs_seq , good_type2, SUM(pay_price) as pay_price, m_nm
                        FROM t_contract 
                        WHERE 1=1 
                        AND agree_state = '3' 
                        AND pay_date BETWEEN '" . $dr_dr1_from . "' AND '" . $dr_dr1_to . "' 
                        " . $where_division1 . "
                        " . $where_division2 . "
                        " . $where_em_seq . "
                        " . $where_week . "
                        " . $where_cs_m_id . "
                        " . $where_cs_nm . "                        
                        AND del_date IS NULL 
                        AND sales_type IN (1,3) 
                        " . $where_cs_num . "
                        GROUP BY t_contract.cs_seq
                ) AS a 
                INNER JOIN ( 
                SELECT cm2_seq, cm3_seq, code4, code5 
                FROM t_common2 
                WHERE cm3_seq > 0
                AND use_yn='Y' 
                $where_code
                ) AS b ON a.good_type2=b.cm2_seq 	                        
                group BY cs_seq, b.code5
                ) AS t_report
                INNER JOIN t_common2 AS t_comm
                ON t_report.code5 = t_comm.cm2_seq
                ORDER BY t_report.cs_seq, t_report.pay_date, t_comm.sort asc";
    
                $Result = que($querySelectCustomerTwoDate_date);
                // echo '<pre>';
                // echo $querySelectCustomerTwoDate_date.'<br>';
                // echo '</pre>';
                // var_dump($Result);
                $nListCnt = 0;
                while ($Row = @mysql_fetch_assoc($Result)) {
                    //$S_RETURNVAL['good_type2_price3'][$Row['pay_date']][$Row['code4']][$Row['good_type2']]    += $Row['pay_price'];
                    $S_RETURNVAL['good_type23'][$Row['code4']][$Row['code5']]                              = $Row['code5'];
                    $S_RETURNVAL['code5'][$Row['code5']]                                                                   = $Row['code5'];
                    $S_RETURNVAL['m_nm3'][$Row['code4']]                                                        = $Row['code4'];
                    $S_RETURNVAL['good_type2_price3'][$Row['pay_date']][$Row['code4']][$Row['code5']]      += $Row['pay_price'];
                    $S_RETURNVAL['pay_date'][$Row['pay_date']]                                                  = $Row['pay_date'];
                    $S_RETURNVAL['price_compare3'][$Row['cs_seq']][$Row['pay_date']][$Row['code4']][$Row['code5']]    += $Row['pay_price'];
                    
                    $S_RETURNVAL['cs_seq1']                                                                     = $Row['cs_seq'];
                    $S_RETURNVAL['cs_seq'][$Row['cs_seq']]                                                      = $Row['cs_seq'];
                    $nListCnt++;
                }
                $querySelectCustomerTwoDate_date2 = "SELECT t_report.* FROM (
                    SELECT CONCAT('" . $dr_dr2_from . "',' ~ ','" . $dr_r2_to . "') as pay_date, SUM(a.pay_price) as pay_price, a.good_type2, b.cm3_seq as m_nm1, a.cs_seq, b.code4 as code4 , b.code5 as code5
                                            FROM ( 
                                                SELECT pay_date as pay_date, getCsKrname(cs_seq) AS cs_seq , good_type2, SUM(pay_price) as pay_price, m_nm
                                                FROM t_contract 
                                                WHERE 1=1 
                                                AND agree_state = '3' 
                                                AND pay_date BETWEEN '" . $dr_dr2_from . "' AND '" . $dr_r2_to . "' 
                                                " . $where_division1 . "
                                                " . $where_division2 . "
                                                " . $where_em_seq . "
                                                " . $where_week . "
                                                " . $where_cs_m_id . "
                                                " . $where_cs_nm . "                        
                                                AND del_date IS NULL 
                                                AND sales_type IN (1,3) 
                                                " . $where_cs_num . "
                                                GROUP BY t_contract.cs_seq
                                            ) AS a 
                                            INNER JOIN ( 
                                                SELECT cm2_seq, cm3_seq, code4, code5 
                                                FROM t_common2 
                                                WHERE cm3_seq > 0
                                                AND use_yn='Y' 
                                                $where_code
                                            ) AS b ON a.good_type2=b.cm2_seq 	                        
                                            group BY cs_seq, b.code5
                                            ) AS t_report
                                            INNER JOIN t_common2 AS t_comm
                                            ON t_report.code5 = t_comm.cm2_seq
                                            ORDER BY t_report.cs_seq, t_report.pay_date, t_comm.sort asc";
                $Result = que($querySelectCustomerTwoDate_date2);
                // echo '<pre>';
                // echo $querySelectCustomerTwoDate_date2.'<br>';
                // echo '</pre>';
                // var_dump($Result);
                $nListCnt = 0;
                while ($Row = @mysql_fetch_assoc($Result)) {
                    $S_RETURNVAL['code5'][$Row['code5']]                                                                   = $Row['code5'];
                    $S_RETURNVAL['cs_seq1']                                                                                 = $Row['cs_seq'];
                    $S_RETURNVAL['good_type23'][$Row['code4']][$Row['code5']]                                          = $Row['code5'];
                    $S_RETURNVAL['good_type2_price3'][$Row['pay_date']][$Row['code4']][$Row['code5']]                  += $Row['pay_price'];
                    $S_RETURNVAL['m_nm3'][$Row['code4']]                                                                    = $Row['code4'];
                    $S_RETURNVAL['price_compare3'][$Row['cs_seq']][$Row['pay_date']][$Row['code4']][$Row['code5']]     += $Row['pay_price'];
                    
                    $S_RETURNVAL['cs_seq'][$Row['cs_seq']]                                                      = $Row['cs_seq'];
                    $S_RETURNVAL['nListCnt'] = $nListCnt;
                    $nListCnt++;
                }                
                return $S_RETURNVAL;
                que_close();

            }
        }else{ // --------------주별일때-------------------
                $querySelectCustomerWeekly = "SELECT t_report.* FROM (
                   SELECT CONCAT(start,' ~ ',end) as pay_date, SUM(a.pay_price) as pay_price, a.good_type2,
                    b.cm3_seq as m_nm1, getCsKrName(a.cs_seq) AS cs_seq, b.code5 as code5, $code4 as type_code
                FROM ( 
                        SELECT $sreg_date , cs_seq, SUM(pay_price) AS pay_price, good_type2,
                        DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date)) DAY), '%Y-%m-%d') as start, 
                        DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date) - 6) DAY), '%Y-%m-%d') as end 
                        FROM t_contract 
                        WHERE 1=1 
                        AND pay_date >= '$sweek_start'
                        AND pay_date <= '$eweek_end'
                        " . $where_division1 . "
                        " . $where_division2 . "
                        " . $where_em_seq . "
                        " . $where_cs_m_id . "
                        " . $where_cs_nm . "                        
                        AND del_date IS NULL 
                        AND sales_type IN (1,3) 
                        AND agree_state = '3' 
                        " . $where_cs_num . "
                        GROUP BY cs_seq
                        ) AS a 
                        INNER JOIN ( 
                            SELECT cm2_seq, cm3_seq, code4, code5, code6
                            FROM t_common2
                            WHERE cm3_seq > 0
                            AND use_yn='Y' 
                            $where_code
                                ) AS b 
                                ON a.good_type2=b.cm2_seq
                    GROUP BY cs_seq, type_code, b.code5
                    ) AS t_report
                    INNER JOIN t_common2 AS t_comm
                    ON t_report.code5 = t_comm.cm2_seq
                    ORDER BY t_report.cs_seq, t_comm.sort asc";
                $Rst = que($querySelectCustomerWeekly);

                // echo '<pre>';
                // echo $querySelectCustomerWeekly;
                // echo '</pre>';
                // var_dump($Rst);
                $nListCnt = 0;
                while ($Row = @mysql_fetch_assoc($Rst)) {
                    $S_RETURNVAL['cs_seq1']                                                                  = $Row['cs_seq'];
                    $S_RETURNVAL['good_type23'][$Row['type_code']][$Row['code5']]                            = $Row['code5'];
                    $S_RETURNVAL['m_nm3'][$Row['type_code']]                                                      = $Row['type_code'];
                    $S_RETURNVAL['good_type2_price3'][$Row['cs_seq']][$Row['type_code']][$Row['code5']]    += $Row['pay_price'];
                    $S_RETURNVAL['cs_seq'][$Row['cs_seq']]                                                  = $Row['cs_seq'];
                    $nListCnt++;
                }
                $S_RETURNVAL['nListCnt'] = $nListCnt;
                return $S_RETURNVAL;
                que_close();
        }
    }


//-----------------------------------------------
}
?>