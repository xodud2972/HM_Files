-- 광고유형 들어가고, 광고매체, 광고주or광고계정or사업자번호 총 5개 항목 들어가야함.

-- 일별 
SELECT a.*, b.cm3_seq as m_nm1 FROM (
					SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price,  m_nm, division1, division2, em_seq
						FROM t_contract		
					WHERE pay_date BETWEEN '2022-04-01' AND '2022-04-31'
						AND division1 ='6'
						AND division2 ='21'
					--	AND em_seq IN ()  
					--	AND 광고유형 IN ()	--배열형태로 들어가야 할듯 
					--	AND m_nm IN ()		--배열형태로 들어가야 할듯 
						AND del_date IS NULL
						AND sales_type IN (1,3)
						AND agree_state = '3'
						AND cs_seq IN (70501
											--	SELECT cs_seq
											--	FROM t_customer
											--	WHERE cs_m_id = ''
											--	AND cs_nm = ''
											--	AND cs_num = ''
											)
					GROUP BY pay_date ,division1, division2, em_seq, good_type2				
				) AS a 
INNER JOIN (
	SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq 
		FROM t_common2 
	WHERE cm3_seq > 0 
		AND use_yn='Y' 
) AS b ON a.good_type2=b.cm2_seq
--매체 부분이 cm3_seq로 되어있어서 m_nm으로 변경해야할듯 


-- 일별 
SELECT a.*, b.cm3_seq, b.CODE4
	FROM ( 
			SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, division1, division2, em_seq
			FROM t_contract 
			WHERE pay_date BETWEEN '2022-05-01' AND '2022-05-12' 
			AND division1 =6 
			AND em_seq IN (116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,211,289,292,293,308,309,310,311,313,314,315,317,319,323,326,350,330,351,352,353,356,357,364,369,370,373,389,397,399,441,442,449,455,461,465,473,475,488,495,642,496,497,527,543,557,577,578,579,580,589,590,603,610,614,632,633,641,643,651,656,662,665,667,668,672,676,677,679,688,693,696,697,698,699,701,702,707,708,709,712,713,714,725,726,727,736,742,743,749,751,752,759,765,766,767,768,776,777,785,787,788,789,791,798,800,801,819,842,843,845,851,855,857,859,860,863,865,874,875,877,878,879,887,888,949,950,952,953,954,955,956,957,958,959,961,962,963,964,969,970,972,973,982,984,988,989,990,991,992,995,996,997,1022,1006,1007,1008,1009,1011,1020,1025,1026,1028,1029,1030,1031,1047,1053,1055,1056,1057,1063,1064,1065,1066,1068,1069,1073,1092,1094,1097,1104,1105,1106,1107,1109,1117,1129,1130,1131,1132,1133,1134,1135,1136,1137,1138,1145,1146,1149,1151,1152,1157,1158,1159,1160,1166,1372,1192,1193,1568,1198,1201,1204,1206,1223,1224,1225,1232,1267,1268,1269,1290,1297,1303,1308,1311,1316,1317,1318,1321,1323,1325,1337,1338,1352,1357,1358,1359,1362,1363,1371,1373,1375,1376,1386,1387,1388,1389,1390,1391,1393,1394,1396,1398,1406,1412,1413,1416,1421,1440,1441,1446,1447,1453,1455,1457,1510,1474,1476,1479,1483,1484,1490,1491,1493,1508,1511,1514,1515,1516,1520,1521,1522,1523,1536,1537,1543,1544,1550,1553,1554,1556,1561,1562,1566,1586,1587,1588,1590,1597,1598,1599,1601,1607,1608,1611,1620,1622,1623,1624,1627,1628,1634,1638,1642,1643,1651,1653,1657,1662,1664,1666,1667,1677,200930,200935,200948,200952,200953,200954,200960,200963,200964,200966,200972,200973,200975,200977,200978,200979,200983,200984,200987,200988,200989,201001,201005,201006,201020,201045,201058,201066,201067,201076) 
			AND del_date IS NULL 
			AND sales_type IN (1,3) 
			AND agree_state = '3' 
			GROUP BY pay_date , division1, division2, em	_seq, good_type2 
			) AS a 
INNER JOIN ( 
			SELECT cm2_seq, cm1_seq, CODE1, CODE2, CODE4, kr_name, cm3_seq 
			FROM t_common2 
			WHERE cm3_seq > 0
			AND use_yn='Y' 
			AND CODE4 IN (1230)
			) AS b ON a.good_type2=b.cm2_seq

-- 주별  
SELECT CONCAT(start,' ~ ',end) as pay_date, SUM(a.pay_price) as pay_price, a.good_type2,a.m_nm,
			a.division1,a.division2,a.em_seq, b.cm3_seq as m_nm1 
FROM ( 
		SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, division1, 
			division2, em_seq, DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date)) DAY), '%Y-%m-%d') as start, 
			DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date) - 6) DAY), '%Y-%m-%d') as end 
		FROM t_contract 
		WHERE 1=1 
			AND pay_date >= '2022-04-25' AND pay_date <= '2022-05-15' 
			AND em_seq IN (116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,211,289,292,293,308,309,310,311,313,314,315,317,319,323,326,350,330,351,352,353,356,357,364,369,370,373,389,397,399,441,442,449,455,461,465,473,475,488,495,642,496,497,527,543,557,577,578,579,580,589,590,603,610,614,632,633,641,643,651,656,662,665,667,668,672,676,677,679,688,693,696,697,698,699,701,702,707,708,709,712,713,714,725,726,727,736,742,743,749,751,752,759,765,766,767,768,776,777,785,787,788,789,791,798,800,801,819,842,843,845,851,855,857,859,860,863,865,874,875,877,878,879,887,888,949,950,952,953,954,955,956,957,958,959,961,962,963,964,969,970,972,973,982,984,988,989,990,991,992,995,996,997,1022,1006,1007,1008,1009,1011,1020,1025,1026,1028,1029,1030,1031,1047,1053,1055,1056,1057,1063,1064,1065,1066,1068,1069,1073,1092,1094,1097,1104,1105,1106,1107,1109,1117,1129,1130,1131,1132,1133,1134,1135,1136,1137,1138,1145,1146,1149,1151,1152,1157,1158,1159,1160,1166,1372,1192,1193,1568,1198,1201,1204,1206,1223,1224,1225,1232,1267,1268,1269,1290,1297,1303,1308,1311,1316,1317,1318,1321,1323,1325,1337,1338,1352,1357,1358,1359,1362,1363,1371,1373,1375,1376,1386,1387,1388,1389,1390,1391,1393,1394,1396,1398,1406,1412,1413,1416,1421,1440,1441,1446,1447,1453,1455,1457,1510,1474,1476,1479,1483,1484,1490,1491,1493,1508,1511,1514,1515,1516,1520,1521,1522,1523,1536,1537,1543,1544,1550,1553,1554,1556,1561,1562,1566,1586,1587,1588,1590,1597,1598,1599,1601,1607,1608,1611,1620,1622,1623,1624,1627,1628,1634,1638,1642,1643,1651,1653,1657,1662,1664,1666,1667,1677,200930,200935,200948,200952,200953,200954,200960,200963,200964,200966,200972,200973,200975,200977,200978,200979,200983,200984,200987,200988,200989,201001,201005,201006,201020,201045,201058,201066,201067,201076) 
			AND del_date IS NULL 
			AND sales_type IN (1,3) 
			AND agree_state = '3' 
		GROUP BY pay_date , division1, division2, em_seq, good_type2 
		) AS a 
INNER JOIN ( 
		SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq 
		FROM t_common2 
		WHERE cm3_seq > 0 AND use_yn='Y' 
			) AS b ON a.good_type2=b.cm2_seq 
group by pay_date, m_nm1, good_type2 


--월별
SELECT a.*, b.cm3_seq as m_nm1 
	FROM ( 
				SELECT left(pay_date,7) as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, division1, division2, em_seq 
				FROM t_contract 
				WHERE pay_date BETWEEN '2022-05-01' AND '2022-05-12' 
				AND division1 =6 
				AND em_seq IN (116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,211,289,292,293,308,309,310,311,313,314,315,317,319,323,326,350,330,351,352,353,356,357,364,369,370,373,389,397,399,441,442,449,455,461,465,473,475,488,495,642,496,497,527,543,557,577,578,579,580,589,590,603,610,614,632,633,641,643,651,656,662,665,667,668,672,676,677,679,688,693,696,697,698,699,701,702,707,708,709,712,713,714,725,726,727,736,742,743,749,751,752,759,765,766,767,768,776,777,785,787,788,789,791,798,800,801,819,842,843,845,851,855,857,859,860,863,865,874,875,877,878,879,887,888,949,950,952,953,954,955,956,957,958,959,961,962,963,964,969,970,972,973,982,984,988,989,990,991,992,995,996,997,1022,1006,1007,1008,1009,1011,1020,1025,1026,1028,1029,1030,1031,1047,1053,1055,1056,1057,1063,1064,1065,1066,1068,1069,1073,1092,1094,1097,1104,1105,1106,1107,1109,1117,1129,1130,1131,1132,1133,1134,1135,1136,1137,1138,1145,1146,1149,1151,1152,1157,1158,1159,1160,1166,1372,1192,1193,1568,1198,1201,1204,1206,1223,1224,1225,1232,1267,1268,1269,1290,1297,1303,1308,1311,1316,1317,1318,1321,1323,1325,1337,1338,1352,1357,1358,1359,1362,1363,1371,1373,1375,1376,1386,1387,1388,1389,1390,1391,1393,1394,1396,1398,1406,1412,1413,1416,1421,1440,1441,1446,1447,1453,1455,1457,1510,1474,1476,1479,1483,1484,1490,1491,1493,1508,1511,1514,1515,1516,1520,1521,1522,1523,1536,1537,1543,1544,1550,1553,1554,1556,1561,1562,1566,1586,1587,1588,1590,1597,1598,1599,1601,1607,1608,1611,1620,1622,1623,1624,1627,1628,1634,1638,1642,1643,1651,1653,1657,1662,1664,1666,1667,1677,200930,200935,200948,200952,200953,200954,200960,200963,200964,200966,200972,200973,200975,200977,200978,200979,200983,200984,200987,200988,200989,201001,201005,201006,201020,201045,201058,201066,201067,201076) 
				AND del_date IS NULL 
				AND sales_type IN (1,3) 
				AND agree_state = '3' 
				GROUP BY left(pay_date,7) , division1, division2, em_seq, good_type2 
			) AS a 
INNER JOIN ( 
				SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq 
				FROM t_common2 
				WHERE cm3_seq > 0
				 AND use_yn='Y' 
			) AS b ON a.good_type2=b.cm2_seq




-- 연도별
SELECT a.*, b.cm3_seq as m_nm1 
	FROM ( 
			SELECT LEFT(pay_date,4) as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, division1, division2, em_seq 
			FROM t_contract 
			WHERE pay_date BETWEEN '2022-05-01' AND '2022-05-12' 
			AND division1 =6 
			AND em_seq IN (116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,211,289,292,293,308,309,310,311,313,314,315,317,319,323,326,350,330,351,352,353,356,357,364,369,370,373,389,397,399,441,442,449,455,461,465,473,475,488,495,642,496,497,527,543,557,577,578,579,580,589,590,603,610,614,632,633,641,643,651,656,662,665,667,668,672,676,677,679,688,693,696,697,698,699,701,702,707,708,709,712,713,714,725,726,727,736,742,743,749,751,752,759,765,766,767,768,776,777,785,787,788,789,791,798,800,801,819,842,843,845,851,855,857,859,860,863,865,874,875,877,878,879,887,888,949,950,952,953,954,955,956,957,958,959,961,962,963,964,969,970,972,973,982,984,988,989,990,991,992,995,996,997,1022,1006,1007,1008,1009,1011,1020,1025,1026,1028,1029,1030,1031,1047,1053,1055,1056,1057,1063,1064,1065,1066,1068,1069,1073,1092,1094,1097,1104,1105,1106,1107,1109,1117,1129,1130,1131,1132,1133,1134,1135,1136,1137,1138,1145,1146,1149,1151,1152,1157,1158,1159,1160,1166,1372,1192,1193,1568,1198,1201,1204,1206,1223,1224,1225,1232,1267,1268,1269,1290,1297,1303,1308,1311,1316,1317,1318,1321,1323,1325,1337,1338,1352,1357,1358,1359,1362,1363,1371,1373,1375,1376,1386,1387,1388,1389,1390,1391,1393,1394,1396,1398,1406,1412,1413,1416,1421,1440,1441,1446,1447,1453,1455,1457,1510,1474,1476,1479,1483,1484,1490,1491,1493,1508,1511,1514,1515,1516,1520,1521,1522,1523,1536,1537,1543,1544,1550,1553,1554,1556,1561,1562,1566,1586,1587,1588,1590,1597,1598,1599,1601,1607,1608,1611,1620,1622,1623,1624,1627,1628,1634,1638,1642,1643,1651,1653,1657,1662,1664,1666,1667,1677,200930,200935,200948,200952,200953,200954,200960,200963,200964,200966,200972,200973,200975,200977,200978,200979,200983,200984,200987,200988,200989,201001,201005,201006,201020,201045,201058,201066,201067,201076) 
			AND del_date IS NULL 
			AND sales_type IN (1,3) 
			AND agree_state = '3' 
			GROUP BY LEFT(pay_date,4) , division1, division2, em_seq, good_type2 
		) AS a 
INNER JOIN ( 
			SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq 
			FROM t_common2 
			WHERE cm3_seq > 0 
			AND use_yn='Y' ) AS b ON a.good_type2=b.cm2_seq







SELECT * FROM t_contract WHERE pay_date BETWEEN '2022-05-01' AND '2022-05-12' LIMIT 5000


SELECT * FROM t_employee WHERE em_nm = "엄태영"




SELECT a.*, b.cm3_seq as m_nm1, b.code4 
FROM (
	 SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, division1, division2, em_seq 
	 FROM t_contract 
	 WHERE pay_date BETWEEN '2022-04-01' AND '2022-04-30' 
		 AND division1 = '6' 
		 AND division2 = '21' 
		 AND del_date IS NULL
		 AND sales_type IN (1,3) 
		 AND agree_state = '3' 
	 GROUP BY pay_date ,division1, division2, em_seq, good_type2 ) AS a 
INNER JOIN ( SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq ,code4 
FROM t_common2 
WHERE cm3_seq > 0 
AND use_yn='Y' ) AS b ON a.good_type2=b.cm2_seq 

SELECT a.*, b.cm3_seq as m_nm1, b.code4 FROM ( SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, division1, division2, em_seq FROM t_contract WHERE pay_date BETWEEN '2022-04-01' AND '2022-04-30' AND division1 = '6' AND division2 = '21' AND del_date IS NULL AND sales_type IN (1,3) AND agree_state = '3' GROUP BY pay_date ,division1, division2, em_seq, good_type2 ) AS a INNER JOIN ( SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq ,code4 FROM t_common2 WHERE cm3_seq > 0 AND use_yn='Y' ) AS b ON a.good_type2=b.cm2_seq
SELECT CONCAT(start,' ~ ',end) as pay_date, SUM(a.pay_price) as pay_price, a.good_type2,a.m_nm,a.division1,a.division2,a.em_seq, b.cm3_seq as m_nm1 FROM ( SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, division1, division2, em_seq, DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date)) DAY), '%Y-%m-%d') as start, DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date) - 6) DAY), '%Y-%m-%d') as end FROM t_contract WHERE 1=1 AND pay_date >= '2022-04-01' AND pay_date <= '2022-04-30' AND division1 = '6' AND division2 = '21' AND del_date IS NULL AND sales_type IN (1,3) AND agree_state = '3' GROUP BY pay_date , division1, division2, em_seq, good_type2 ) AS a INNER JOIN ( SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq FROM t_common2 WHERE cm3_seq > 0 AND use_yn='Y' ) AS b ON a.good_type2=b.cm2_seq group by pay_date, m_nm1, good_type2
SELECT a.*, b.cm3_seq as m_nm1, b.code4 FROM ( SELECT left(pay_date,7) as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, division1, division2, em_seq FROM t_contract WHERE pay_date BETWEEN '2022-04-01' AND '2022-04-30' AND division1 = '6' AND division2 = '21' AND del_date IS NULL AND sales_type IN (1,3) AND agree_state = '3' GROUP BY left(pay_date,7) ,division1, division2, em_seq, good_type2 ) AS a INNER JOIN ( SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq ,code4 FROM t_common2 WHERE cm3_seq > 0 AND use_yn='Y' ) AS b ON a.good_type2=b.cm2_seq
SELECT a.*, b.cm3_seq as m_nm1, b.code4 FROM ( SELECT LEFT(pay_date,4) as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, division1, division2, em_seq FROM t_contract WHERE pay_date BETWEEN '2022-04-01' AND '2022-04-30' AND division1 = '6' AND division2 = '21' AND del_date IS NULL AND sales_type IN (1,3) AND agree_state = '3' GROUP BY LEFT(pay_date,4) ,division1, division2, em_seq, good_type2 ) AS a INNER JOIN ( SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq ,code4 FROM t_common2 WHERE cm3_seq > 0 AND use_yn='Y' ) AS b ON a.good_type2=b.cm2_seq


--              27: 노출광고 유형       28: 노출광고상품(or캠폐인유형)
SELECT DISTINCT cm2_seq, cm3_seq, kr_name FROM t_common2 WHERE cm3_seq > 1
SELECT * FROM t_common2 WHERE cm3_seq > 1

--         노출광고유형					code4 : 1230 1231 1232 1234       ex) 검색유형 배너유형 커머스유형 컨텐츠유형 기타 
--         노출광고상품or캠페인유형 code5 : 1237~1279			 
SELECT * FROM t_common2 WHERE cm1_seq IN (4) 
AND CODE4 IS NOT NULL





-- 일별 
SELECT a.*, b.cm3_seq as m_nm1 
	FROM ( 
			SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, division1, division2, em_seq 
			FROM t_contract 
			WHERE pay_date BETWEEN '2022-05-01' AND '2022-05-16' 
			AND division1 =6 
			AND em_seq IN (116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,211,289,292,293,308,309,310,311,313,314,315,317,319,323,326,350,330,351,352,353,356,357,364,369,370,373,389,397,399,441,442,449,455,461,465,473,475,488,495,642,496,497,527,543,557,577,578,579,580,589,590,603,610,614,632,633,641,643,651,656,662,665,667,668,672,676,677,679,688,693,696,697,698,699,701,702,707,708,709,712,713,714,725,726,727,736,742,743,749,751,752,759,765,766,767,768,776,777,785,787,788,789,791,798,800,801,819,842,843,845,851,855,857,859,860,863,865,874,875,877,878,879,887,888,949,950,952,953,954,955,956,957,958,959,961,962,963,964,969,970,972,973,982,984,988,989,990,991,992,995,996,997,1022,1006,1007,1008,1009,1011,1020,1025,1026,1028,1029,1030,1031,1047,1053,1055,1056,1057,1063,1064,1065,1066,1068,1069,1073,1092,1094,1097,1104,1105,1106,1107,1109,1117,1129,1130,1131,1132,1133,1134,1135,1136,1137,1138,1145,1146,1149,1151,1152,1157,1158,1159,1160,1166,1372,1192,1193,1568,1198,1201,1204,1206,1223,1224,1225,1232,1267,1268,1269,1290,1297,1303,1308,1311,1316,1317,1318,1321,1323,1325,1337,1338,1352,1357,1358,1359,1362,1363,1371,1373,1375,1376,1386,1387,1388,1389,1390,1391,1393,1394,1396,1398,1406,1412,1413,1416,1421,1440,1441,1446,1447,1453,1455,1457,1510,1474,1476,1479,1483,1484,1490,1491,1493,1508,1511,1514,1515,1516,1520,1521,1522,1523,1536,1537,1543,1544,1550,1553,1554,1556,1561,1562,1566,1586,1587,1588,1590,1597,1598,1599,1601,1607,1608,1611,1620,1622,1623,1624,1627,1628,1634,1638,1642,1643,1651,1653,1657,1662,1664,1666,1667,1677,200930,200935,200948,200952,200953,200954,200960,200963,200964,200966,200972,200973,200975,200977,200978,200979,200983,200984,200987,200988,200989,201001,201005,201006,201020,201045,201058,201066,201067,201076) 
			AND del_date IS NULL 
			AND sales_type IN (1,3) 
			AND agree_state = '3' 
			GROUP BY pay_date , division1, division2, em_seq, good_type2 ) AS a 
INNER JOIN ( 
			SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq 
			FROM t_common2 
			WHERE cm3_seq > 0 
			AND use_yn='Y' ) AS b ON a.good_type2=b.cm2_seq

-- 주별			
SELECT CONCAT(start,' ~ ',end) as pay_date, SUM(a.pay_price) as pay_price, a.good_type2,a.m_nm,a.division1,a.division2,a.em_seq, b.cm3_seq as m_nm1 
FROM ( 
		SELECT pay_date as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, division1, division2, em_seq, 
		DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date)) DAY), '%Y-%m-%d') as start, 
		DATE_FORMAT(DATE_SUB(pay_date, INTERVAL (WEEKDAY(pay_date) - 6) DAY), '%Y-%m-%d') as end 
		FROM t_contract 
		WHERE 1=1 
		AND pay_date >= '2022-04-25' 
		AND pay_date <= '2022-05-22'
		AND em_seq IN (116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,211,289,292,293,308,309,310,311,313,314,315,317,319,323,326,350,330,351,352,353,356,357,364,369,370,373,389,397,399,441,442,449,455,461,465,473,475,488,495,642,496,497,527,543,557,577,578,579,580,589,590,603,610,614,632,633,641,643,651,656,662,665,667,668,672,676,677,679,688,693,696,697,698,699,701,702,707,708,709,712,713,714,725,726,727,736,742,743,749,751,752,759,765,766,767,768,776,777,785,787,788,789,791,798,800,801,819,842,843,845,851,855,857,859,860,863,865,874,875,877,878,879,887,888,949,950,952,953,954,955,956,957,958,959,961,962,963,964,969,970,972,973,982,984,988,989,990,991,992,995,996,997,1022,1006,1007,1008,1009,1011,1020,1025,1026,1028,1029,1030,1031,1047,1053,1055,1056,1057,1063,1064,1065,1066,1068,1069,1073,1092,1094,1097,1104,1105,1106,1107,1109,1117,1129,1130,1131,1132,1133,1134,1135,1136,1137,1138,1145,1146,1149,1151,1152,1157,1158,1159,1160,1166,1372,1192,1193,1568,1198,1201,1204,1206,1223,1224,1225,1232,1267,1268,1269,1290,1297,1303,1308,1311,1316,1317,1318,1321,1323,1325,1337,1338,1352,1357,1358,1359,1362,1363,1371,1373,1375,1376,1386,1387,1388,1389,1390,1391,1393,1394,1396,1398,1406,1412,1413,1416,1421,1440,1441,1446,1447,1453,1455,1457,1510,1474,1476,1479,1483,1484,1490,1491,1493,1508,1511,1514,1515,1516,1520,1521,1522,1523,1536,1537,1543,1544,1550,1553,1554,1556,1561,1562,1566,1586,1587,1588,1590,1597,1598,1599,1601,1607,1608,1611,1620,1622,1623,1624,1627,1628,1634,1638,1642,1643,1651,1653,1657,1662,1664,1666,1667,1677,200930,200935,200948,200952,200953,200954,200960,200963,200964,200966,200972,200973,200975,200977,200978,200979,200983,200984,200987,200988,200989,201001,201005,201006,201020,201045,201058,201066,201067,201076) 
		AND del_date IS NULL 
		AND sales_type IN (1,3) 
		AND agree_state = '3' 
		GROUP BY pay_date , division1, division2, em_seq, good_type2 ) AS a 
INNER JOIN ( 
		SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq 
		FROM t_common2
		WHERE cm3_seq > 0 AND use_yn='Y' ) AS b ON a.good_type2=b.cm2_seq group by pay_date, m_nm1, good_type2			
		
-- 월별
SELECT a.*, b.cm3_seq as m_nm1 
FROM ( 
		SELECT left(pay_date,7) as pay_date , good_type2, SUM(pay_price) as pay_price, m_nm, division1, division2, em_seq 
		FROM t_contract 
		WHERE pay_date BETWEEN '2022-05-01' AND '2022-05-16'
		AND division1 =6 
		AND em_seq IN (116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,211,289,292,293,308,309,310,311,313,314,315,317,319,323,326,350,330,351,352,353,356,357,364,369,370,373,389,397,399,441,442,449,455,461,465,473,475,488,495,642,496,497,527,543,557,577,578,579,580,589,590,603,610,614,632,633,641,643,651,656,662,665,667,668,672,676,677,679,688,693,696,697,698,699,701,702,707,708,709,712,713,714,725,726,727,736,742,743,749,751,752,759,765,766,767,768,776,777,785,787,788,789,791,798,800,801,819,842,843,845,851,855,857,859,860,863,865,874,875,877,878,879,887,888,949,950,952,953,954,955,956,957,958,959,961,962,963,964,969,970,972,973,982,984,988,989,990,991,992,995,996,997,1022,1006,1007,1008,1009,1011,1020,1025,1026,1028,1029,1030,1031,1047,1053,1055,1056,1057,1063,1064,1065,1066,1068,1069,1073,1092,1094,1097,1104,1105,1106,1107,1109,1117,1129,1130,1131,1132,1133,1134,1135,1136,1137,1138,1145,1146,1149,1151,1152,1157,1158,1159,1160,1166,1372,1192,1193,1568,1198,1201,1204,1206,1223,1224,1225,1232,1267,1268,1269,1290,1297,1303,1308,1311,1316,1317,1318,1321,1323,1325,1337,1338,1352,1357,1358,1359,1362,1363,1371,1373,1375,1376,1386,1387,1388,1389,1390,1391,1393,1394,1396,1398,1406,1412,1413,1416,1421,1440,1441,1446,1447,1453,1455,1457,1510,1474,1476,1479,1483,1484,1490,1491,1493,1508,1511,1514,1515,1516,1520,1521,1522,1523,1536,1537,1543,1544,1550,1553,1554,1556,1561,1562,1566,1586,1587,1588,1590,1597,1598,1599,1601,1607,1608,1611,1620,1622,1623,1624,1627,1628,1634,1638,1642,1643,1651,1653,1657,1662,1664,1666,1667,1677,200930,200935,200948,200952,200953,200954,200960,200963,200964,200966,200972,200973,200975,200977,200978,200979,200983,200984,200987,200988,200989,201001,201005,201006,201020,201045,201058,201066,201067,201076) 
		AND del_date IS NULL 
		AND sales_type IN (1,3) 
		AND agree_state = '3' 
		GROUP BY left(pay_date,7) , division1, division2, em_seq, good_type2 ) AS a 
INNER JOIN ( 
SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq 
		FROM t_common2 WHERE cm3_seq > 0 AND use_yn='Y' ) AS b ON a.good_type2=b.cm2_seq		
		
		
		
SELECT a.*, b.cm3_seq as m_nm1, CODE4, CODE5
           FROM ( 
                   SELECT getcomkrname(division1)as division1, getcomkrname(division2)as division2, good_type2, SUM(pay_price) as pay_price, m_nm, em_seq 
                   FROM t_contract 
                   WHERE pay_date BETWEEN '2022-05-01' AND '2022-05-16' 
                   AND del_date IS NULL 
                   AND sales_type IN (1,3) 
                   AND agree_state = '3' 
                   GROUP BY t_contract.division1, good_type2) AS a 
           INNER JOIN ( 
                   SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq , CODE4, CODE5
                   FROM t_common2 
						 WHERE cm3_seq > 0 
						 AND use_yn='Y'
						 AND CODE4 > 0
 						 AND CODE5 > 0
                       ) AS b ON a.good_type2=b.cm2_seq
                      
                      
                      


-- --------------------------- 광고유형별------------------
SELECT pay_date, sum(pay_price) AS '합계',
		SUM(CASE WHEN code4='1230' THEN pay_price ELSE 0 END) AS '검색유형', 
		SUM(CASE WHEN code4='1231' THEN pay_price ELSE 0 END) AS '배너유형' ,
		SUM(CASE WHEN code4='1232' THEN pay_price ELSE 0 END) AS '커머스유형', 
		SUM(CASE WHEN code4='1233' THEN pay_price ELSE 0 END) AS '컨텐츠유형' ,
		SUM(CASE WHEN code4='1234' THEN pay_price ELSE 0 END) AS '기타' 
	FROM ( 
		SELECT cs_seq, cs_m_id, pay_price, good_type2, m_nm, pay_date 
		FROM t_contract 
		WHERE del_date IS NULL 
		AND pay_date BETWEEN '2022-05-01' AND '2022-05-31' 
		AND sales_type IN ('1','3') 
		AND agree_state='3'
	) AS a INNER JOIN t_common2 AS b ON a.good_type2=b.cm2_seq 
	WHERE cm1_seq='4' 
	AND use_yn='Y'
	GROUP BY pay_date
	
	


SELECT a.*, b.cm3_seq as m_nm1, CODE4, CODE5
           FROM ( 
                   SELECT pay_date as pay_date, good_type2, SUM(pay_price) as pay_price, m_nm, em_seq 
                   FROM t_contract 
                   WHERE pay_date BETWEEN '2022-05-01' AND '2022-05-16' 
                   AND del_date IS NULL 
                   AND sales_type IN (1,3) 
                   AND agree_state = '3' 
                   GROUP BY t_contract.division1, good_type2) AS a 
           INNER JOIN ( 
                   SELECT cm2_seq, cm1_seq, CODE1, CODE2, kr_name, cm3_seq , CODE4, CODE5
                   FROM t_common2 
						 WHERE cm3_seq > 0 
						 AND use_yn='Y'
						 AND CODE4 > 0
 						 AND CODE5 > 0
                       ) AS b ON a.good_type2=b.cm2_seq
GROUP BY CODE4, CODE5                       
                                            